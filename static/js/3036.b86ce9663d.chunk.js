!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8741a2a9-c6f5-4871-9326-73f585df7549",e._sentryDebugIdIdentifier="sentry-dbid-8741a2a9-c6f5-4871-9326-73f585df7549")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"5.5.0 (2024121652)"},(self.webpackChunkweb=self.webpackChunkweb||[]).push([[3036],{424403:(e,t,n)=>{n.d(t,{KR:()=>useCheckAccountExist,Mo:()=>useAccountInfoForManageToken,YF:()=>useAddToken,yT:()=>useAddTokenForm});var o=n(586330),r=n(514041),a=n(241440),s=n(578104),i=n(490343),d=n(625931),c=n(553083),l=n(643087),u=n(911998);function useAddTokenForm({token:e,networkId:t}){var n=c.Ay.isAllNetwork({networkId:t}),o=(0,r.useCallback)((function(){return e&&e.networkId?e.networkId:n?(0,d.V)().eth:t}),[n,t,e]),s=(0,i.useForm)({values:{networkId:o(),contractAddress:e?.address||"",symbol:e?.symbol||"",decimals:e?.decimals?new a.A(e.decimals).toString():""},mode:"onChange",reValidateMode:"onBlur"}),l=s.watch("networkId"),u=s.watch("contractAddress"),k=s.watch("symbol"),p=s.watch("decimals"),[m,f]=(0,r.useState)(!1),w=(0,r.useRef)(!0),g=(0,r.useCallback)((function(t){w.current||(e?.address||u)&&f(t)}),[u,e?.address]);return(0,r.useEffect)((function(){w.current?w.current=!1:s.trigger("contractAddress")}),[m,s]),{form:s,isEmptyContract:m,setIsEmptyContractState:g,selectedNetworkIdValue:l,contractAddressValue:u,symbolValue:k,decimalsValue:p}}function useAddToken({token:e,walletId:t,networkId:n,form:i,selectedNetworkIdValue:d,contractAddressValue:c,setIsEmptyContractState:k}){var p,{result:m}=(0,u.yk)((0,o.A)((function*(){var t=(yield l.A.serviceNetwork.getCustomTokenEnabledNetworks({currentNetworkId:n})).map((function(e){return e.id})),o=yield l.A.serviceNetwork.getNetwork({networkId:n});return e?.networkId&&!t.includes(e.networkId)&&t.push(e.networkId),{networkIds:t,network:o}})),[n,e?.networkId]),f=(0,r.useRef)(),w=(0,s.YQ)((p=(0,o.A)((function*(n){var o;if(!e&&!n.value.trim())return i.setValue("symbol",""),i.setValue("decimals",""),void k(!0);var r=yield l.A.serviceCustomToken.searchTokenByContractAddress({walletId:t,networkId:n.networkId,contractAddress:n.value.trim(),isNative:null!=(o=e?.isNative)&&o});if(Array.isArray(r)&&r.length>0&&r[0]?.info){var[s]=r;i.setValue("symbol",s.info.symbol),i.setValue("decimals",new a.A(s.info.decimals).toString()),f.current=s.info,k(!1)}else i.setValue("symbol",""),i.setValue("decimals",""),k(!0)})),function(e){return p.apply(this,arguments)}),300);return(0,r.useEffect)((function(){w({value:c,networkId:d})}),[c,d,w]),{availableNetworks:m,searchedTokenRef:f}}function useAccountInfoForManageToken(){var e,t=(0,r.useCallback)((e=(0,o.A)((function*({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:o,deriveType:r,selectedNetworkId:a}){var{serviceAccount:s}=l.A,i=!1,d="";try{d=n?(yield s.getAccount({accountId:e,networkId:t})).id:(yield s.getNetworkAccount({accountId:void 0,indexedAccountId:o,networkId:a,deriveType:r})).id,i=!0}catch(e){i=!1}return{hasExistAccountFlag:i,accountIdForNetwork:d}})),function(t){return e.apply(this,arguments)}),[]);return{findAccountInfoForNetwork:t}}function useCheckAccountExist({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:a,deriveType:s,selectedNetworkIdValue:i}){var{findAccountInfoForNetwork:d}=useAccountInfoForManageToken(),c=(0,r.useCallback)((0,o.A)((function*(){return d({accountId:e,networkId:t,isOthersWallet:n,indexedAccountId:a,deriveType:s,selectedNetworkId:i})})),[e,a,t,n,s,i,d]),{result:l,run:k}=(0,u.yk)((0,o.A)((function*(){var{hasExistAccountFlag:e}=yield c();return e})),[c]);return{hasExistAccount:l,runCheckAccountExist:k,checkAccountIsExist:c}}},3036:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var o=n(324586),r=n(586330),a=n(514041),s=n(654266),i=n(908867),d=n(490343),c=n(625931),l=n(318822),u=n(334439),k=n(193068),p=n(643087),m=n(498356),f=n(208257),w=n(791088),g=n(562428),y=(n(663522),n(553083)),I=n(831085);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ListHeaderComponent({onAddCustomToken:e}){var t=(0,i.A)();return(0,I.jsx)(w.c,{title:t.formatMessage({id:u.ETranslations.manage_token_custom_token_title}),drillIn:!0,onPress:e,"data-sentry-element":"ListItem","data-sentry-component":"ListHeaderComponent","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/components/TokenManager/TokenManagerList.tsx"})}function ListEmptyComponent({onAddCustomToken:e,isLoading:t}){var n=(0,i.A)();return t?null:(0,I.jsx)(d.Empty,{flex:1,icon:"SearchOutline",title:n.formatMessage({id:u.ETranslations.global_no_results}),description:n.formatMessage({id:u.ETranslations.manage_token_empty_msg}),button:(0,I.jsx)(d.Button,{mt:"$6",size:"medium",variant:"primary",onPress:function(){return e()},children:n.formatMessage({id:u.ETranslations.manage_token_custom_token_button})}),"data-sentry-element":"Empty","data-sentry-component":"ListEmptyComponent","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/components/TokenManager/TokenManagerList.tsx"})}function ListFooterComponent({searchValue:e,searchResult:t,onAddCustomToken:n}){var o=(0,i.A)();return e.length&&Array.isArray(t)&&t.length?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(d.Divider,{pt:"$5"}),(0,I.jsxs)(d.YStack,{p:"$5",alignItems:"center",children:[(0,I.jsx)(d.SizableText,{textAlign:"center",size:"$bodyMd",maxWidth:void 0,children:o.formatMessage({id:u.ETranslations.manage_token_empty_msg})}),(0,I.jsx)(d.Button,{mt:"$6",size:"medium",variant:"primary",onPress:function(){return n()},children:o.formatMessage({id:u.ETranslations.manage_token_custom_token_button})})]})]}):null}function SkeletonList(){return Array.from({length:5}).map((function(e,t){return(0,I.jsx)(w.c,{children:(0,I.jsxs)(d.XStack,{alignItems:"center",gap:"$3",children:[(0,I.jsx)(d.Skeleton,{width:"$10",height:"$10",radius:"round"}),(0,I.jsxs)(d.YStack,{gap:"$2",children:[(0,I.jsx)(d.Skeleton,{w:120,h:12,borderRadius:"$3"}),(0,I.jsx)(d.Skeleton,{w:80,h:12,borderRadius:"$3"})]})]})},t)}))}function TokenManagerList({dataSource:e,onAddCustomToken:t,onHiddenToken:n,isLoadingRemoteData:o,isLoadingLocalData:r,networkId:a,isAllNetwork:s,networkMaps:c,checkTokenExistInTokenList:l,searchValue:k,searchResult:p,showListHeader:m=!0}){var f=(0,i.A)(),{bottom:h}=(0,d.useSafeAreaInsets)();return o||!e?(0,I.jsx)(SkeletonList,{}):(0,I.jsx)(d.SectionList,{ListHeaderComponent:m?(0,I.jsx)(ListHeaderComponent,{onAddCustomToken:t}):null,sections:e,estimatedItemSize:60,renderSectionHeader:function({section:{title:e,data:n}}){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(d.SizableText,{mt:10,px:"$5",size:"$bodyMd",color:"$textSubdued",children:e}),Array.isArray(n)&&!n.length?(0,I.jsx)(ListEmptyComponent,{onAddCustomToken:t,isLoading:o||!!r}):null]})},keyExtractor:function(e){return e.$key},renderItem:function({item:e}){var o,r,i;return(0,I.jsxs)(w.c,{children:[(0,I.jsx)(g.G,{icon:e.logoURI,networkId:null!=(o=e.networkId)?o:a,isAllNetworks:!0}),(0,I.jsxs)(d.YStack,{flex:1,children:[(0,I.jsxs)(d.XStack,{gap:"$2",alignItems:"center",children:[(0,I.jsx)(d.SizableText,{size:"$bodyLgMedium",color:"$text",children:e.symbol}),s?(0,I.jsx)(d.Badge,{children:null!=(r=c?.[null!=(i=e.networkId)?i:""]?.name)?r:""}):null]}),(0,I.jsx)(d.SizableText,{size:"$bodyMd",color:"$textSubdued",children:e.name})]}),(0,I.jsx)(w.c.IconButton,_objectSpread({disabled:!(!l(e)||!y.Ay.isBTCNetwork(e.networkId)),title:l(e)&&y.Ay.isBTCNetwork(e.networkId)?f.formatMessage({id:u.ETranslations.manage_token_native_token_cannot_removed}):void 0,icon:l(e)?"MinusCircleOutline":"PlusCircleOutline",onPress:function(){return l(e)?n(e):t(e)}},l(e)&&{iconProps:{color:"$iconCritical"}}))]})},ListFooterComponent:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(ListFooterComponent,{searchValue:k,searchResult:p,onAddCustomToken:t}),(0,I.jsx)(d.Stack,{h:h||"$3"})]}),ListEmptyComponent:(0,I.jsx)(ListEmptyComponent,{onAddCustomToken:t,isLoading:o||!!r}),keyboardDismissMode:"on-drag","data-sentry-element":"SectionList","data-sentry-component":"TokenManagerList","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/components/TokenManager/TokenManagerList.tsx"})}var h=n(424403),T=n(911998),A=n(384013);var v=n(712784),b=n.n(v);function TokenManagerModal_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function TokenManagerModal_objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TokenManagerModal_ownKeys(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TokenManagerModal_ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function TokenManagerModal(){var e,t=(0,i.A)(),n=(0,m.A)(),o=(0,s.lq)(),{walletId:f,isOthersWallet:w,indexedAccountId:g,networkId:y,accountId:v,deriveType:x}=o.params,M=y===(0,c.V)().onekeyall,{sectionTokens:j,refreshTokenLists:L,isLoadingLocalData:_,networkMaps:S,checkTokenExistInTokenList:C}=function useTokenManagement({networkId:e,accountId:t}){var n=(0,i.A)(),o=e===(0,c.V)().onekeyall,[s]=(0,A.RI)(),{result:d,run:l,isLoading:k}=(0,T.yk)((0,r.A)((function*(){var[r,a]=yield Promise.all([p.A.serviceCustomToken.getHiddenTokens({accountId:t,networkId:e,allNetworkAccountId:o?t:void 0}),p.A.serviceCustomToken.getCustomTokens({accountId:t,networkId:e,allNetworkAccountId:o?t:void 0})]),i=[...s.tokens,...a].filter((function(e,t,n){return t===n.findIndex((function(t){return t.networkId===e.networkId&&t.accountId===e.accountId&&t.address===e.address}))})).filter((function(e){return!r.find((function(t){return t.address===e.address&&t.networkId===e.networkId}))})),d=[{title:n.formatMessage({id:u.ETranslations.manage_token_added_token}),data:i}];return r.length&&d.push({title:n.formatMessage({id:u.ETranslations.manage_token_popular_token}),data:r}),{sectionTokens:d,addedTokens:i}})),[s,t,e,o,n],{checkIsFocused:!1,watchLoading:!0}),{result:m}=(0,T.yk)((0,r.A)((function*(){return(yield p.A.serviceNetwork.getAllNetworks()).networks.reduce((function(e,t){return e[t.id]=t,e}),{})})),[],{initResult:{}}),f=(0,a.useCallback)((function(e){return d?.addedTokens?.find((function(t){return t.address===e.address&&t.networkId===e.networkId}))}),[d?.addedTokens]);return{sectionTokens:d?.sectionTokens,tokenList:d?.addedTokens,refreshTokenLists:l,isLoadingLocalData:k,networkMaps:m,checkTokenExistInTokenList:f}}({networkId:y,accountId:v}),{searchValue:E,searchResult:O,isSearchMode:N,setSearchValue:P,isLoadingRemoteData:$}=function useTokenSearch({walletId:e,networkId:t,accountId:n}){var o,[s,i]=(0,a.useState)(!1),[d,c]=(0,a.useState)(""),[l,u]=(0,a.useState)(null),k=(0,a.useRef)(b()((o=(0,r.A)((function*(e){i(!0);try{var t=yield p.A.serviceCustomToken.searchTokenByKeywords({walletId:e.walletId,accountId:e.accountId,networkId:e.networkId,keywords:e.searchValue}),n=t?.map((function(e){var t,{price:n,price24h:o,info:r}=e;return{$key:`search__${null!=(t=r.networkId)?t:""}_${r.address}_${r.isNative?"native":"token"}`,address:r.address,decimals:r.decimals,isNative:r.isNative,logoURI:r.logoURI,name:r.name,symbol:r.symbol,riskLevel:r.riskLevel,networkId:r.networkId,price:n,price24h:o}}));u(n)}catch(e){}finally{i(!1)}})),function(e){return o.apply(this,arguments)}),500)).current;(0,a.useEffect)((function(){if(d)return k({walletId:e,networkId:t,accountId:n,searchValue:d}),function(){k.cancel()};u(null)}),[d,t,e,n,k]);var m=(0,a.useMemo)((function(){return d&&d.length>0}),[d]);return{searchValue:d,searchResult:l,isSearchMode:m,setSearchValue:c,isLoadingRemoteData:s}}({walletId:f,networkId:y,accountId:v}),V=(0,a.useMemo)((function(){return N&&Array.isArray(O)?[{title:"",data:O}]:j}),[N,O,j]),R=(0,a.useRef)(!1),F=(0,a.useCallback)((function(e){n.push(k.jX.AddCustomTokenModal,{walletId:f,isOthersWallet:w,indexedAccountId:g,networkId:y,accountId:v,deriveType:x,token:e,onSuccess:function(){L(),R.current=!0}})}),[n,f,w,g,y,v,x,L]),{findAccountInfoForNetwork:D}=(0,h.Mo)(),z=(0,a.useCallback)((e=(0,r.A)((function*(e){var n,o,{accountIdForNetwork:r}=yield D({accountId:v,networkId:y,isOthersWallet:w,indexedAccountId:g,deriveType:x,selectedNetworkId:null!=(n=e.networkId)?n:y});yield p.A.serviceCustomToken.hideToken({token:TokenManagerModal_objectSpread(TokenManagerModal_objectSpread({},e),{},{accountId:r,networkId:null!=(o=e.networkId)?o:y,allNetworkAccountId:M?v:void 0})}),R.current=!0,setTimeout((function(){L(),d.Toast.success({title:t.formatMessage({id:u.ETranslations.address_book_add_address_toast_delete_success})})}),200)})),function(t){return e.apply(this,arguments)}),[L,v,y,w,g,x,t,M,D]);return(0,I.jsxs)(d.Page,{safeAreaEnabled:!1,onClose:function(){R.current&&l.iL.emit(l.Tu.RefreshTokenList,void 0)},"data-sentry-element":"Page","data-sentry-component":"TokenManagerModal","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/pages/TokenManagerModal.tsx",children:[(0,I.jsx)(d.Page.Header,{title:t.formatMessage({id:u.ETranslations.manage_token_title}),"data-sentry-element":"unknown","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/pages/TokenManagerModal.tsx"}),(0,I.jsxs)(d.Page.Body,{"data-sentry-element":"unknown","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/pages/TokenManagerModal.tsx",children:[(0,I.jsx)(d.Stack,{px:"$5",pb:"$4","data-sentry-element":"Stack","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/pages/TokenManagerModal.tsx",children:(0,I.jsx)(d.SearchBar,{placeholder:t.formatMessage({id:u.ETranslations.token_selector_search_placeholder}),autoFocus:!0,zIndex:20,selectTextOnFocus:!0,value:E,onSearchTextChange:P,onSubmitEditing:function(){},"data-sentry-element":"SearchBar","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/pages/TokenManagerModal.tsx"})}),(0,I.jsx)(TokenManagerList,{dataSource:V,onAddCustomToken:F,onHiddenToken:z,isLoadingRemoteData:$,isLoadingLocalData:_,networkId:y,isAllNetwork:M,networkMaps:S,checkTokenExistInTokenList:C,searchValue:E,searchResult:O,showListHeader:!N,"data-sentry-element":"TokenManagerList","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/pages/TokenManagerModal.tsx"})]})]})}const x=function TokenManagerModalContainer(){return(0,I.jsx)(f.p,{"data-sentry-element":"HomeTokenListProviderMirror","data-sentry-component":"TokenManagerModalContainer","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/pages/TokenManagerModal.tsx",children:(0,I.jsx)(TokenManagerModal,{"data-sentry-element":"TokenManagerModal","data-sentry-source-file":"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/AssetList/pages/TokenManagerModal.tsx"})})}}}]);
//# sourceMappingURL=3036.b86ce9663d.chunk.js.map