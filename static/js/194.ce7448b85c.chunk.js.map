{"version":3,"file":"static/js/194.ce7448b85c.chunk.js","mappings":"0oBAAmgE,IAAIA,GAAc,IAAAC,OAAxyD,SAASC,oBAAmB,IAACC,EAAG,KAACC,EAAI,aAACC,EAAa,OAAO,OAAIF,GAA2E,UAAM,EAAAG,MAAM,CAACF,KAAKA,EAAKC,aAAaA,EAAaE,YAAY,IAAWC,cAAcC,YAAY,iBAAiBC,YAAY,aAAa,sBAAsB,QAAQ,wBAAwB,qBAAqB,0BAA0B,4GAA4GC,SAAS,EAAC,SAAK,EAAAL,MAAMM,OAAO,CAACC,OAAO,CAACV,IAAIW,mBAAmBX,IAAM,sBAAsB,UAAU,0BAA0B,+GAA8G,SAAK,EAAAG,MAAMS,SAAS,CAAC,sBAAsB,UAAU,0BAA0B,4GAA4GJ,UAAS,SAAK,EAAAK,MAAM,CAACC,GAAG,YAAYC,GAAG,SAASC,GAAG,SAASC,MAAM,OAAOC,OAAO,OAAO,sBAAsB,QAAQ,0BAA0B,4GAA4GV,UAAS,SAAK,EAAAW,KAAK,CAACC,KAAK,gBAAgBH,MAAM,OAAOC,OAAO,OAAO,sBAAsB,OAAO,0BAA0B,mHAAkH,SAAK,EAAAf,MAAMkB,QAAQ,CAAC,sBAAsB,UAAU,0BAA0B,4GAA4Gb,UAAS,SAAK,EAAAc,SAAS,CAACL,MAAM,OAAOC,OAAO,OAAO,sBAAsB,WAAW,0BAA0B,oHAAjlD,SAAK,EAAAI,SAAS,CAACL,MAAMhB,EAAKiB,OAAOjB,EAAKsB,OAAO,SAAupD,G,sRCAh1D,SAASC,QAAQC,EAAEC,GAAG,IAAIC,EAAEC,OAAOC,KAAKJ,GAAG,GAAGG,OAAOE,sBAAsB,CAAC,IAAIC,EAAEH,OAAOE,sBAAsBL,GAAGC,IAAIK,EAAEA,EAAEC,QAAO,SAASN,GAAG,OAAOE,OAAOK,yBAAyBR,EAAEC,GAAGQ,UAAW,KAAIP,EAAEQ,KAAKC,MAAMT,EAAEI,EAAG,CAAC,OAAOJ,CAAE,CAAC,SAASU,cAAcZ,GAAG,IAAI,IAAIC,EAAE,EAAEA,EAAEY,UAAUC,OAAOb,IAAI,CAAC,IAAIC,EAAE,MAAMW,UAAUZ,GAAGY,UAAUZ,GAAG,CAAC,EAAEA,EAAE,EAAEF,QAAQI,OAAOD,IAAG,GAAIa,SAAQ,SAASd,IAAG,OAAgBD,EAAEC,EAAEC,EAAED,GAAI,IAAGE,OAAOa,0BAA0Bb,OAAOc,iBAAiBjB,EAAEG,OAAOa,0BAA0Bd,IAAIH,QAAQI,OAAOD,IAAIa,SAAQ,SAASd,GAAGE,OAAOe,eAAelB,EAAEC,EAAEE,OAAOK,yBAAyBN,EAAED,GAAI,GAAG,CAAC,OAAOD,CAAE,CAAg6K,SAAe,QAAxhI,SAASmB,mBAAmB,IAAIC,EAAUC,IAAc,IAAAC,WAAS,GAAWC,GAAK,SAAcC,GAAW,UAAsB,qBAACC,EAAoB,wBAACC,IAAyB,UAA0BC,SAAW,KAACC,IAAM,IAAAC,aAAc,kBAACC,IAAmB,UAAmBH,SAAYI,EAAKC,IAAS,IAAAV,UAAS,IAAOW,OAAOC,EAAU,IAACC,IAAK,SAAiB,QAAkB,YAAY,IAA8EC,EAA5vB,SAASC,gBAAgBC,GAAM,IAAIC,EAAOD,EAAKE,QAAO,SAASP,EAAOQ,GAAM,IAAIC,GAAK,QAAmB,IAAIC,KAAKF,EAAKG,YAAgF,OAAjEX,EAAOS,GAAOT,EAAOS,GAAMhC,KAAK+B,GAAYR,EAAOS,GAAM,CAACD,GAAcR,CAAO,GAAE,CAAC,GAAG,OAAO9B,OAAOC,KAAKmC,GAAQM,KAAI,SAASC,GAAK,MAAM,CAACC,MAAMD,EAAIR,KAAKC,EAAOO,GAAM,GAAG,CAAmdT,OAAnE,IAAmBW,iBAAiBC,iBAAiBlB,IAAoC,OAAOK,CAAI,IAAG,CAACL,GAAM,CAACmB,cAAa,IAAWC,GAAqB,IAAAC,SAAO,GAAWC,GAAgB,IAAAC,cAAY,QAAkB,kBAAkB5B,IAA0ByB,EAAqBxB,SAAQ,EAAK4B,YAAW,WAAgBpB,GAAM,GAAE,IAAK,IAAG,CAACA,EAAIT,KAA0B,IAAA8B,YAAU,WAAcL,EAAqBxB,SAA8B,IAArBO,GAAYpB,SAAYU,EAAWiC,MAAMN,EAAqBxB,SAAQ,EAAO,GAAE,CAACH,EAAWU,GAAYpB,SAAS,IAAI4C,GAAY,IAAAJ,cAAY,WAAW,OAAO,UAAM,EAAAK,OAAO,CAAC5E,SAAS,CAACqC,GAAU,UAAM,WAAU,CAACrC,SAAS,EAAC,SAAK,EAAA6E,WAAW,CAACC,QAAQ,WAAWC,KAAK,eAAef,MAAMxB,EAAKwC,cAAc,CAACC,GAAG,EAAAC,cAAcC,qBAAqBC,QAAQ,WAAW,EAAAC,OAAOC,KAAK,CAACtB,MAAMxB,EAAKwC,cAAc,CAACC,GAAG,EAAAC,cAAcK,+BAA+BC,YAAYhD,EAAKwC,cAAc,CAACC,GAAG,EAAAC,cAAcO,gCAAgCC,UAAU,WAAW,OAAOpB,GAAkB,EAAEqB,cAAcnD,EAAKwC,cAAc,CAACC,GAAG,EAAAC,cAAcC,sBAAuB,KAAI,SAAK,EAAAS,QAAQ,CAACC,UAAS,EAAKC,GAAG,UAAU,MAAK,SAAK,EAAAC,OAAO,CAACjB,QAAQ,WAAWrF,KAAK,SAAS2F,QAAQ,WAAW,OAAO9C,GAAa,SAAS0D,GAAM,OAAOA,CAAK,GAAG,EAAEhG,SAASqC,EAAUG,EAAKwC,cAAc,CAACC,GAAG,EAAAC,cAAce,cAAczD,EAAKwC,cAAc,CAACC,GAAG,EAAAC,cAAcgB,kBAAmB,GAAE,CAAC5B,EAAgBjC,EAAUG,IAAW2D,GAAa,IAAA5B,cAAY,SAASb,GAAM,OAAOA,EAAKuB,EAAG,GAAE,IAAI,OAAO,UAAM,EAAAmB,KAAK,CAACC,eAAc,EAAK,sBAAsB,OAAO,wBAAwB,mBAAmB,0BAA0B,gHAAgHrG,SAAS,EAAC,SAAK,EAAAoG,KAAKE,OAAO,CAACtC,MAAMxB,EAAKwC,cAAc,CAACC,GAAG,EAAAC,cAAcqB,kBAAkB5B,YAAYA,EAAY,sBAAsB,UAAU,0BAA0B,mHAAkH,SAAK,EAAAyB,KAAKI,KAAK,CAAC,sBAAsB,UAAU,0BAA0B,gHAAgHxG,UAAS,SAAK,EAAAyG,YAAY,CAACC,OAAO,sBAAsBhG,OAAO,OAAOiG,oBAAmB,SAAK,EAAAC,MAAM,CAACC,GAAG,MAAMC,GAAG,KAAK/B,KAAK,0BAA0Bf,MAAMxB,EAAKwC,cAAc,CAACC,GAAG,EAAAC,cAAc6B,uBAAuBC,kBAAkB,MAAMC,UAAU5E,EAAU6E,SAAS,IAAO/D,GAAY,GAAGA,EAAWgE,oBAAoB,UAAUC,SAAQ,MAACpD,KAAS,OAAO,SAAK,EAAAyC,YAAYY,cAAc,CAACrD,MAAMA,GAAQ,EAAEmC,aAAaA,EAAamB,WAAW,UAAS,KAAC5D,IAAO,OAAO,SAAK,IAAS7B,cAAcA,cAAc,CAAC0F,cAAa,SAAK,IAAc,CAAC/H,IAAIkE,EAAK8D,KAAK/H,KAAK,QAAQuE,MAAMN,EAAKM,MAAMyD,WAAW,CAACC,cAAc,GAAGC,SAASjE,EAAKkE,IAAIC,cAAc,CAACH,cAAc,GAAGhB,OAAO,gBAAgBhD,EAAKkE,IAAIE,kBAAkBzF,GAAW,CAAC+C,QAAQ,WAAWrC,EAAkB,CAACgF,wBAAwBlF,EAAKJ,aAAWuF,QAAQ,CAACJ,IAAIlE,EAAKkE,IAAI5D,MAAMN,EAAKM,SAAS,IAAciE,UAAUC,KAAKC,UAAU,CAACC,WAAW1E,EAAKkE,IAAIS,SAAS3E,EAAKM,MAAMsE,YAAY,IAAaC,SAAU,IAAI,CAAC,EAAE,CAACvI,SAASqC,GAAU,SAAK,IAASwC,WAAW,CAACE,KAAK,gBAAgBK,QAAQ,WAAgB1C,EAAqBgB,EAAKuB,IAAIb,EAAqBxB,SAAQ,EAAK4B,YAAW,WAAgBpB,GAAM,GAAE,KAAK,EAAAoF,MAAMC,QAAQ,CAACzE,MAAMxB,EAAKwC,cAAc,CAACC,GAAG,EAAAC,cAAcwD,2BAA4B,IAAI,OAAOhF,EAAKuB,GAAI,EAAE0D,aAAa,WAAW1F,GAAQ,SAAS+C,GAAM,OAAOA,EAAK,CAAE,GAAG,EAAE,sBAAsB,cAAc,0BAA0B,sHAAuH,G","sources":["webpack://web/../../packages/kit/src/views/Discovery/components/DiscoveryIcon.tsx","webpack://web/../../packages/kit/src/views/Discovery/pages/HistoryListModal/index.tsx"],"sourcesContent":["import{memo}from'react';import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import{Icon,Image,Skeleton,Stack}from'@onekeyhq/components';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function BasicDiscoveryIcon({uri,size,borderRadius='$2'}){if(!uri){return _jsx(Skeleton,{width:size,height:size,radius:\"round\"});}return _jsxs(Image,{size:size,borderRadius:borderRadius,borderWidth:StyleSheet.hairlineWidth,borderColor:\"$borderSubdued\",borderCurve:\"continuous\",\"data-sentry-element\":\"Image\",\"data-sentry-component\":\"BasicDiscoveryIcon\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/components/DiscoveryIcon.tsx\",children:[_jsx(Image.Source,{source:{uri:decodeURIComponent(uri)},\"data-sentry-element\":\"unknown\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/components/DiscoveryIcon.tsx\"}),_jsx(Image.Fallback,{\"data-sentry-element\":\"unknown\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/components/DiscoveryIcon.tsx\",children:_jsx(Stack,{bg:\"$bgStrong\",ai:\"center\",jc:\"center\",width:\"100%\",height:\"100%\",\"data-sentry-element\":\"Stack\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/components/DiscoveryIcon.tsx\",children:_jsx(Icon,{name:\"GlobusOutline\",width:\"100%\",height:\"100%\",\"data-sentry-element\":\"Icon\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/components/DiscoveryIcon.tsx\"})})}),_jsx(Image.Loading,{\"data-sentry-element\":\"unknown\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/components/DiscoveryIcon.tsx\",children:_jsx(Skeleton,{width:\"100%\",height:\"100%\",\"data-sentry-element\":\"Skeleton\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/components/DiscoveryIcon.tsx\"})})]});}export var DiscoveryIcon=memo(BasicDiscoveryIcon);","import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _isNil from\"lodash/isNil\";import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}import{useCallback,useEffect,useRef,useState}from'react';import{useIntl}from'react-intl';import{Button,Dialog,Divider,Empty,IconButton,Page,SectionList,Toast,XStack,useMedia}from'@onekeyhq/components';import backgroundApiProxy from'@onekeyhq/kit/src/background/instance/backgroundApiProxy';import{ListItem}from'@onekeyhq/kit/src/components/ListItem';import useAppNavigation from'@onekeyhq/kit/src/hooks/useAppNavigation';import{usePromiseResult}from'@onekeyhq/kit/src/hooks/usePromiseResult';import{useBrowserAction,useBrowserHistoryAction}from'@onekeyhq/kit/src/states/jotai/contexts/discovery';import{ETranslations}from'@onekeyhq/shared/src/locale';import{defaultLogger}from'@onekeyhq/shared/src/logger/logger';import{EEnterMethod}from'@onekeyhq/shared/src/logger/scopes/discovery/scenes/dapp';import{formatRelativeDate}from'@onekeyhq/shared/src/utils/dateUtils';import{DiscoveryIcon}from\"../../components/DiscoveryIcon\";import{withBrowserProvider}from\"../Browser/WithBrowserProvider\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function groupDataByDate(data){var groups=data.reduce(function(result,item){var date=formatRelativeDate(new Date(item.createdAt));if(result[date]){result[date].push(item);}else{result[date]=[item];}return result;},{});return Object.keys(groups).map(function(key){return{title:key,data:groups[key]};});}function HistoryListModal(){var[isEditing,setIsEditing]=useState(false);var intl=useIntl();var navigation=useAppNavigation();var{removeBrowserHistory,removeAllBrowserHistory}=useBrowserHistoryAction().current;var{gtMd}=useMedia();var{handleOpenWebSite}=useBrowserAction().current;var[page,setPage]=useState(1);var{result:dataSource,run}=usePromiseResult(_asyncToGenerator(function*(){var data=yield backgroundApiProxy.serviceDiscovery.fetchHistoryData(page);var ret=groupDataByDate(data);return ret;}),[page],{watchLoading:true});var removeHistoryFlagRef=useRef(false);var handleDeleteAll=useCallback(_asyncToGenerator(function*(){yield removeAllBrowserHistory();removeHistoryFlagRef.current=true;setTimeout(function(){void run();},200);}),[run,removeAllBrowserHistory]);useEffect(function(){if(removeHistoryFlagRef.current&&dataSource?.length===0){navigation.pop();removeHistoryFlagRef.current=false;}},[navigation,dataSource?.length]);var headerRight=useCallback(function(){return _jsxs(XStack,{children:[isEditing?_jsxs(_Fragment,{children:[_jsx(IconButton,{variant:\"tertiary\",icon:\"BroomOutline\",title:intl.formatMessage({id:ETranslations.explore_remove_all}),onPress:function(){Dialog.show({title:intl.formatMessage({id:ETranslations.explore_clear_history_prompt}),description:intl.formatMessage({id:ETranslations.explore_clear_history_message}),onConfirm:function(){return handleDeleteAll();},onConfirmText:intl.formatMessage({id:ETranslations.explore_remove_all})});}}),_jsx(Divider,{vertical:true,mx:\"$3\"})]}):null,_jsx(Button,{variant:\"tertiary\",size:\"medium\",onPress:function(){return setIsEditing(function(prev){return!prev;});},children:isEditing?intl.formatMessage({id:ETranslations.global_done}):intl.formatMessage({id:ETranslations.global_edit})})]});},[handleDeleteAll,isEditing,intl]);var keyExtractor=useCallback(function(item){return item.id;},[]);return _jsxs(Page,{scrollEnabled:true,\"data-sentry-element\":\"Page\",\"data-sentry-component\":\"HistoryListModal\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/pages/HistoryListModal/index.tsx\",children:[_jsx(Page.Header,{title:intl.formatMessage({id:ETranslations.explore_history}),headerRight:headerRight,\"data-sentry-element\":\"unknown\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/pages/HistoryListModal/index.tsx\"}),_jsx(Page.Body,{\"data-sentry-element\":\"unknown\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/pages/HistoryListModal/index.tsx\",children:_jsx(SectionList,{testID:\"History-SectionList\",height:\"100%\",ListEmptyComponent:_jsx(Empty,{py:\"$32\",my:\"$4\",icon:\"ClockTimeHistoryOutline\",title:intl.formatMessage({id:ETranslations.explore_no_history})}),estimatedItemSize:\"$16\",extraData:isEditing,sections:_isNil(dataSource)?[]:dataSource,renderSectionHeader:function({section:{title}}){return _jsx(SectionList.SectionHeader,{title:title});},keyExtractor:keyExtractor,renderItem:function({item}){return _jsx(ListItem,_objectSpread(_objectSpread({renderAvatar:_jsx(DiscoveryIcon,{uri:item.logo,size:\"$10\"}),title:item.title,titleProps:{numberOfLines:1},subtitle:item.url,subtitleProps:{numberOfLines:1},testID:`search-modal-${item.url.toLowerCase()}`},!isEditing&&{onPress:function(){handleOpenWebSite({switchToMultiTabBrowser:gtMd,navigation,webSite:{url:item.url,title:item.title}});defaultLogger.discovery.dapp.enterDapp({dappDomain:item.url,dappName:item.title,enterMethod:EEnterMethod.history});}}),{},{children:isEditing?_jsx(ListItem.IconButton,{icon:\"DeleteOutline\",onPress:function(){void removeBrowserHistory(item.id);removeHistoryFlagRef.current=true;setTimeout(function(){void run();},200);Toast.success({title:intl.formatMessage({id:ETranslations.explore_removed_success})});}}):null}),item.id);},onEndReached:function(){setPage(function(prev){return prev+1;});},\"data-sentry-element\":\"SectionList\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Discovery/pages/HistoryListModal/index.tsx\"})})]});}export default withBrowserProvider(HistoryListModal);"],"names":["DiscoveryIcon","memo","BasicDiscoveryIcon","uri","size","borderRadius","Image","borderWidth","hairlineWidth","borderColor","borderCurve","children","Source","source","decodeURIComponent","Fallback","Stack","bg","ai","jc","width","height","Icon","name","Loading","Skeleton","radius","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","HistoryListModal","isEditing","setIsEditing","useState","intl","navigation","removeBrowserHistory","removeAllBrowserHistory","current","gtMd","useMedia","handleOpenWebSite","page","setPage","result","dataSource","run","ret","groupDataByDate","data","groups","reduce","item","date","Date","createdAt","map","key","title","serviceDiscovery","fetchHistoryData","watchLoading","removeHistoryFlagRef","useRef","handleDeleteAll","useCallback","setTimeout","useEffect","pop","headerRight","XStack","IconButton","variant","icon","formatMessage","id","ETranslations","explore_remove_all","onPress","Dialog","show","explore_clear_history_prompt","description","explore_clear_history_message","onConfirm","onConfirmText","Divider","vertical","mx","Button","prev","global_done","global_edit","keyExtractor","Page","scrollEnabled","Header","explore_history","Body","SectionList","testID","ListEmptyComponent","Empty","py","my","explore_no_history","estimatedItemSize","extraData","sections","renderSectionHeader","section","SectionHeader","renderItem","renderAvatar","logo","titleProps","numberOfLines","subtitle","url","subtitleProps","toLowerCase","switchToMultiTabBrowser","webSite","discovery","dapp","enterDapp","dappDomain","dappName","enterMethod","history","Toast","success","explore_removed_success","onEndReached"],"sourceRoot":""}