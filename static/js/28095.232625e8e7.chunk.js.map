{"version":3,"file":"static/js/28095.232625e8e7.chunk.js","mappings":"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","sources":["webpack://web/../../packages/kit/src/views/CloudBackup/components/BackupDeviceList.tsx","webpack://web/../../packages/kit/src/views/CloudBackup/components/BackupListLoading.tsx","webpack://web/../../packages/kit/src/views/CloudBackup/components/useBackupToggleDialog.tsx","webpack://web/../../packages/kit/src/views/CloudBackup/pages/Home/index.tsx"],"sourcesContent":["import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";var _excluded=[\"ListEmptyComponent\"];function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}import{useEffect,useMemo}from'react';import{deviceName,osName}from'expo-device';import{useIntl}from'react-intl';import{Icon,SectionList,SizableText,Stack,XStack}from'@onekeyhq/components';import backgroundApiProxy from'@onekeyhq/kit/src/background/instance/backgroundApiProxy';import{ListItem}from'@onekeyhq/kit/src/components/ListItem';import useAppNavigation from'@onekeyhq/kit/src/hooks/useAppNavigation';import{usePromiseResult}from'@onekeyhq/kit/src/hooks/usePromiseResult';import{useRouteIsFocused as useIsFocused}from'@onekeyhq/kit/src/hooks/useRouteIsFocused';import{useCloudBackupPersistAtom}from'@onekeyhq/kit-bg/src/states/jotai/atoms';import{ETranslations}from'@onekeyhq/shared/src/locale';import{ECloudBackupRoutes,EModalRoutes}from'@onekeyhq/shared/src/routes';import{formatDate}from'@onekeyhq/shared/src/utils/dateUtils';import BackupListLoading from\"./BackupListLoading\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function BackupDeviceList(_ref){var _data$length;var{ListEmptyComponent}=_ref,restProps=_objectWithoutProperties(_ref,_excluded);var intl=useIntl();var[{isEnabled,isInProgress}]=useCloudBackupPersistAtom();var navigation=useAppNavigation();var iconList=useMemo(function(){return{'iOS':'PhoneOutline','Android':'PhoneOutline','iPadOS':'SuqarePlaceholderOutline'};},[]);var{result:data,run}=usePromiseResult(_asyncToGenerator(function*(){var backupDeviceList=yield backgroundApiProxy.serviceCloudBackup.getBackupDeviceList();return!ListEmptyComponent&&!isEnabled?[]:backupDeviceList.map(function(item){return{deviceName:item.deviceInfo.deviceName,osName:item.deviceInfo.osName,detail:intl.formatMessage({id:ETranslations.backup_updated_time},{time:formatDate(new Date(item.backupTime))}),icon:item.deviceInfo.osName in iconList?iconList[item.deviceInfo.osName]:'SuqarePlaceholderOutline',isCurrentDevice:item.deviceInfo.deviceName===deviceName&&item.deviceInfo.osName===osName};});}),[intl,iconList,ListEmptyComponent,isEnabled]);var hasData=((_data$length=data?.length)!=null?_data$length:0)>0;var isFocused=useIsFocused();useEffect(function(){if(isInProgress){return;}if(isFocused){void run();}},[isInProgress,isFocused,run,isEnabled]);if(!data){return _jsx(BackupListLoading,{});}return _jsx(SectionList,_objectSpread(_objectSpread({sections:hasData?[{data}]:[],renderSectionHeader:function(){return!ListEmptyComponent&&!isEnabled?null:_jsx(SectionList.SectionHeader,{mt:\"$5\",title:intl.formatMessage({id:ETranslations.backup_all_devices})});},renderItem:function({item}){return _jsx(ListItem,{onPress:function(){navigation.pushModal(EModalRoutes.CloudBackupModal,{screen:ECloudBackupRoutes.CloudBackupList,params:{deviceInfo:item}});},renderItemText:function(textProps){return _jsx(ListItem.Text,_objectSpread(_objectSpread({},textProps),{},{primary:_jsxs(XStack,{alignItems:\"center\",children:[_jsx(SizableText,{size:\"$bodyLgMedium\",children:item.deviceName}),item.isCurrentDevice?_jsx(Stack,{ml:\"$1\",bg:\"$bgInfo\",px:\"$2\",py:\"$0.5\",borderRadius:\"$1\",children:_jsx(SizableText,{size:\"$bodySmMedium\",color:\"$textInfo\",children:intl.formatMessage({id:ETranslations.global_current})})}):null]})}));},subtitle:item.detail,icon:item.icon,iconProps:{bg:'$bgStrong',p:'$5'},renderIcon:_jsx(Stack,{bg:\"$bgStrong\",p:\"$2\",borderRadius:\"$3\",children:_jsx(Icon,{name:item.icon,size:\"$6\",color:\"$icon\"})}),drillIn:true});},estimatedItemSize:\"$16\",ListFooterComponent:!hasData&&ListEmptyComponent?null:_jsx(SizableText,{size:\"$bodySm\",color:\"$textSubdued\",px:\"$5\",pt:\"$3\",children:intl.formatMessage({id:ETranslations.backup_onekey_doesnt_back_up_hardware_wallets})}),ListEmptyComponent:ListEmptyComponent},restProps),{},{\"data-sentry-element\":\"SectionList\",\"data-sentry-component\":\"BackupDeviceList\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/components/BackupDeviceList.tsx\"}));}","import{Skeleton,Stack}from'@onekeyhq/components';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function BackupListLoading(){return _jsxs(Stack,{flex:1,px:\"$5\",gap:\"$2\",pt:\"$5\",\"data-sentry-element\":\"Stack\",\"data-sentry-component\":\"BackupListLoading\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/components/BackupListLoading.tsx\",children:[_jsx(Skeleton,{h:\"$6\",w:\"70%\",\"data-sentry-element\":\"Skeleton\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/components/BackupListLoading.tsx\"}),_jsx(Skeleton,{h:\"$6\",w:\"100%\",\"data-sentry-element\":\"Skeleton\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/components/BackupListLoading.tsx\"}),_jsx(Skeleton,{h:\"$6\",w:\"70%\",\"data-sentry-element\":\"Skeleton\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/components/BackupListLoading.tsx\"}),_jsx(Skeleton,{h:\"$6\",w:\"100%\",\"data-sentry-element\":\"Skeleton\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/components/BackupListLoading.tsx\"})]});}","import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}import{useCallback,useMemo,useState}from'react';import{useIntl}from'react-intl';import{Dialog}from'@onekeyhq/components';import backgroundApiProxy from'@onekeyhq/kit/src/background/instance/backgroundApiProxy';import{cloudBackupPersistAtom}from'@onekeyhq/kit-bg/src/states/jotai/atoms';import{ETranslations}from'@onekeyhq/shared/src/locale';import platformEnv from'@onekeyhq/shared/src/platformEnv';import timerUtils from'@onekeyhq/shared/src/utils/timerUtils';import{useBackupEntryStatus}from\"./useBackupEntryStatus\";import{jsx as _jsx}from\"react/jsx-runtime\";function useBackupToggleAction(){var backupEntryStatus=useBackupEntryStatus();var toggle=useCallback(function(){var _ref=_asyncToGenerator(function*(willIsEnabled,callback){if(willIsEnabled){yield backupEntryStatus.check();}yield cloudBackupPersistAtom.set(_objectSpread(_objectSpread({},yield cloudBackupPersistAtom.get()),{},{isEnabled:willIsEnabled},willIsEnabled?{isFirstEnabled:false,isInProgress:true}:{isFirstDisabled:false,isInProgress:false}));if(!willIsEnabled&&platformEnv.isNativeAndroid){yield backgroundApiProxy.serviceCloudBackup.logoutFromGoogleDrive(true);}callback?.(willIsEnabled);});return function(_x,_x2){return _ref.apply(this,arguments);};}(),[backupEntryStatus]);return useMemo(function(){return{toggle};},[toggle]);}function BackupToggleDialogFooter({willIsEnabled,callback}){var intl=useIntl();var backupToggleAction=useBackupToggleAction();var[loading,setLoading]=useState(false);return _jsx(Dialog.Footer,{confirmButtonProps:{loading},onConfirmText:intl.formatMessage({id:!willIsEnabled?ETranslations.backup_turn_off:ETranslations.backup_turn_on}),onConfirm:_asyncToGenerator(function*(){try{setLoading(true);yield backupToggleAction.toggle(willIsEnabled,callback);yield timerUtils.wait(500);}catch(e){}finally{setLoading(false);}}),\"data-sentry-element\":\"unknown\",\"data-sentry-component\":\"BackupToggleDialogFooter\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/components/useBackupToggleDialog.tsx\"});}export function useBackupToggleDialog(){var intl=useIntl();var backupToggleAction=useBackupToggleAction();var maybeShow=useCallback(function(){var _ref3=_asyncToGenerator(function*(willIsEnabled){if(!false){return;}var cloudBackupValueList=yield cloudBackupPersistAtom.get();if(willIsEnabled===cloudBackupValueList.isEnabled){return;}if(willIsEnabled&&!cloudBackupValueList.isFirstEnabled||!willIsEnabled&&!cloudBackupValueList.isFirstDisabled){yield backupToggleAction.toggle(willIsEnabled);return;}return new Promise(function(resolve){Dialog.show({icon:'CloudSyncOutline',title:intl.formatMessage({id:platformEnv.isNativeAndroid?ETranslations.settings_google_drive_backup:ETranslations.settings_icloud_backup}),description:intl.formatMessage({id:platformEnv.isNativeAndroid?ETranslations.backup_google_drive_securely_syncs_data:ETranslations.backup_icloud_backup_securely_syncs_your_data}),renderContent:_jsx(BackupToggleDialogFooter,{willIsEnabled:willIsEnabled,callback:resolve})});});});return function(_x3){return _ref3.apply(this,arguments);};}(),[intl,backupToggleAction]);return useMemo(function(){return{maybeShow};},[maybeShow]);}","import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import{useCallback,useState}from'react';import{useIntl}from'react-intl';import{Button,Divider,Page,Stack,Switch,Toast}from'@onekeyhq/components';import backgroundApiProxy from'@onekeyhq/kit/src/background/instance/backgroundApiProxy';import{ListItem}from'@onekeyhq/kit/src/components/ListItem';import useAppNavigation from'@onekeyhq/kit/src/hooks/useAppNavigation';import{useCloudBackupPersistAtom}from'@onekeyhq/kit-bg/src/states/jotai/atoms';import{ETranslations}from'@onekeyhq/shared/src/locale';import{defaultLogger}from'@onekeyhq/shared/src/logger/logger';import platformEnv from'@onekeyhq/shared/src/platformEnv';import BackupDeviceList from\"../../components/BackupDeviceList\";import{useBackupToggleDialog}from\"../../components/useBackupToggleDialog\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Home(){var intl=useIntl();var backupToggleDialog=useBackupToggleDialog();var[{isEnabled,isInProgress}]=useCloudBackupPersistAtom();var[submitError,setSubmitError]=useState('');var navigation=useAppNavigation();var backupNowOnPress=useCallback(_asyncToGenerator(function*(){yield backupToggleDialog.maybeShow(true);setSubmitError('');try{yield backgroundApiProxy.serviceCloudBackup.backupNow();}catch(e){var _e$message;setSubmitError('Sync failed, please retry.');Toast.error({title:`${(_e$message=e?.message)!=null?_e$message:e}`});}defaultLogger.setting.page.backup({backupMethod:platformEnv.isNativeAndroid?'Google':'iCloud'});}),[backupToggleDialog]);var renderBackupStatus=useCallback(function(){if(isInProgress){return _jsx(Button,{disabled:true,bg:\"transparent\",p:\"0\",loading:true,children:intl.formatMessage({id:ETranslations.global_syncing})});}if(submitError){return _jsx(Button,{disabled:true,bg:\"transparent\",p:\"0\",icon:\"XCircleSolid\",iconColor:\"$iconCritical\",children:intl.formatMessage({id:ETranslations.global_sync_error})});}return _jsx(Button,{disabled:true,bg:\"transparent\",p:\"0\",icon:\"CheckRadioSolid\",iconColor:\"$iconSuccess\",children:intl.formatMessage({id:ETranslations.global_synced})});},[intl,isInProgress,submitError]);return _jsxs(Page,{\"data-sentry-element\":\"Page\",\"data-sentry-component\":\"Home\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/pages/Home/index.tsx\",children:[_jsx(Page.Header,{title:intl.formatMessage({id:platformEnv.isNativeAndroid?ETranslations.settings_google_drive_backup:ETranslations.settings_icloud_backup}),\"data-sentry-element\":\"unknown\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/pages/Home/index.tsx\"}),_jsxs(Page.Body,{\"data-sentry-element\":\"unknown\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/pages/Home/index.tsx\",children:[_jsx(BackupDeviceList,{ListHeaderComponent:_jsxs(_Fragment,{children:[_jsx(ListItem,{title:intl.formatMessage({id:platformEnv.isNativeAndroid?ETranslations.backup_backup_to_google_drive:ETranslations.backup_backup_to_icloud}),children:_jsx(Stack,{pointerEvents:\"box-only\",onPress:_asyncToGenerator(function*(){yield backupToggleDialog.maybeShow(!isEnabled);if(!isEnabled){yield backupNowOnPress();}else if(platformEnv.isNativeAndroid){navigation.pop();}}),children:_jsx(Switch,{value:isEnabled})})}),isEnabled?_jsx(ListItem,{pt:\"$3\",title:intl.formatMessage({id:platformEnv.isNativeAndroid?ETranslations.backup_google_drive_status:ETranslations.backup_icloud_status}),children:renderBackupStatus()}):null,_jsx(Divider,{pt:\"$6\"})]}),\"data-sentry-element\":\"BackupDeviceList\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/pages/Home/index.tsx\"}),_jsx(Stack,{m:\"$5\",\"data-sentry-element\":\"Stack\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/pages/Home/index.tsx\",children:_jsx(Button,{mt:\"$4\",borderRadius:\"$3\",py:\"$3\",disabled:isInProgress,onPress:backupNowOnPress,\"data-sentry-element\":\"Button\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/CloudBackup/pages/Home/index.tsx\",children:intl.formatMessage({id:ETranslations.backup_backup_now})})})]})]});}"],"names":["_excluded","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","defineProperty","BackupDeviceList","_ref","_data$length","ListEmptyComponent","restProps","intl","isEnabled","isInProgress","useCloudBackupPersistAtom","navigation","iconList","useMemo","result","data","run","backupDeviceList","serviceCloudBackup","getBackupDeviceList","map","item","deviceName","deviceInfo","osName","detail","formatMessage","id","ETranslations","backup_updated_time","time","Date","backupTime","icon","isCurrentDevice","hasData","isFocused","useEffect","SectionList","sections","renderSectionHeader","SectionHeader","mt","title","backup_all_devices","renderItem","onPress","pushModal","CloudBackupModal","screen","CloudBackupList","params","renderItemText","textProps","Text","primary","XStack","alignItems","children","SizableText","size","Stack","ml","bg","px","py","borderRadius","color","global_current","subtitle","iconProps","p","renderIcon","Icon","name","drillIn","estimatedItemSize","ListFooterComponent","pt","backup_onekey_doesnt_back_up_hardware_wallets","BackupListLoading","flex","gap","Skeleton","h","w","useBackupToggleAction","backupEntryStatus","useBackupEntryStatus","toggle","useCallback","willIsEnabled","callback","check","cloudBackupPersistAtom","set","get","isFirstEnabled","isFirstDisabled","platformEnv","isNativeAndroid","backgroundApiProxy","logoutFromGoogleDrive","_x","_x2","this","Home","useIntl","backupToggleDialog","useBackupToggleDialog","_ref3","backupToggleAction","maybeShow","_x3","submitError","setSubmitError","useState","useAppNavigation","backupNowOnPress","backupNow","_e$message","Toast","error","message","setting","page","backup","backupMethod","renderBackupStatus","Button","disabled","loading","global_syncing","iconColor","global_sync_error","global_synced","Page","Header","settings_google_drive_backup","settings_icloud_backup","Body","ListHeaderComponent","ListItem","backup_backup_to_google_drive","backup_backup_to_icloud","pointerEvents","pop","Switch","value","backup_google_drive_status","backup_icloud_status","Divider","m","backup_backup_now"],"sourceRoot":""}