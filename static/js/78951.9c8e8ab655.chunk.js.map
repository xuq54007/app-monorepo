{"version":3,"file":"static/js/78951.9c8e8ab655.chunk.js","mappings":"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","sources":["webpack://web/../../packages/kit/src/hooks/useAppRoute.ts","webpack://web/../../packages/kit/src/views/Home/pages/urlAccount/UrlAccountAutoReplaceHistory.tsx","webpack://web/../../packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx"],"sourcesContent":["import{useRoute}from'@react-navigation/core';export function useAppRoute(){return useRoute();}","import{useCallback,useEffect,useRef}from'react';import{usePrevious}from'@onekeyhq/kit/src/hooks/usePrevious';import{useRouteIsFocused as useIsFocused}from'@onekeyhq/kit/src/hooks/useRouteIsFocused';import{useAccountSelectorSceneInfo,useActiveAccount,useSelectedAccount}from'@onekeyhq/kit/src/states/jotai/contexts/accountSelector';import platformEnv from'@onekeyhq/shared/src/platformEnv';import{EAccountSelectorSceneName}from'@onekeyhq/shared/types';import{replaceUrlAccountLandingRoute}from\"./urlAccountUtils\";export function UrlAccountAutoReplaceHistory({num}){var isFocused=useIsFocused();var isFocusedRef=useRef(isFocused);isFocusedRef.current=isFocused;var{activeAccount}=useActiveAccount({num});var{selectedAccount}=useSelectedAccount({num});var{sceneName}=useAccountSelectorSceneInfo();var accountRef=useRef(activeAccount?.account);accountRef.current=activeAccount?.account;var address=activeAccount?.account?.address;var networkId=activeAccount?.network?.id;var networkCode=activeAccount?.network?.code;var selectedAccountId=`${selectedAccount?.walletId||''}-${selectedAccount?.indexedAccountId||''}-${selectedAccount?.othersWalletAccountId||''}`;var selectedAccountIdPrev=usePrevious(selectedAccountId);var shouldReplaceUrlInDelay=useRef(true);if(selectedAccountIdPrev!==selectedAccountId){shouldReplaceUrlInDelay.current=false;}var timerRef=useRef();var replaceUrl=useCallback(function({delay}){if(sceneName===EAccountSelectorSceneName.homeUrlAccount&&true&&isFocusedRef.current){timerRef.current=setTimeout(function(){void replaceUrlAccountLandingRoute({account:accountRef.current,networkId,address});},delay);}},[address,networkId,sceneName]);useEffect(function(){replaceUrl({delay:0});shouldReplaceUrlInDelay.current=true;},[replaceUrl]);useEffect(function(){var timer;if(isFocused){if(shouldReplaceUrlInDelay.current){replaceUrl({delay:100});}else{timer=setTimeout(function(){shouldReplaceUrlInDelay.current=true;},1000);}}return function(){clearTimeout(timer);};},[isFocused,replaceUrl]);return null;}","import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import _cloneDeep from\"lodash/cloneDeep\";import{useCallback,useEffect,useMemo,useRef,useState}from'react';import{useIntl}from'react-intl';import{NavBackButton,Page,SizableText,Spinner,Stack}from'@onekeyhq/components';import backgroundApiProxy from'@onekeyhq/kit/src/background/instance/backgroundApiProxy';import{AccountSelectorProviderMirror}from'@onekeyhq/kit/src/components/AccountSelector';import useAppNavigation from'@onekeyhq/kit/src/hooks/useAppNavigation';import{useAppRoute}from'@onekeyhq/kit/src/hooks/useAppRoute';import{ProviderJotaiContextAccountOverview}from'@onekeyhq/kit/src/states/jotai/contexts/accountOverview';import{useAccountSelectorActions,useSelectedAccount}from'@onekeyhq/kit/src/states/jotai/contexts/accountSelector';import{WALLET_TYPE_WATCHING}from'@onekeyhq/shared/src/consts/dbConsts';import errorToastUtils from'@onekeyhq/shared/src/errors/utils/errorToastUtils';import{ETranslations}from'@onekeyhq/shared/src/locale';import platformEnv from'@onekeyhq/shared/src/platformEnv';import accountUtils from'@onekeyhq/shared/src/utils/accountUtils';import{useDebugComponentRemountLog}from'@onekeyhq/shared/src/utils/debug/debugUtils';import timerUtils from'@onekeyhq/shared/src/utils/timerUtils';import{EAccountSelectorSceneName}from'@onekeyhq/shared/types';import{EUniversalSearchType}from'@onekeyhq/shared/types/search';import{HomePageView}from\"../HomePageView\";import{UrlAccountAutoReplaceHistory}from\"./UrlAccountAutoReplaceHistory\";import{getPrevUrlAccount,urlAccountNavigation}from\"./urlAccountUtils\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var sceneName=EAccountSelectorSceneName.homeUrlAccount;function UrlAccountPage(){return _jsxs(_Fragment,{children:[_jsx(HomePageView,{sceneName:sceneName,\"data-sentry-element\":\"HomePageView\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx\"},sceneName),_jsx(UrlAccountAutoReplaceHistory,{num:0,\"data-sentry-element\":\"UrlAccountAutoReplaceHistory\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx\"})]});}function UrlAccountAutoCreate({redirectMode}){var intl=useIntl();var route=useAppRoute();var navigation=useAppNavigation();var routeParams=route.params;var actions=useAccountSelectorActions();var[urlAccountStatus,setUrlAccountStatus]=useState();var routeParamsRef=useRef(routeParams);routeParamsRef.current=routeParams;var routePathRef=useRef(route.path);routePathRef.current=route.path;var{selectedAccount}=useSelectedAccount({num:0});var isCurrentSelectedAccountNotUrlAccount=useMemo(function(){if(selectedAccount.indexedAccountId&&!selectedAccount?.othersWalletAccountId){return true;}if(selectedAccount?.othersWalletAccountId&&!accountUtils.isUrlAccountFn({accountId:selectedAccount?.othersWalletAccountId})){return true;}return false;},[selectedAccount.indexedAccountId,selectedAccount?.othersWalletAccountId]);useEffect(function(){if(!false&&false&&routePathRef.current==='/index.html'){var newRouteParams=_cloneDeep(routeParamsRef.current);if(newRouteParams&&newRouteParams?.networkId==='index.html'){delete newRouteParams.networkId;}urlAccountNavigation.replaceHomePage(navigation,newRouteParams);return;}setTimeout(_asyncToGenerator(function*(){var networkId=routeParamsRef.current?.networkId;var networkCode=routeParamsRef.current?.networkId;var routeAddress=routeParamsRef.current?.address;var fixNetworkParams=function(network){if(network){networkId=network.id;networkCode=network.code;}};if(!routeAddress&&networkId){routeAddress=networkId;networkId=undefined;networkCode=undefined;var result=yield backgroundApiProxy.serviceUniversalSearch.universalSearch({input:routeAddress,searchTypes:[EUniversalSearchType.Address]});var firstAddressItemPayload=result?.[EUniversalSearchType.Address]?.items?.[0]?.payload;if(firstAddressItemPayload){var{network:_network}=firstAddressItemPayload;fixNetworkParams(_network);}}var hasError=false;var network=yield backgroundApiProxy.serviceNetwork.getNetworkSafe({code:networkCode});if(network){fixNetworkParams(network);}else{network=yield backgroundApiProxy.serviceNetwork.getNetworkSafe({networkId});if(network){fixNetworkParams(network);}}if(!networkId||!routeAddress){hasError=true;}var prevAccount=getPrevUrlAccount();var urlAccountInDb=yield backgroundApiProxy.serviceAccount.getUrlDBAccountSafe();if(networkId&&routeAddress&&(!urlAccountInDb||routeAddress?.toLowerCase()!==prevAccount?.address?.toLowerCase()||networkId!==prevAccount?.networkId||isCurrentSelectedAccountNotUrlAccount)){try{var r=yield backgroundApiProxy.serviceAccount.addWatchingAccount({input:routeAddress,networkId,deriveType:undefined,isUrlAccount:true});var updateSelectedAccount=function(){var _ref2=_asyncToGenerator(function*(){return actions.current.updateSelectedAccountForSingletonAccount({num:0,networkId,walletId:WALLET_TYPE_WATCHING,othersWalletAccountId:r?.accounts?.[0]?.id});});return function updateSelectedAccount(){return _ref2.apply(this,arguments);};}();yield updateSelectedAccount();setTimeout(function(){void updateSelectedAccount();},600);}catch(error){errorToastUtils.toastIfErrorDisable(error);hasError=true;}}if(hasError){setUrlAccountStatus('invalid');}else{setUrlAccountStatus('ok');if(redirectMode){urlAccountNavigation.replaceHomePage(navigation);if(routeAddress){yield timerUtils.wait(1);yield urlAccountNavigation.pushUrlAccountPage(navigation,{address:routeAddress,networkId:networkCode});}}}}),0);},[intl,actions,navigation,redirectMode,isCurrentSelectedAccountNotUrlAccount]);var backToHomePage=useCallback(function(){urlAccountNavigation.replaceHomePage(navigation);},[navigation]);var renderHeaderLeft=useCallback(function(){return _jsx(NavBackButton,{onPress:backToHomePage});},[backToHomePage]);if(urlAccountStatus==='invalid'){return _jsxs(Page,{children:[_jsx(Page.Header,{headerLeft:renderHeaderLeft}),_jsxs(Stack,{flex:1,ai:\"center\",jc:\"center\",children:[_jsx(SizableText,{size:\"$headingXl\",children:intl.formatMessage({id:ETranslations.global_404_message})}),\"production\"!=='production'?_jsx(SizableText,{my:\"$6\",children:JSON.stringify(routeParams)}):null]})]});}if(urlAccountStatus==='ok'&&!redirectMode){return _jsx(UrlAccountPage,{});}return _jsx(Stack,{flex:1,alignContent:\"center\",justifyContent:\"center\",\"data-sentry-element\":\"Stack\",\"data-sentry-component\":\"UrlAccountAutoCreate\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx\",children:_jsx(Spinner,{size:\"small\",\"data-sentry-element\":\"Spinner\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx\"})});}export function UrlAccountPageContainer(){useDebugComponentRemountLog({name:'URLAccountMount:  UrlAccountPageContainer'});return _jsx(ProviderJotaiContextAccountOverview,{\"data-sentry-element\":\"ProviderJotaiContextAccountOverview\",\"data-sentry-component\":\"UrlAccountPageContainer\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx\",children:_jsx(AccountSelectorProviderMirror,{config:{sceneName,sceneUrl:''},enabledNum:[0],\"data-sentry-element\":\"AccountSelectorProviderMirror\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx\",children:_jsx(UrlAccountAutoCreate,{\"data-sentry-element\":\"UrlAccountAutoCreate\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx\"})})});}export function UrlAccountLanding(){useDebugComponentRemountLog({name:'URLAccountMount:  UrlAccountLanding'});return _jsx(ProviderJotaiContextAccountOverview,{\"data-sentry-element\":\"ProviderJotaiContextAccountOverview\",\"data-sentry-component\":\"UrlAccountLanding\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx\",children:_jsx(AccountSelectorProviderMirror,{config:{sceneName,sceneUrl:''},enabledNum:[0],\"data-sentry-element\":\"AccountSelectorProviderMirror\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx\",children:_jsx(UrlAccountAutoCreate,{redirectMode:true,\"data-sentry-element\":\"UrlAccountAutoCreate\",\"data-sentry-source-file\":\"/home/runner/work/app-monorepo/app-monorepo/packages/kit/src/views/Home/pages/urlAccount/UrlAccountPage.tsx\"})})});}"],"names":["useAppRoute","UrlAccountAutoReplaceHistory","num","isFocused","isFocusedRef","useRef","current","activeAccount","selectedAccount","sceneName","accountRef","account","address","networkId","network","id","selectedAccountId","walletId","indexedAccountId","othersWalletAccountId","selectedAccountIdPrev","usePrevious","shouldReplaceUrlInDelay","timerRef","replaceUrl","useCallback","delay","homeUrlAccount","setTimeout","useEffect","timer","clearTimeout","UrlAccountPage","children","HomePageView","UrlAccountAutoCreate","redirectMode","intl","useIntl","route","u","navigation","useAppNavigation","routeParams","params","actions","urlAccountStatus","setUrlAccountStatus","useState","routeParamsRef","path","isCurrentSelectedAccountNotUrlAccount","useMemo","accountUtils","isUrlAccountFn","accountId","networkCode","routeAddress","fixNetworkParams","code","undefined","result","backgroundApiProxy","serviceUniversalSearch","universalSearch","input","searchTypes","Address","firstAddressItemPayload","items","payload","_network","hasError","serviceNetwork","getNetworkSafe","_ref2","prevAccount","urlAccountInDb","serviceAccount","getUrlDBAccountSafe","toLowerCase","r","addWatchingAccount","deriveType","isUrlAccount","updateSelectedAccount","updateSelectedAccountForSingletonAccount","accounts","apply","this","arguments","error","errorToastUtils","toastIfErrorDisable","replaceHomePage","timerUtils","wait","pushUrlAccountPage","backToHomePage","renderHeaderLeft","NavBackButton","onPress","Page","Header","headerLeft","Stack","flex","ai","jc","SizableText","size","formatMessage","ETranslations","global_404_message","alignContent","justifyContent","Spinner","UrlAccountPageContainer","name","AccountSelector","config","sceneUrl","enabledNum","UrlAccountLanding"],"sourceRoot":""}