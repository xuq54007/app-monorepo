/*! For license information please see 39430.d7890c7883.chunk.js.LICENSE.txt */
!function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(new t.Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="61f7879a-c498-448a-9f52-9e48722cc799",t._sentryDebugIdIdentifier="sentry-dbid-61f7879a-c498-448a-9f52-9e48722cc799")}catch(t){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"5.5.0 (2024121652)"},(self.webpackChunkweb=self.webpackChunkweb||[]).push([[39430],{464070:(t,e,r)=>{var n;t=r.nmd(t);var i=function(t){"use strict";var e=1e7,r=7,n=9007199254740992,o=smallToArray(n),s="0123456789abcdefghijklmnopqrstuvwxyz",a="function"==typeof BigInt;function Integer(t,e,r,n){return void 0===t?Integer[0]:void 0!==e&&(10!=+e||r)?parseBase(t,e,r,n):parseValue(t)}function BigInteger(t,e){this.value=t,this.sign=e,this.isSmall=!1}function SmallInteger(t){this.value=t,this.sign=t<0,this.isSmall=!0}function NativeBigInt(t){this.value=t}function isPrecise(t){return-n<t&&t<n}function smallToArray(t){return t<1e7?[t]:t<1e14?[t%1e7,Math.floor(t/1e7)]:[t%1e7,Math.floor(t/1e7)%1e7,Math.floor(t/1e14)]}function arrayToSmall(t){trim(t);var r=t.length;if(r<4&&compareAbs(t,o)<0)switch(r){case 0:return 0;case 1:return t[0];case 2:return t[0]+t[1]*e;default:return t[0]+(t[1]+t[2]*e)*e}return t}function trim(t){for(var e=t.length;0===t[--e];);t.length=e+1}function createArray(t){for(var e=new Array(t),r=-1;++r<t;)e[r]=0;return e}function truncate(t){return t>0?Math.floor(t):Math.ceil(t)}function add(t,r){var n,i,o=t.length,s=r.length,a=new Array(o),u=0,p=e;for(i=0;i<s;i++)u=(n=t[i]+r[i]+u)>=p?1:0,a[i]=n-u*p;for(;i<o;)u=(n=t[i]+u)===p?1:0,a[i++]=n-u*p;return u>0&&a.push(u),a}function addAny(t,e){return t.length>=e.length?add(t,e):add(e,t)}function addSmall(t,r){var n,i,o=t.length,s=new Array(o),a=e;for(i=0;i<o;i++)n=t[i]-a+r,r=Math.floor(n/a),s[i]=n-r*a,r+=1;for(;r>0;)s[i++]=r%a,r=Math.floor(r/a);return s}function subtract(t,r){var n,i,o=t.length,s=r.length,a=new Array(o),u=0,p=e;for(n=0;n<s;n++)(i=t[n]-u-r[n])<0?(i+=p,u=1):u=0,a[n]=i;for(n=s;n<o;n++){if(!((i=t[n]-u)<0)){a[n++]=i;break}i+=p,a[n]=i}for(;n<o;n++)a[n]=t[n];return trim(a),a}function subtractSmall(t,r,n){var i,o,s=t.length,a=new Array(s),u=-r,p=e;for(i=0;i<s;i++)o=t[i]+u,u=Math.floor(o/p),o%=p,a[i]=o<0?o+p:o;return"number"==typeof(a=arrayToSmall(a))?(n&&(a=-a),new SmallInteger(a)):new BigInteger(a,n)}function multiplyLong(t,r){var n,i,o,s,a=t.length,u=r.length,p=createArray(a+u),l=e;for(o=0;o<a;++o){s=t[o];for(var c=0;c<u;++c)n=s*r[c]+p[o+c],i=Math.floor(n/l),p[o+c]=n-i*l,p[o+c+1]+=i}return trim(p),p}function multiplySmall(t,r){var n,i,o=t.length,s=new Array(o),a=e,u=0;for(i=0;i<o;i++)n=t[i]*r+u,u=Math.floor(n/a),s[i]=n-u*a;for(;u>0;)s[i++]=u%a,u=Math.floor(u/a);return s}function shiftLeft(t,e){for(var r=[];e-- >0;)r.push(0);return r.concat(t)}function multiplyKaratsuba(t,e){var r=Math.max(t.length,e.length);if(r<=30)return multiplyLong(t,e);r=Math.ceil(r/2);var n=t.slice(r),i=t.slice(0,r),o=e.slice(r),s=e.slice(0,r),a=multiplyKaratsuba(i,s),u=multiplyKaratsuba(n,o),p=multiplyKaratsuba(addAny(i,n),addAny(s,o)),l=addAny(addAny(a,shiftLeft(subtract(subtract(p,a),u),r)),shiftLeft(u,2*r));return trim(l),l}function multiplySmallAndArray(t,r,n){return new BigInteger(t<e?multiplySmall(r,t):multiplyLong(r,smallToArray(t)),n)}function square(t){var r,n,i,o,s=t.length,a=createArray(s+s),u=e;for(i=0;i<s;i++){n=0-(o=t[i])*o;for(var p=i;p<s;p++)r=o*t[p]*2+a[i+p]+n,n=Math.floor(r/u),a[i+p]=r-n*u;a[i+s]=n}return trim(a),a}function divModSmall(t,r){var n,i,o,s,a=t.length,u=createArray(a),p=e;for(o=0,n=a-1;n>=0;--n)o=(s=o*p+t[n])-(i=truncate(s/r))*r,u[n]=0|i;return[u,0|o]}function divModAny(t,r){var n,i=parseValue(r);if(a)return[new NativeBigInt(t.value/i.value),new NativeBigInt(t.value%i.value)];var o,s=t.value,u=i.value;if(0===u)throw new Error("Cannot divide by zero");if(t.isSmall)return i.isSmall?[new SmallInteger(truncate(s/u)),new SmallInteger(s%u)]:[Integer[0],t];if(i.isSmall){if(1===u)return[t,Integer[0]];if(-1==u)return[t.negate(),Integer[0]];var p=Math.abs(u);if(p<e){o=arrayToSmall((n=divModSmall(s,p))[0]);var l=n[1];return t.sign&&(l=-l),"number"==typeof o?(t.sign!==i.sign&&(o=-o),[new SmallInteger(o),new SmallInteger(l)]):[new BigInteger(o,t.sign!==i.sign),new SmallInteger(l)]}u=smallToArray(p)}var c=compareAbs(s,u);if(-1===c)return[Integer[0],t];if(0===c)return[Integer[t.sign===i.sign?1:-1],Integer[0]];n=s.length+u.length<=200?function divMod1(t,r){var n,i,o,s,a,u,p,l=t.length,c=r.length,h=e,f=createArray(r.length),g=r[c-1],d=Math.ceil(h/(2*g)),y=multiplySmall(t,d),m=multiplySmall(r,d);for(y.length<=l&&y.push(0),m.push(0),g=m[c-1],i=l-c;i>=0;i--){for(n=h-1,y[i+c]!==g&&(n=Math.floor((y[i+c]*h+y[i+c-1])/g)),o=0,s=0,u=m.length,a=0;a<u;a++)o+=n*m[a],p=Math.floor(o/h),s+=y[i+a]-(o-p*h),o=p,s<0?(y[i+a]=s+h,s=-1):(y[i+a]=s,s=0);for(;0!==s;){for(n-=1,o=0,a=0;a<u;a++)(o+=y[i+a]-h+m[a])<0?(y[i+a]=o+h,o=0):(y[i+a]=o,o=1);s+=o}f[i]=n}return y=divModSmall(y,d)[0],[arrayToSmall(f),arrayToSmall(y)]}(s,u):function divMod2(t,r){for(var n,i,o,s,a,u=t.length,p=r.length,l=[],c=[],h=e;u;)if(c.unshift(t[--u]),trim(c),compareAbs(c,r)<0)l.push(0);else{o=c[(i=c.length)-1]*h+c[i-2],s=r[p-1]*h+r[p-2],i>p&&(o=(o+1)*h),n=Math.ceil(o/s);do{if(compareAbs(a=multiplySmall(r,n),c)<=0)break;n--}while(n);l.push(n),c=subtract(c,a)}return l.reverse(),[arrayToSmall(l),arrayToSmall(c)]}(s,u),o=n[0];var h=t.sign!==i.sign,f=n[1],g=t.sign;return"number"==typeof o?(h&&(o=-o),o=new SmallInteger(o)):o=new BigInteger(o,h),"number"==typeof f?(g&&(f=-f),f=new SmallInteger(f)):f=new BigInteger(f,g),[o,f]}function compareAbs(t,e){if(t.length!==e.length)return t.length>e.length?1:-1;for(var r=t.length-1;r>=0;r--)if(t[r]!==e[r])return t[r]>e[r]?1:-1;return 0}function isBasicPrime(t){var e=t.abs();return!e.isUnit()&&(!!(e.equals(2)||e.equals(3)||e.equals(5))||!(e.isEven()||e.isDivisibleBy(3)||e.isDivisibleBy(5))&&(!!e.lesser(49)||void 0))}function millerRabinTest(t,e){for(var r,n,o,s=t.prev(),a=s,u=0;a.isEven();)a=a.divide(2),u++;t:for(n=0;n<e.length;n++)if(!t.lesser(e[n])&&!(o=i(e[n]).modPow(a,t)).isUnit()&&!o.equals(s)){for(r=u-1;0!=r;r--){if((o=o.square().mod(t)).isUnit())return!1;if(o.equals(s))continue t}return!1}return!0}BigInteger.prototype=Object.create(Integer.prototype),SmallInteger.prototype=Object.create(Integer.prototype),NativeBigInt.prototype=Object.create(Integer.prototype),BigInteger.prototype.add=function(t){var e=parseValue(t);if(this.sign!==e.sign)return this.subtract(e.negate());var r=this.value,n=e.value;return e.isSmall?new BigInteger(addSmall(r,Math.abs(n)),this.sign):new BigInteger(addAny(r,n),this.sign)},BigInteger.prototype.plus=BigInteger.prototype.add,SmallInteger.prototype.add=function(t){var e=parseValue(t),r=this.value;if(r<0!==e.sign)return this.subtract(e.negate());var n=e.value;if(e.isSmall){if(isPrecise(r+n))return new SmallInteger(r+n);n=smallToArray(Math.abs(n))}return new BigInteger(addSmall(n,Math.abs(r)),r<0)},SmallInteger.prototype.plus=SmallInteger.prototype.add,NativeBigInt.prototype.add=function(t){return new NativeBigInt(this.value+parseValue(t).value)},NativeBigInt.prototype.plus=NativeBigInt.prototype.add,BigInteger.prototype.subtract=function(t){var e=parseValue(t);if(this.sign!==e.sign)return this.add(e.negate());var r=this.value,n=e.value;return e.isSmall?subtractSmall(r,Math.abs(n),this.sign):function subtractAny(t,e,r){var n;return compareAbs(t,e)>=0?n=subtract(t,e):(n=subtract(e,t),r=!r),"number"==typeof(n=arrayToSmall(n))?(r&&(n=-n),new SmallInteger(n)):new BigInteger(n,r)}(r,n,this.sign)},BigInteger.prototype.minus=BigInteger.prototype.subtract,SmallInteger.prototype.subtract=function(t){var e=parseValue(t),r=this.value;if(r<0!==e.sign)return this.add(e.negate());var n=e.value;return e.isSmall?new SmallInteger(r-n):subtractSmall(n,Math.abs(r),r>=0)},SmallInteger.prototype.minus=SmallInteger.prototype.subtract,NativeBigInt.prototype.subtract=function(t){return new NativeBigInt(this.value-parseValue(t).value)},NativeBigInt.prototype.minus=NativeBigInt.prototype.subtract,BigInteger.prototype.negate=function(){return new BigInteger(this.value,!this.sign)},SmallInteger.prototype.negate=function(){var t=this.sign,e=new SmallInteger(-this.value);return e.sign=!t,e},NativeBigInt.prototype.negate=function(){return new NativeBigInt(-this.value)},BigInteger.prototype.abs=function(){return new BigInteger(this.value,!1)},SmallInteger.prototype.abs=function(){return new SmallInteger(Math.abs(this.value))},NativeBigInt.prototype.abs=function(){return new NativeBigInt(this.value>=0?this.value:-this.value)},BigInteger.prototype.multiply=function(t){var r,n=parseValue(t),i=this.value,o=n.value,s=this.sign!==n.sign;if(n.isSmall){if(0===o)return Integer[0];if(1===o)return this;if(-1===o)return this.negate();if((r=Math.abs(o))<e)return new BigInteger(multiplySmall(i,r),s);o=smallToArray(r)}return function useKaratsuba(t,e){return-.012*t-.012*e+15e-6*t*e>0}(i.length,o.length)?new BigInteger(multiplyKaratsuba(i,o),s):new BigInteger(multiplyLong(i,o),s)},BigInteger.prototype.times=BigInteger.prototype.multiply,SmallInteger.prototype._multiplyBySmall=function(t){return isPrecise(t.value*this.value)?new SmallInteger(t.value*this.value):multiplySmallAndArray(Math.abs(t.value),smallToArray(Math.abs(this.value)),this.sign!==t.sign)},BigInteger.prototype._multiplyBySmall=function(t){return 0===t.value?Integer[0]:1===t.value?this:-1===t.value?this.negate():multiplySmallAndArray(Math.abs(t.value),this.value,this.sign!==t.sign)},SmallInteger.prototype.multiply=function(t){return parseValue(t)._multiplyBySmall(this)},SmallInteger.prototype.times=SmallInteger.prototype.multiply,NativeBigInt.prototype.multiply=function(t){return new NativeBigInt(this.value*parseValue(t).value)},NativeBigInt.prototype.times=NativeBigInt.prototype.multiply,BigInteger.prototype.square=function(){return new BigInteger(square(this.value),!1)},SmallInteger.prototype.square=function(){var t=this.value*this.value;return isPrecise(t)?new SmallInteger(t):new BigInteger(square(smallToArray(Math.abs(this.value))),!1)},NativeBigInt.prototype.square=function(t){return new NativeBigInt(this.value*this.value)},BigInteger.prototype.divmod=function(t){var e=divModAny(this,t);return{quotient:e[0],remainder:e[1]}},NativeBigInt.prototype.divmod=SmallInteger.prototype.divmod=BigInteger.prototype.divmod,BigInteger.prototype.divide=function(t){return divModAny(this,t)[0]},NativeBigInt.prototype.over=NativeBigInt.prototype.divide=function(t){return new NativeBigInt(this.value/parseValue(t).value)},SmallInteger.prototype.over=SmallInteger.prototype.divide=BigInteger.prototype.over=BigInteger.prototype.divide,BigInteger.prototype.mod=function(t){return divModAny(this,t)[1]},NativeBigInt.prototype.mod=NativeBigInt.prototype.remainder=function(t){return new NativeBigInt(this.value%parseValue(t).value)},SmallInteger.prototype.remainder=SmallInteger.prototype.mod=BigInteger.prototype.remainder=BigInteger.prototype.mod,BigInteger.prototype.pow=function(t){var e,r,n,i=parseValue(t),o=this.value,s=i.value;if(0===s)return Integer[1];if(0===o)return Integer[0];if(1===o)return Integer[1];if(-1===o)return i.isEven()?Integer[1]:Integer[-1];if(i.sign)return Integer[0];if(!i.isSmall)throw new Error("The exponent "+i.toString()+" is too large.");if(this.isSmall&&isPrecise(e=Math.pow(o,s)))return new SmallInteger(truncate(e));for(r=this,n=Integer[1];!0&s&&(n=n.times(r),--s),0!==s;)s/=2,r=r.square();return n},SmallInteger.prototype.pow=BigInteger.prototype.pow,NativeBigInt.prototype.pow=function(t){var e=parseValue(t),r=this.value,n=e.value,i=BigInt(0),o=BigInt(1),s=BigInt(2);if(n===i)return Integer[1];if(r===i)return Integer[0];if(r===o)return Integer[1];if(r===BigInt(-1))return e.isEven()?Integer[1]:Integer[-1];if(e.isNegative())return new NativeBigInt(i);for(var a=this,u=Integer[1];(n&o)===o&&(u=u.times(a),--n),n!==i;)n/=s,a=a.square();return u},BigInteger.prototype.modPow=function(t,e){if(t=parseValue(t),(e=parseValue(e)).isZero())throw new Error("Cannot take modPow with modulus 0");var r=Integer[1],n=this.mod(e);for(t.isNegative()&&(t=t.multiply(Integer[-1]),n=n.modInv(e));t.isPositive();){if(n.isZero())return Integer[0];t.isOdd()&&(r=r.multiply(n).mod(e)),t=t.divide(2),n=n.square().mod(e)}return r},NativeBigInt.prototype.modPow=SmallInteger.prototype.modPow=BigInteger.prototype.modPow,BigInteger.prototype.compareAbs=function(t){var e=parseValue(t),r=this.value,n=e.value;return e.isSmall?1:compareAbs(r,n)},SmallInteger.prototype.compareAbs=function(t){var e=parseValue(t),r=Math.abs(this.value),n=e.value;return e.isSmall?r===(n=Math.abs(n))?0:r>n?1:-1:-1},NativeBigInt.prototype.compareAbs=function(t){var e=this.value,r=parseValue(t).value;return(e=e>=0?e:-e)===(r=r>=0?r:-r)?0:e>r?1:-1},BigInteger.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=parseValue(t),r=this.value,n=e.value;return this.sign!==e.sign?e.sign?1:-1:e.isSmall?this.sign?-1:1:compareAbs(r,n)*(this.sign?-1:1)},BigInteger.prototype.compareTo=BigInteger.prototype.compare,SmallInteger.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=parseValue(t),r=this.value,n=e.value;return e.isSmall?r==n?0:r>n?1:-1:r<0!==e.sign?r<0?-1:1:r<0?1:-1},SmallInteger.prototype.compareTo=SmallInteger.prototype.compare,NativeBigInt.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=this.value,r=parseValue(t).value;return e===r?0:e>r?1:-1},NativeBigInt.prototype.compareTo=NativeBigInt.prototype.compare,BigInteger.prototype.equals=function(t){return 0===this.compare(t)},NativeBigInt.prototype.eq=NativeBigInt.prototype.equals=SmallInteger.prototype.eq=SmallInteger.prototype.equals=BigInteger.prototype.eq=BigInteger.prototype.equals,BigInteger.prototype.notEquals=function(t){return 0!==this.compare(t)},NativeBigInt.prototype.neq=NativeBigInt.prototype.notEquals=SmallInteger.prototype.neq=SmallInteger.prototype.notEquals=BigInteger.prototype.neq=BigInteger.prototype.notEquals,BigInteger.prototype.greater=function(t){return this.compare(t)>0},NativeBigInt.prototype.gt=NativeBigInt.prototype.greater=SmallInteger.prototype.gt=SmallInteger.prototype.greater=BigInteger.prototype.gt=BigInteger.prototype.greater,BigInteger.prototype.lesser=function(t){return this.compare(t)<0},NativeBigInt.prototype.lt=NativeBigInt.prototype.lesser=SmallInteger.prototype.lt=SmallInteger.prototype.lesser=BigInteger.prototype.lt=BigInteger.prototype.lesser,BigInteger.prototype.greaterOrEquals=function(t){return this.compare(t)>=0},NativeBigInt.prototype.geq=NativeBigInt.prototype.greaterOrEquals=SmallInteger.prototype.geq=SmallInteger.prototype.greaterOrEquals=BigInteger.prototype.geq=BigInteger.prototype.greaterOrEquals,BigInteger.prototype.lesserOrEquals=function(t){return this.compare(t)<=0},NativeBigInt.prototype.leq=NativeBigInt.prototype.lesserOrEquals=SmallInteger.prototype.leq=SmallInteger.prototype.lesserOrEquals=BigInteger.prototype.leq=BigInteger.prototype.lesserOrEquals,BigInteger.prototype.isEven=function(){return!(1&this.value[0])},SmallInteger.prototype.isEven=function(){return!(1&this.value)},NativeBigInt.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},BigInteger.prototype.isOdd=function(){return!(1&~this.value[0])},SmallInteger.prototype.isOdd=function(){return!(1&~this.value)},NativeBigInt.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},BigInteger.prototype.isPositive=function(){return!this.sign},SmallInteger.prototype.isPositive=function(){return this.value>0},NativeBigInt.prototype.isPositive=SmallInteger.prototype.isPositive,BigInteger.prototype.isNegative=function(){return this.sign},SmallInteger.prototype.isNegative=function(){return this.value<0},NativeBigInt.prototype.isNegative=SmallInteger.prototype.isNegative,BigInteger.prototype.isUnit=function(){return!1},SmallInteger.prototype.isUnit=function(){return 1===Math.abs(this.value)},NativeBigInt.prototype.isUnit=function(){return this.abs().value===BigInt(1)},BigInteger.prototype.isZero=function(){return!1},SmallInteger.prototype.isZero=function(){return 0===this.value},NativeBigInt.prototype.isZero=function(){return this.value===BigInt(0)},BigInteger.prototype.isDivisibleBy=function(t){var e=parseValue(t);return!e.isZero()&&(!!e.isUnit()||(0===e.compareAbs(2)?this.isEven():this.mod(e).isZero()))},NativeBigInt.prototype.isDivisibleBy=SmallInteger.prototype.isDivisibleBy=BigInteger.prototype.isDivisibleBy,BigInteger.prototype.isPrime=function(e){var r=isBasicPrime(this);if(r!==t)return r;var n=this.abs(),o=n.bitLength();if(o<=64)return millerRabinTest(n,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var s=Math.log(2)*o.toJSNumber(),a=Math.ceil(!0===e?2*Math.pow(s,2):s),u=[],p=0;p<a;p++)u.push(i(p+2));return millerRabinTest(n,u)},NativeBigInt.prototype.isPrime=SmallInteger.prototype.isPrime=BigInteger.prototype.isPrime,BigInteger.prototype.isProbablePrime=function(e,r){var n=isBasicPrime(this);if(n!==t)return n;for(var o=this.abs(),s=e===t?5:e,a=[],u=0;u<s;u++)a.push(i.randBetween(2,o.minus(2),r));return millerRabinTest(o,a)},NativeBigInt.prototype.isProbablePrime=SmallInteger.prototype.isProbablePrime=BigInteger.prototype.isProbablePrime,BigInteger.prototype.modInv=function(t){for(var e,r,n,o=i.zero,s=i.one,a=parseValue(t),u=this.abs();!u.isZero();)e=a.divide(u),r=o,n=a,o=s,a=u,s=r.subtract(e.multiply(s)),u=n.subtract(e.multiply(u));if(!a.isUnit())throw new Error(this.toString()+" and "+t.toString()+" are not co-prime");return-1===o.compare(0)&&(o=o.add(t)),this.isNegative()?o.negate():o},NativeBigInt.prototype.modInv=SmallInteger.prototype.modInv=BigInteger.prototype.modInv,BigInteger.prototype.next=function(){var t=this.value;return this.sign?subtractSmall(t,1,this.sign):new BigInteger(addSmall(t,1),this.sign)},SmallInteger.prototype.next=function(){var t=this.value;return t+1<n?new SmallInteger(t+1):new BigInteger(o,!1)},NativeBigInt.prototype.next=function(){return new NativeBigInt(this.value+BigInt(1))},BigInteger.prototype.prev=function(){var t=this.value;return this.sign?new BigInteger(addSmall(t,1),!0):subtractSmall(t,1,this.sign)},SmallInteger.prototype.prev=function(){var t=this.value;return t-1>-n?new SmallInteger(t-1):new BigInteger(o,!0)},NativeBigInt.prototype.prev=function(){return new NativeBigInt(this.value-BigInt(1))};for(var u=[1];2*u[u.length-1]<=e;)u.push(2*u[u.length-1]);var p=u.length,l=u[p-1];function shift_isSmall(t){return Math.abs(t)<=e}function bitwise(t,e,r){e=parseValue(e);for(var n=t.isNegative(),o=e.isNegative(),s=n?t.not():t,a=o?e.not():e,u=0,p=0,c=null,h=null,f=[];!s.isZero()||!a.isZero();)u=(c=divModAny(s,l))[1].toJSNumber(),n&&(u=l-1-u),p=(h=divModAny(a,l))[1].toJSNumber(),o&&(p=l-1-p),s=c[0],a=h[0],f.push(r(u,p));for(var g=0!==r(n?1:0,o?1:0)?i(-1):i(0),d=f.length-1;d>=0;d-=1)g=g.multiply(l).add(i(f[d]));return g}BigInteger.prototype.shiftLeft=function(t){var e=parseValue(t).toJSNumber();if(!shift_isSmall(e))throw new Error(String(e)+" is too large for shifting.");if(e<0)return this.shiftRight(-e);var r=this;if(r.isZero())return r;for(;e>=p;)r=r.multiply(l),e-=p-1;return r.multiply(u[e])},NativeBigInt.prototype.shiftLeft=SmallInteger.prototype.shiftLeft=BigInteger.prototype.shiftLeft,BigInteger.prototype.shiftRight=function(t){var e,r=parseValue(t).toJSNumber();if(!shift_isSmall(r))throw new Error(String(r)+" is too large for shifting.");if(r<0)return this.shiftLeft(-r);for(var n=this;r>=p;){if(n.isZero()||n.isNegative()&&n.isUnit())return n;n=(e=divModAny(n,l))[1].isNegative()?e[0].prev():e[0],r-=p-1}return(e=divModAny(n,u[r]))[1].isNegative()?e[0].prev():e[0]},NativeBigInt.prototype.shiftRight=SmallInteger.prototype.shiftRight=BigInteger.prototype.shiftRight,BigInteger.prototype.not=function(){return this.negate().prev()},NativeBigInt.prototype.not=SmallInteger.prototype.not=BigInteger.prototype.not,BigInteger.prototype.and=function(t){return bitwise(this,t,(function(t,e){return t&e}))},NativeBigInt.prototype.and=SmallInteger.prototype.and=BigInteger.prototype.and,BigInteger.prototype.or=function(t){return bitwise(this,t,(function(t,e){return t|e}))},NativeBigInt.prototype.or=SmallInteger.prototype.or=BigInteger.prototype.or,BigInteger.prototype.xor=function(t){return bitwise(this,t,(function(t,e){return t^e}))},NativeBigInt.prototype.xor=SmallInteger.prototype.xor=BigInteger.prototype.xor;var c=1<<30,h=(e&-e)*(e&-e)|c;function roughLOB(t){var r=t.value,n="number"==typeof r?r|c:"bigint"==typeof r?r|BigInt(c):r[0]+r[1]*e|h;return n&-n}function integerLogarithm(t,e){if(e.compareTo(t)<=0){var r=integerLogarithm(t,e.square(e)),n=r.p,o=r.e,s=n.multiply(e);return s.compareTo(t)<=0?{p:s,e:2*o+1}:{p:n,e:2*o}}return{p:i(1),e:0}}function max(t,e){return t=parseValue(t),e=parseValue(e),t.greater(e)?t:e}function min(t,e){return t=parseValue(t),e=parseValue(e),t.lesser(e)?t:e}function gcd(t,e){if(t=parseValue(t).abs(),e=parseValue(e).abs(),t.equals(e))return t;if(t.isZero())return e;if(e.isZero())return t;for(var r,n,i=Integer[1];t.isEven()&&e.isEven();)r=min(roughLOB(t),roughLOB(e)),t=t.divide(r),e=e.divide(r),i=i.multiply(r);for(;t.isEven();)t=t.divide(roughLOB(t));do{for(;e.isEven();)e=e.divide(roughLOB(e));t.greater(e)&&(n=e,e=t,t=n),e=e.subtract(t)}while(!e.isZero());return i.isUnit()?t:t.multiply(i)}BigInteger.prototype.bitLength=function(){var t=this;return t.compareTo(i(0))<0&&(t=t.negate().subtract(i(1))),0===t.compareTo(i(0))?i(0):i(integerLogarithm(t,i(2)).e).add(i(1))},NativeBigInt.prototype.bitLength=SmallInteger.prototype.bitLength=BigInteger.prototype.bitLength;var parseBase=function(t,e,r,n){r=r||s,t=String(t),n||(t=t.toLowerCase(),r=r.toLowerCase());var i,o=t.length,a=Math.abs(e),u={};for(i=0;i<r.length;i++)u[r[i]]=i;for(i=0;i<o;i++){if("-"!==(c=t[i])&&(c in u&&u[c]>=a)){if("1"===c&&1===a)continue;throw new Error(c+" is not a valid digit in base "+e+".")}}e=parseValue(e);var p=[],l="-"===t[0];for(i=l?1:0;i<t.length;i++){var c;if((c=t[i])in u)p.push(parseValue(u[c]));else{if("<"!==c)throw new Error(c+" is not a valid character");var h=i;do{i++}while(">"!==t[i]&&i<t.length);p.push(parseValue(t.slice(h+1,i)))}}return parseBaseFromArray(p,e,l)};function parseBaseFromArray(t,e,r){var n,i=Integer[0],o=Integer[1];for(n=t.length-1;n>=0;n--)i=i.add(t[n].times(o)),o=o.times(e);return r?i.negate():i}function toBase(t,e){if((e=i(e)).isZero()){if(t.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(e.equals(-1)){if(t.isZero())return{value:[0],isNegative:!1};if(t.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-t.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var r=Array.apply(null,Array(t.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return r.unshift([1]),{value:[].concat.apply([],r),isNegative:!1}}var n=!1;if(t.isNegative()&&e.isPositive()&&(n=!0,t=t.abs()),e.isUnit())return t.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(t.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:n};for(var o,s=[],a=t;a.isNegative()||a.compareAbs(e)>=0;){o=a.divmod(e),a=o.quotient;var u=o.remainder;u.isNegative()&&(u=e.minus(u).abs(),a=a.next()),s.push(u.toJSNumber())}return s.push(a.toJSNumber()),{value:s.reverse(),isNegative:n}}function toBaseString(t,e,r){var n=toBase(t,e);return(n.isNegative?"-":"")+n.value.map((function(t){return function stringify(t,e){return t<(e=e||s).length?e[t]:"<"+t+">"}(t,r)})).join("")}function parseStringValue(t){if(isPrecise(+t)){var e=+t;if(e===truncate(e))return a?new NativeBigInt(BigInt(e)):new SmallInteger(e);throw new Error("Invalid integer: "+t)}var n="-"===t[0];n&&(t=t.slice(1));var i=t.split(/e/i);if(i.length>2)throw new Error("Invalid integer: "+i.join("e"));if(2===i.length){var o=i[1];if("+"===o[0]&&(o=o.slice(1)),(o=+o)!==truncate(o)||!isPrecise(o))throw new Error("Invalid integer: "+o+" is not a valid exponent.");var s=i[0],u=s.indexOf(".");if(u>=0&&(o-=s.length-u-1,s=s.slice(0,u)+s.slice(u+1)),o<0)throw new Error("Cannot include negative exponent part for integers");t=s+=new Array(o+1).join("0")}if(!/^([0-9][0-9]*)$/.test(t))throw new Error("Invalid integer: "+t);if(a)return new NativeBigInt(BigInt(n?"-"+t:t));for(var p=[],l=t.length,c=r,h=l-c;l>0;)p.push(+t.slice(h,l)),(h-=c)<0&&(h=0),l-=c;return trim(p),new BigInteger(p,n)}function parseValue(t){return"number"==typeof t?function parseNumberValue(t){if(a)return new NativeBigInt(BigInt(t));if(isPrecise(t)){if(t!==truncate(t))throw new Error(t+" is not an integer.");return new SmallInteger(t)}return parseStringValue(t.toString())}(t):"string"==typeof t?parseStringValue(t):"bigint"==typeof t?new NativeBigInt(t):t}BigInteger.prototype.toArray=function(t){return toBase(this,t)},SmallInteger.prototype.toArray=function(t){return toBase(this,t)},NativeBigInt.prototype.toArray=function(t){return toBase(this,t)},BigInteger.prototype.toString=function(e,r){if(e===t&&(e=10),10!==e)return toBaseString(this,e,r);for(var n,i=this.value,o=i.length,s=String(i[--o]);--o>=0;)n=String(i[o]),s+="0000000".slice(n.length)+n;return(this.sign?"-":"")+s},SmallInteger.prototype.toString=function(e,r){return e===t&&(e=10),10!=e?toBaseString(this,e,r):String(this.value)},NativeBigInt.prototype.toString=SmallInteger.prototype.toString,NativeBigInt.prototype.toJSON=BigInteger.prototype.toJSON=SmallInteger.prototype.toJSON=function(){return this.toString()},BigInteger.prototype.valueOf=function(){return parseInt(this.toString(),10)},BigInteger.prototype.toJSNumber=BigInteger.prototype.valueOf,SmallInteger.prototype.valueOf=function(){return this.value},SmallInteger.prototype.toJSNumber=SmallInteger.prototype.valueOf,NativeBigInt.prototype.valueOf=NativeBigInt.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};for(var f=0;f<1e3;f++)Integer[f]=parseValue(f),f>0&&(Integer[-f]=parseValue(-f));return Integer.one=Integer[1],Integer.zero=Integer[0],Integer.minusOne=Integer[-1],Integer.max=max,Integer.min=min,Integer.gcd=gcd,Integer.lcm=function lcm(t,e){return t=parseValue(t).abs(),e=parseValue(e).abs(),t.divide(gcd(t,e)).multiply(e)},Integer.isInstance=function(t){return t instanceof BigInteger||t instanceof SmallInteger||t instanceof NativeBigInt},Integer.randBetween=function randBetween(t,r,n){t=parseValue(t),r=parseValue(r);var i=n||Math.random,o=min(t,r),s=max(t,r).subtract(o).add(1);if(s.isSmall)return o.add(Math.floor(i()*s));for(var a=toBase(s,e).value,u=[],p=!0,l=0;l<a.length;l++){var c=p?a[l]+(l+1<a.length?a[l+1]/e:0):e,h=truncate(i()*c);u.push(h),h<a[l]&&(p=!1)}return o.add(Integer.fromArray(u,e,!1))},Integer.fromArray=function(t,e,r){return parseBaseFromArray(t.map(parseValue),parseValue(e||10),r)},Integer}();t.hasOwnProperty("exports")&&(t.exports=i),void 0===(n=function(){return i}.call(e,r,e,t))||(t.exports=n)},970742:(t,e,r)=>{"use strict";var n=r(939216),i=r(825636).Buffer;t.exports=function(t){function decodeRaw(e){var r=e.slice(0,-4),n=e.slice(-4),i=t(r);if(!(n[0]^i[0]|n[1]^i[1]|n[2]^i[2]|n[3]^i[3]))return r}return{encode:function encode(e){var r=t(e);return n.encode(i.concat([e,r],e.length+4))},decode:function decode(t){var e=decodeRaw(n.decode(t));if(!e)throw new Error("Invalid checksum");return e},decodeUnsafe:function decodeUnsafe(t){var e=n.decodeUnsafe(t);if(e)return decodeRaw(e)}}}},222747:(t,e,r)=>{"use strict";var n=r(213257),i=r(970742);t.exports=i((function sha256x2(t){var e=n("sha256").update(t).digest();return n("sha256").update(e).digest()}))},335344:(t,e,r)=>{var n=r(222747),i=r(850630),o=r(901048).Buffer,s={Legacy:"legacy",Bitpay:"bitpay",Cashaddr:"cashaddr"},a={Mainnet:"mainnet",Testnet:"testnet"},u={};function detectAddressFormat(t){return decodeAddress(t).format}function detectAddressNetwork(t){return decodeAddress(t).network}function detectAddressType(t){return decodeAddress(t).type}u.P2PKH="p2pkh",u.P2SH="p2sh";var p={};function decodeAddress(t){try{return function decodeBase58Address(t){try{var e=n.decode(t);if(e.length!==l)throw new InvalidAddressError;var r=e[0],i=Array.prototype.slice.call(e,1);switch(r){case p[s.Legacy][a.Mainnet][u.P2PKH]:return{hash:i,format:s.Legacy,network:a.Mainnet,type:u.P2PKH};case p[s.Legacy][a.Mainnet][u.P2SH]:return{hash:i,format:s.Legacy,network:a.Mainnet,type:u.P2SH};case p[s.Legacy][a.Testnet][u.P2PKH]:return{hash:i,format:s.Legacy,network:a.Testnet,type:u.P2PKH};case p[s.Legacy][a.Testnet][u.P2SH]:return{hash:i,format:s.Legacy,network:a.Testnet,type:u.P2SH};case p[s.Bitpay][a.Mainnet][u.P2PKH]:return{hash:i,format:s.Bitpay,network:a.Mainnet,type:u.P2PKH};case p[s.Bitpay][a.Mainnet][u.P2SH]:return{hash:i,format:s.Bitpay,network:a.Mainnet,type:u.P2SH}}}catch(t){}throw new InvalidAddressError}(t)}catch(t){}try{return function decodeCashAddress(t){if(-1!==t.indexOf(":"))try{return decodeCashAddressWithPrefix(t)}catch(t){}else for(var e=["bitcoincash","bchtest","bchreg"],r=0;r<e.length;++r)try{return decodeCashAddressWithPrefix(e[r]+":"+t)}catch(t){}throw new InvalidAddressError}(t)}catch(t){}throw new InvalidAddressError}p[s.Legacy]={},p[s.Legacy][a.Mainnet]={},p[s.Legacy][a.Mainnet][u.P2PKH]=0,p[s.Legacy][a.Mainnet][u.P2SH]=5,p[s.Legacy][a.Testnet]={},p[s.Legacy][a.Testnet][u.P2PKH]=111,p[s.Legacy][a.Testnet][u.P2SH]=196,p[s.Bitpay]={},p[s.Bitpay][a.Mainnet]={},p[s.Bitpay][a.Mainnet][u.P2PKH]=28,p[s.Bitpay][a.Mainnet][u.P2SH]=40,p[s.Bitpay][a.Testnet]={},p[s.Bitpay][a.Testnet][u.P2PKH]=111,p[s.Bitpay][a.Testnet][u.P2SH]=196;var l=21;function decodeCashAddressWithPrefix(t){try{var e=i.decode(t),r=Array.prototype.slice.call(e.hash,0),n="P2PKH"===e.type?u.P2PKH:u.P2SH;switch(e.prefix){case"bitcoincash":return{hash:r,format:s.Cashaddr,network:a.Mainnet,type:n};case"bchtest":case"bchreg":return{hash:r,format:s.Cashaddr,network:a.Testnet,type:n}}}catch(t){}throw new InvalidAddressError}function InvalidAddressError(){var t=new Error;this.name=t.name="InvalidAddressError",this.message=t.message="Received an invalid Bitcoin Cash address as input.",this.stack=t.stack}InvalidAddressError.prototype=Object.create(Error.prototype),t.exports={Format:s,Network:a,Type:u,isValidAddress:function isValidAddress(t){try{return decodeAddress(t),!0}catch(t){return!1}},detectAddressFormat,detectAddressNetwork,detectAddressType,toLegacyAddress:function toLegacyAddress(t){var e=decodeAddress(t);return e.format===s.Legacy?t:function encodeAsLegacy(t){var e=p[s.Legacy][t.network][t.type],r=o.alloc(1+t.hash.length);return r[0]=e,r.set(t.hash,1),n.encode(r)}(e)},toBitpayAddress:function toBitpayAddress(t){var e=decodeAddress(t);return e.format===s.Bitpay?t:function encodeAsBitpay(t){var e=p[s.Bitpay][t.network][t.type],r=o.alloc(1+t.hash.length);return r[0]=e,r.set(t.hash,1),n.encode(r)}(e)},toCashAddress:function toCashAddress(t){return function encodeAsCashaddr(t){var e=t.network===a.Mainnet?"bitcoincash":"bchtest",r=t.type===u.P2PKH?"P2PKH":"P2SH",n=new Uint8Array(t.hash);return i.encode(e,r,n)}(decodeAddress(t))},isLegacyAddress:function isLegacyAddress(t){return detectAddressFormat(t)===s.Legacy},isBitpayAddress:function isBitpayAddress(t){return detectAddressFormat(t)===s.Bitpay},isCashAddress:function isCashAddress(t){return detectAddressFormat(t)===s.Cashaddr},isMainnetAddress:function isMainnetAddress(t){return detectAddressNetwork(t)===a.Mainnet},isTestnetAddress:function isTestnetAddress(t){return detectAddressNetwork(t)===a.Testnet},isP2PKHAddress:function isP2PKHAddress(t){return detectAddressType(t)===u.P2PKH},isP2SHAddress:function isP2SHAddress(t){return detectAddressType(t)===u.P2SH},InvalidAddressError}},664864:(t,e,r)=>{var n;t=r.nmd(t);var i=function(t){"use strict";var e=1e7,r=7,n=9007199254740992,o=smallToArray(n),s=Math.log(n);function Integer(t,e){return void 0===t?Integer[0]:void 0!==e?10==+e?parseValue(t):parseBase(t,e):parseValue(t)}function BigInteger(t,e){this.value=t,this.sign=e,this.isSmall=!1}function SmallInteger(t){this.value=t,this.sign=t<0,this.isSmall=!0}function isPrecise(t){return-n<t&&t<n}function smallToArray(t){return t<1e7?[t]:t<1e14?[t%1e7,Math.floor(t/1e7)]:[t%1e7,Math.floor(t/1e7)%1e7,Math.floor(t/1e14)]}function arrayToSmall(t){trim(t);var r=t.length;if(r<4&&compareAbs(t,o)<0)switch(r){case 0:return 0;case 1:return t[0];case 2:return t[0]+t[1]*e;default:return t[0]+(t[1]+t[2]*e)*e}return t}function trim(t){for(var e=t.length;0===t[--e];);t.length=e+1}function createArray(t){for(var e=new Array(t),r=-1;++r<t;)e[r]=0;return e}function truncate(t){return t>0?Math.floor(t):Math.ceil(t)}function add(t,r){var n,i,o=t.length,s=r.length,a=new Array(o),u=0,p=e;for(i=0;i<s;i++)u=(n=t[i]+r[i]+u)>=p?1:0,a[i]=n-u*p;for(;i<o;)u=(n=t[i]+u)===p?1:0,a[i++]=n-u*p;return u>0&&a.push(u),a}function addAny(t,e){return t.length>=e.length?add(t,e):add(e,t)}function addSmall(t,r){var n,i,o=t.length,s=new Array(o),a=e;for(i=0;i<o;i++)n=t[i]-a+r,r=Math.floor(n/a),s[i]=n-r*a,r+=1;for(;r>0;)s[i++]=r%a,r=Math.floor(r/a);return s}function subtract(t,r){var n,i,o=t.length,s=r.length,a=new Array(o),u=0,p=e;for(n=0;n<s;n++)(i=t[n]-u-r[n])<0?(i+=p,u=1):u=0,a[n]=i;for(n=s;n<o;n++){if(!((i=t[n]-u)<0)){a[n++]=i;break}i+=p,a[n]=i}for(;n<o;n++)a[n]=t[n];return trim(a),a}function subtractSmall(t,r,n){var i,o,s=t.length,a=new Array(s),u=-r,p=e;for(i=0;i<s;i++)o=t[i]+u,u=Math.floor(o/p),o%=p,a[i]=o<0?o+p:o;return"number"==typeof(a=arrayToSmall(a))?(n&&(a=-a),new SmallInteger(a)):new BigInteger(a,n)}function multiplyLong(t,r){var n,i,o,s,a=t.length,u=r.length,p=createArray(a+u),l=e;for(o=0;o<a;++o){s=t[o];for(var c=0;c<u;++c)n=s*r[c]+p[o+c],i=Math.floor(n/l),p[o+c]=n-i*l,p[o+c+1]+=i}return trim(p),p}function multiplySmall(t,r){var n,i,o=t.length,s=new Array(o),a=e,u=0;for(i=0;i<o;i++)n=t[i]*r+u,u=Math.floor(n/a),s[i]=n-u*a;for(;u>0;)s[i++]=u%a,u=Math.floor(u/a);return s}function shiftLeft(t,e){for(var r=[];e-- >0;)r.push(0);return r.concat(t)}function multiplyKaratsuba(t,e){var r=Math.max(t.length,e.length);if(r<=30)return multiplyLong(t,e);r=Math.ceil(r/2);var n=t.slice(r),i=t.slice(0,r),o=e.slice(r),s=e.slice(0,r),a=multiplyKaratsuba(i,s),u=multiplyKaratsuba(n,o),p=multiplyKaratsuba(addAny(i,n),addAny(s,o)),l=addAny(addAny(a,shiftLeft(subtract(subtract(p,a),u),r)),shiftLeft(u,2*r));return trim(l),l}function multiplySmallAndArray(t,r,n){return new BigInteger(t<e?multiplySmall(r,t):multiplyLong(r,smallToArray(t)),n)}function square(t){var r,n,i,o,s=t.length,a=createArray(s+s),u=e;for(i=0;i<s;i++){n=0-(o=t[i])*o;for(var p=i;p<s;p++)r=o*t[p]*2+a[i+p]+n,n=Math.floor(r/u),a[i+p]=r-n*u;a[i+s]=n}return trim(a),a}function divModSmall(t,r){var n,i,o,s,a=t.length,u=createArray(a),p=e;for(o=0,n=a-1;n>=0;--n)o=(s=o*p+t[n])-(i=truncate(s/r))*r,u[n]=0|i;return[u,0|o]}function divModAny(t,r){var n,i,o=parseValue(r),s=t.value,a=o.value;if(0===a)throw new Error("Cannot divide by zero");if(t.isSmall)return o.isSmall?[new SmallInteger(truncate(s/a)),new SmallInteger(s%a)]:[Integer[0],t];if(o.isSmall){if(1===a)return[t,Integer[0]];if(-1==a)return[t.negate(),Integer[0]];var u=Math.abs(a);if(u<e){i=arrayToSmall((n=divModSmall(s,u))[0]);var p=n[1];return t.sign&&(p=-p),"number"==typeof i?(t.sign!==o.sign&&(i=-i),[new SmallInteger(i),new SmallInteger(p)]):[new BigInteger(i,t.sign!==o.sign),new SmallInteger(p)]}a=smallToArray(u)}var l=compareAbs(s,a);if(-1===l)return[Integer[0],t];if(0===l)return[Integer[t.sign===o.sign?1:-1],Integer[0]];n=s.length+a.length<=200?function divMod1(t,r){var n,i,o,s,a,u,p,l=t.length,c=r.length,h=e,f=createArray(r.length),g=r[c-1],d=Math.ceil(h/(2*g)),y=multiplySmall(t,d),m=multiplySmall(r,d);for(y.length<=l&&y.push(0),m.push(0),g=m[c-1],i=l-c;i>=0;i--){for(n=h-1,y[i+c]!==g&&(n=Math.floor((y[i+c]*h+y[i+c-1])/g)),o=0,s=0,u=m.length,a=0;a<u;a++)o+=n*m[a],p=Math.floor(o/h),s+=y[i+a]-(o-p*h),o=p,s<0?(y[i+a]=s+h,s=-1):(y[i+a]=s,s=0);for(;0!==s;){for(n-=1,o=0,a=0;a<u;a++)(o+=y[i+a]-h+m[a])<0?(y[i+a]=o+h,o=0):(y[i+a]=o,o=1);s+=o}f[i]=n}return y=divModSmall(y,d)[0],[arrayToSmall(f),arrayToSmall(y)]}(s,a):function divMod2(t,r){for(var n,i,o,s,a,u=t.length,p=r.length,l=[],c=[],h=e;u;)if(c.unshift(t[--u]),trim(c),compareAbs(c,r)<0)l.push(0);else{o=c[(i=c.length)-1]*h+c[i-2],s=r[p-1]*h+r[p-2],i>p&&(o=(o+1)*h),n=Math.ceil(o/s);do{if(compareAbs(a=multiplySmall(r,n),c)<=0)break;n--}while(n);l.push(n),c=subtract(c,a)}return l.reverse(),[arrayToSmall(l),arrayToSmall(c)]}(s,a),i=n[0];var c=t.sign!==o.sign,h=n[1],f=t.sign;return"number"==typeof i?(c&&(i=-i),i=new SmallInteger(i)):i=new BigInteger(i,c),"number"==typeof h?(f&&(h=-h),h=new SmallInteger(h)):h=new BigInteger(h,f),[i,h]}function compareAbs(t,e){if(t.length!==e.length)return t.length>e.length?1:-1;for(var r=t.length-1;r>=0;r--)if(t[r]!==e[r])return t[r]>e[r]?1:-1;return 0}function isBasicPrime(t){var e=t.abs();return!e.isUnit()&&(!!(e.equals(2)||e.equals(3)||e.equals(5))||!(e.isEven()||e.isDivisibleBy(3)||e.isDivisibleBy(5))&&(!!e.lesser(49)||void 0))}function millerRabinTest(t,e){for(var r,n,o,s=t.prev(),a=s,u=0;a.isEven();)a=a.divide(2),u++;t:for(n=0;n<e.length;n++)if(!t.lesser(e[n])&&!(o=i(e[n]).modPow(a,t)).equals(Integer[1])&&!o.equals(s)){for(r=u-1;0!=r;r--){if((o=o.square().mod(t)).isUnit())return!1;if(o.equals(s))continue t}return!1}return!0}BigInteger.prototype=Object.create(Integer.prototype),SmallInteger.prototype=Object.create(Integer.prototype),BigInteger.prototype.add=function(t){var e=parseValue(t);if(this.sign!==e.sign)return this.subtract(e.negate());var r=this.value,n=e.value;return e.isSmall?new BigInteger(addSmall(r,Math.abs(n)),this.sign):new BigInteger(addAny(r,n),this.sign)},BigInteger.prototype.plus=BigInteger.prototype.add,SmallInteger.prototype.add=function(t){var e=parseValue(t),r=this.value;if(r<0!==e.sign)return this.subtract(e.negate());var n=e.value;if(e.isSmall){if(isPrecise(r+n))return new SmallInteger(r+n);n=smallToArray(Math.abs(n))}return new BigInteger(addSmall(n,Math.abs(r)),r<0)},SmallInteger.prototype.plus=SmallInteger.prototype.add,BigInteger.prototype.subtract=function(t){var e=parseValue(t);if(this.sign!==e.sign)return this.add(e.negate());var r=this.value,n=e.value;return e.isSmall?subtractSmall(r,Math.abs(n),this.sign):function subtractAny(t,e,r){var n;return compareAbs(t,e)>=0?n=subtract(t,e):(n=subtract(e,t),r=!r),"number"==typeof(n=arrayToSmall(n))?(r&&(n=-n),new SmallInteger(n)):new BigInteger(n,r)}(r,n,this.sign)},BigInteger.prototype.minus=BigInteger.prototype.subtract,SmallInteger.prototype.subtract=function(t){var e=parseValue(t),r=this.value;if(r<0!==e.sign)return this.add(e.negate());var n=e.value;return e.isSmall?new SmallInteger(r-n):subtractSmall(n,Math.abs(r),r>=0)},SmallInteger.prototype.minus=SmallInteger.prototype.subtract,BigInteger.prototype.negate=function(){return new BigInteger(this.value,!this.sign)},SmallInteger.prototype.negate=function(){var t=this.sign,e=new SmallInteger(-this.value);return e.sign=!t,e},BigInteger.prototype.abs=function(){return new BigInteger(this.value,!1)},SmallInteger.prototype.abs=function(){return new SmallInteger(Math.abs(this.value))},BigInteger.prototype.multiply=function(t){var r,n=parseValue(t),i=this.value,o=n.value,s=this.sign!==n.sign;if(n.isSmall){if(0===o)return Integer[0];if(1===o)return this;if(-1===o)return this.negate();if((r=Math.abs(o))<e)return new BigInteger(multiplySmall(i,r),s);o=smallToArray(r)}return function useKaratsuba(t,e){return-.012*t-.012*e+15e-6*t*e>0}(i.length,o.length)?new BigInteger(multiplyKaratsuba(i,o),s):new BigInteger(multiplyLong(i,o),s)},BigInteger.prototype.times=BigInteger.prototype.multiply,SmallInteger.prototype._multiplyBySmall=function(t){return isPrecise(t.value*this.value)?new SmallInteger(t.value*this.value):multiplySmallAndArray(Math.abs(t.value),smallToArray(Math.abs(this.value)),this.sign!==t.sign)},BigInteger.prototype._multiplyBySmall=function(t){return 0===t.value?Integer[0]:1===t.value?this:-1===t.value?this.negate():multiplySmallAndArray(Math.abs(t.value),this.value,this.sign!==t.sign)},SmallInteger.prototype.multiply=function(t){return parseValue(t)._multiplyBySmall(this)},SmallInteger.prototype.times=SmallInteger.prototype.multiply,BigInteger.prototype.square=function(){return new BigInteger(square(this.value),!1)},SmallInteger.prototype.square=function(){var t=this.value*this.value;return isPrecise(t)?new SmallInteger(t):new BigInteger(square(smallToArray(Math.abs(this.value))),!1)},BigInteger.prototype.divmod=function(t){var e=divModAny(this,t);return{quotient:e[0],remainder:e[1]}},SmallInteger.prototype.divmod=BigInteger.prototype.divmod,BigInteger.prototype.divide=function(t){return divModAny(this,t)[0]},SmallInteger.prototype.over=SmallInteger.prototype.divide=BigInteger.prototype.over=BigInteger.prototype.divide,BigInteger.prototype.mod=function(t){return divModAny(this,t)[1]},SmallInteger.prototype.remainder=SmallInteger.prototype.mod=BigInteger.prototype.remainder=BigInteger.prototype.mod,BigInteger.prototype.pow=function(t){var e,r,n,i=parseValue(t),o=this.value,s=i.value;if(0===s)return Integer[1];if(0===o)return Integer[0];if(1===o)return Integer[1];if(-1===o)return i.isEven()?Integer[1]:Integer[-1];if(i.sign)return Integer[0];if(!i.isSmall)throw new Error("The exponent "+i.toString()+" is too large.");if(this.isSmall&&isPrecise(e=Math.pow(o,s)))return new SmallInteger(truncate(e));for(r=this,n=Integer[1];!0&s&&(n=n.times(r),--s),0!==s;)s/=2,r=r.square();return n},SmallInteger.prototype.pow=BigInteger.prototype.pow,BigInteger.prototype.modPow=function(t,e){if(t=parseValue(t),(e=parseValue(e)).isZero())throw new Error("Cannot take modPow with modulus 0");for(var r=Integer[1],n=this.mod(e);t.isPositive();){if(n.isZero())return Integer[0];t.isOdd()&&(r=r.multiply(n).mod(e)),t=t.divide(2),n=n.square().mod(e)}return r},SmallInteger.prototype.modPow=BigInteger.prototype.modPow,BigInteger.prototype.compareAbs=function(t){var e=parseValue(t),r=this.value,n=e.value;return e.isSmall?1:compareAbs(r,n)},SmallInteger.prototype.compareAbs=function(t){var e=parseValue(t),r=Math.abs(this.value),n=e.value;return e.isSmall?r===(n=Math.abs(n))?0:r>n?1:-1:-1},BigInteger.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=parseValue(t),r=this.value,n=e.value;return this.sign!==e.sign?e.sign?1:-1:e.isSmall?this.sign?-1:1:compareAbs(r,n)*(this.sign?-1:1)},BigInteger.prototype.compareTo=BigInteger.prototype.compare,SmallInteger.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=parseValue(t),r=this.value,n=e.value;return e.isSmall?r==n?0:r>n?1:-1:r<0!==e.sign?r<0?-1:1:r<0?1:-1},SmallInteger.prototype.compareTo=SmallInteger.prototype.compare,BigInteger.prototype.equals=function(t){return 0===this.compare(t)},SmallInteger.prototype.eq=SmallInteger.prototype.equals=BigInteger.prototype.eq=BigInteger.prototype.equals,BigInteger.prototype.notEquals=function(t){return 0!==this.compare(t)},SmallInteger.prototype.neq=SmallInteger.prototype.notEquals=BigInteger.prototype.neq=BigInteger.prototype.notEquals,BigInteger.prototype.greater=function(t){return this.compare(t)>0},SmallInteger.prototype.gt=SmallInteger.prototype.greater=BigInteger.prototype.gt=BigInteger.prototype.greater,BigInteger.prototype.lesser=function(t){return this.compare(t)<0},SmallInteger.prototype.lt=SmallInteger.prototype.lesser=BigInteger.prototype.lt=BigInteger.prototype.lesser,BigInteger.prototype.greaterOrEquals=function(t){return this.compare(t)>=0},SmallInteger.prototype.geq=SmallInteger.prototype.greaterOrEquals=BigInteger.prototype.geq=BigInteger.prototype.greaterOrEquals,BigInteger.prototype.lesserOrEquals=function(t){return this.compare(t)<=0},SmallInteger.prototype.leq=SmallInteger.prototype.lesserOrEquals=BigInteger.prototype.leq=BigInteger.prototype.lesserOrEquals,BigInteger.prototype.isEven=function(){return!(1&this.value[0])},SmallInteger.prototype.isEven=function(){return!(1&this.value)},BigInteger.prototype.isOdd=function(){return!(1&~this.value[0])},SmallInteger.prototype.isOdd=function(){return!(1&~this.value)},BigInteger.prototype.isPositive=function(){return!this.sign},SmallInteger.prototype.isPositive=function(){return this.value>0},BigInteger.prototype.isNegative=function(){return this.sign},SmallInteger.prototype.isNegative=function(){return this.value<0},BigInteger.prototype.isUnit=function(){return!1},SmallInteger.prototype.isUnit=function(){return 1===Math.abs(this.value)},BigInteger.prototype.isZero=function(){return!1},SmallInteger.prototype.isZero=function(){return 0===this.value},BigInteger.prototype.isDivisibleBy=function(t){var e=parseValue(t),r=e.value;return 0!==r&&(1===r||(2===r?this.isEven():this.mod(e).equals(Integer[0])))},SmallInteger.prototype.isDivisibleBy=BigInteger.prototype.isDivisibleBy,BigInteger.prototype.isPrime=function(e){var r=isBasicPrime(this);if(r!==t)return r;var n=this.abs(),o=n.bitLength();if(o<=64)return millerRabinTest(n,[2,325,9375,28178,450775,9780504,1795265022]);for(var s=Math.log(2)*o,a=Math.ceil(!0===e?2*Math.pow(s,2):s),u=[],p=0;p<a;p++)u.push(i(p+2));return millerRabinTest(n,u)},SmallInteger.prototype.isPrime=BigInteger.prototype.isPrime,BigInteger.prototype.isProbablePrime=function(e){var r=isBasicPrime(this);if(r!==t)return r;for(var n=this.abs(),o=e===t?5:e,s=[],a=0;a<o;a++)s.push(i.randBetween(2,n.minus(2)));return millerRabinTest(n,s)},SmallInteger.prototype.isProbablePrime=BigInteger.prototype.isProbablePrime,BigInteger.prototype.modInv=function(t){for(var e,r,n,o=i.zero,s=i.one,a=parseValue(t),u=this.abs();!u.equals(i.zero);)e=a.divide(u),r=o,n=a,o=s,a=u,s=r.subtract(e.multiply(s)),u=n.subtract(e.multiply(u));if(!a.equals(1))throw new Error(this.toString()+" and "+t.toString()+" are not co-prime");return-1===o.compare(0)&&(o=o.add(t)),this.isNegative()?o.negate():o},SmallInteger.prototype.modInv=BigInteger.prototype.modInv,BigInteger.prototype.next=function(){var t=this.value;return this.sign?subtractSmall(t,1,this.sign):new BigInteger(addSmall(t,1),this.sign)},SmallInteger.prototype.next=function(){var t=this.value;return t+1<n?new SmallInteger(t+1):new BigInteger(o,!1)},BigInteger.prototype.prev=function(){var t=this.value;return this.sign?new BigInteger(addSmall(t,1),!0):subtractSmall(t,1,this.sign)},SmallInteger.prototype.prev=function(){var t=this.value;return t-1>-n?new SmallInteger(t-1):new BigInteger(o,!0)};for(var a=[1];2*a[a.length-1]<=e;)a.push(2*a[a.length-1]);var u=a.length,p=a[u-1];function shift_isSmall(t){return("number"==typeof t||"string"==typeof t)&&+Math.abs(t)<=e||t instanceof BigInteger&&t.value.length<=1}function bitwise(t,e,r){e=parseValue(e);for(var n=t.isNegative(),o=e.isNegative(),s=n?t.not():t,a=o?e.not():e,u=0,l=0,c=null,h=null,f=[];!s.isZero()||!a.isZero();)u=(c=divModAny(s,p))[1].toJSNumber(),n&&(u=p-1-u),l=(h=divModAny(a,p))[1].toJSNumber(),o&&(l=p-1-l),s=c[0],a=h[0],f.push(r(u,l));for(var g=0!==r(n?1:0,o?1:0)?i(-1):i(0),d=f.length-1;d>=0;d-=1)g=g.multiply(p).add(i(f[d]));return g}BigInteger.prototype.shiftLeft=function(t){if(!shift_isSmall(t))throw new Error(String(t)+" is too large for shifting.");if((t=+t)<0)return this.shiftRight(-t);var e=this;if(e.isZero())return e;for(;t>=u;)e=e.multiply(p),t-=u-1;return e.multiply(a[t])},SmallInteger.prototype.shiftLeft=BigInteger.prototype.shiftLeft,BigInteger.prototype.shiftRight=function(t){var e;if(!shift_isSmall(t))throw new Error(String(t)+" is too large for shifting.");if((t=+t)<0)return this.shiftLeft(-t);for(var r=this;t>=u;){if(r.isZero()||r.isNegative()&&r.isUnit())return r;r=(e=divModAny(r,p))[1].isNegative()?e[0].prev():e[0],t-=u-1}return(e=divModAny(r,a[t]))[1].isNegative()?e[0].prev():e[0]},SmallInteger.prototype.shiftRight=BigInteger.prototype.shiftRight,BigInteger.prototype.not=function(){return this.negate().prev()},SmallInteger.prototype.not=BigInteger.prototype.not,BigInteger.prototype.and=function(t){return bitwise(this,t,(function(t,e){return t&e}))},SmallInteger.prototype.and=BigInteger.prototype.and,BigInteger.prototype.or=function(t){return bitwise(this,t,(function(t,e){return t|e}))},SmallInteger.prototype.or=BigInteger.prototype.or,BigInteger.prototype.xor=function(t){return bitwise(this,t,(function(t,e){return t^e}))},SmallInteger.prototype.xor=BigInteger.prototype.xor;var l=1<<30,c=(e&-e)*(e&-e)|l;function roughLOB(t){var r=t.value,n="number"==typeof r?r|l:r[0]+r[1]*e|c;return n&-n}function integerLogarithm(t,e){if(e.compareTo(t)<=0){var r=integerLogarithm(t,e.square(e)),n=r.p,o=r.e,s=n.multiply(e);return s.compareTo(t)<=0?{p:s,e:2*o+1}:{p:n,e:2*o}}return{p:i(1),e:0}}function max(t,e){return t=parseValue(t),e=parseValue(e),t.greater(e)?t:e}function min(t,e){return t=parseValue(t),e=parseValue(e),t.lesser(e)?t:e}function gcd(t,e){if(t=parseValue(t).abs(),e=parseValue(e).abs(),t.equals(e))return t;if(t.isZero())return e;if(e.isZero())return t;for(var r,n,i=Integer[1];t.isEven()&&e.isEven();)r=Math.min(roughLOB(t),roughLOB(e)),t=t.divide(r),e=e.divide(r),i=i.multiply(r);for(;t.isEven();)t=t.divide(roughLOB(t));do{for(;e.isEven();)e=e.divide(roughLOB(e));t.greater(e)&&(n=e,e=t,t=n),e=e.subtract(t)}while(!e.isZero());return i.isUnit()?t:t.multiply(i)}BigInteger.prototype.bitLength=function(){var t=this;return t.compareTo(i(0))<0&&(t=t.negate().subtract(i(1))),0===t.compareTo(i(0))?i(0):i(integerLogarithm(t,i(2)).e).add(i(1))},SmallInteger.prototype.bitLength=BigInteger.prototype.bitLength;var parseBase=function(t,e){for(var r=t.length,n=Math.abs(e),i=0;i<r;i++){if("-"!==(p=t[i].toLowerCase())&&/[a-z0-9]/.test(p)){if(/[0-9]/.test(p)&&+p>=n){if("1"===p&&1===n)continue;throw new Error(p+" is not a valid digit in base "+e+".")}if(p.charCodeAt(0)-87>=n)throw new Error(p+" is not a valid digit in base "+e+".")}}if(2<=e&&e<=36&&r<=s/Math.log(e)){var o=parseInt(t,e);if(isNaN(o))throw new Error(p+" is not a valid digit in base "+e+".");return new SmallInteger(parseInt(t,e))}e=parseValue(e);var a=[],u="-"===t[0];for(i=u?1:0;i<t.length;i++){var p,l=(p=t[i].toLowerCase()).charCodeAt(0);if(48<=l&&l<=57)a.push(parseValue(p));else if(97<=l&&l<=122)a.push(parseValue(p.charCodeAt(0)-87));else{if("<"!==p)throw new Error(p+" is not a valid character");var c=i;do{i++}while(">"!==t[i]);a.push(parseValue(t.slice(c+1,i)))}}return parseBaseFromArray(a,e,u)};function parseBaseFromArray(t,e,r){var n,i=Integer[0],o=Integer[1];for(n=t.length-1;n>=0;n--)i=i.add(t[n].times(o)),o=o.times(e);return r?i.negate():i}function stringify(t){return t<=35?"0123456789abcdefghijklmnopqrstuvwxyz".charAt(t):"<"+t+">"}function toBase(t,e){if((e=i(e)).isZero()){if(t.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(e.equals(-1)){if(t.isZero())return{value:[0],isNegative:!1};if(t.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-t)).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var r=Array.apply(null,Array(+t-1)).map(Array.prototype.valueOf,[0,1]);return r.unshift([1]),{value:[].concat.apply([],r),isNegative:!1}}var n=!1;if(t.isNegative()&&e.isPositive()&&(n=!0,t=t.abs()),e.equals(1))return t.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(+t)).map(Number.prototype.valueOf,1),isNegative:n};for(var o,s=[],a=t;a.isNegative()||a.compareAbs(e)>=0;){o=a.divmod(e),a=o.quotient;var u=o.remainder;u.isNegative()&&(u=e.minus(u).abs(),a=a.next()),s.push(u.toJSNumber())}return s.push(a.toJSNumber()),{value:s.reverse(),isNegative:n}}function toBaseString(t,e){var r=toBase(t,e);return(r.isNegative?"-":"")+r.value.map(stringify).join("")}function parseStringValue(t){if(isPrecise(+t)){var e=+t;if(e===truncate(e))return new SmallInteger(e);throw new Error("Invalid integer: "+t)}var n="-"===t[0];n&&(t=t.slice(1));var i=t.split(/e/i);if(i.length>2)throw new Error("Invalid integer: "+i.join("e"));if(2===i.length){var o=i[1];if("+"===o[0]&&(o=o.slice(1)),(o=+o)!==truncate(o)||!isPrecise(o))throw new Error("Invalid integer: "+o+" is not a valid exponent.");var s=i[0],a=s.indexOf(".");if(a>=0&&(o-=s.length-a-1,s=s.slice(0,a)+s.slice(a+1)),o<0)throw new Error("Cannot include negative exponent part for integers");t=s+=new Array(o+1).join("0")}if(!/^([0-9][0-9]*)$/.test(t))throw new Error("Invalid integer: "+t);for(var u=[],p=t.length,l=r,c=p-l;p>0;)u.push(+t.slice(c,p)),(c-=l)<0&&(c=0),p-=l;return trim(u),new BigInteger(u,n)}function parseValue(t){return"number"==typeof t?function parseNumberValue(t){if(isPrecise(t)){if(t!==truncate(t))throw new Error(t+" is not an integer.");return new SmallInteger(t)}return parseStringValue(t.toString())}(t):"string"==typeof t?parseStringValue(t):t}BigInteger.prototype.toArray=function(t){return toBase(this,t)},SmallInteger.prototype.toArray=function(t){return toBase(this,t)},BigInteger.prototype.toString=function(e){if(e===t&&(e=10),10!==e)return toBaseString(this,e);for(var r,n=this.value,i=n.length,o=String(n[--i]);--i>=0;)r=String(n[i]),o+="0000000".slice(r.length)+r;return(this.sign?"-":"")+o},SmallInteger.prototype.toString=function(e){return e===t&&(e=10),10!=e?toBaseString(this,e):String(this.value)},BigInteger.prototype.toJSON=SmallInteger.prototype.toJSON=function(){return this.toString()},BigInteger.prototype.valueOf=function(){return parseInt(this.toString(),10)},BigInteger.prototype.toJSNumber=BigInteger.prototype.valueOf,SmallInteger.prototype.valueOf=function(){return this.value},SmallInteger.prototype.toJSNumber=SmallInteger.prototype.valueOf;for(var h=0;h<1e3;h++)Integer[h]=new SmallInteger(h),h>0&&(Integer[-h]=new SmallInteger(-h));return Integer.one=Integer[1],Integer.zero=Integer[0],Integer.minusOne=Integer[-1],Integer.max=max,Integer.min=min,Integer.gcd=gcd,Integer.lcm=function lcm(t,e){return t=parseValue(t).abs(),e=parseValue(e).abs(),t.divide(gcd(t,e)).multiply(e)},Integer.isInstance=function(t){return t instanceof BigInteger||t instanceof SmallInteger},Integer.randBetween=function randBetween(t,r){var n=min(t=parseValue(t),r=parseValue(r)),i=max(t,r).subtract(n).add(1);if(i.isSmall)return n.add(Math.floor(Math.random()*i));for(var o=[],s=!0,a=i.value.length-1;a>=0;a--){var u=s?i.value[a]:e,p=truncate(Math.random()*u);o.unshift(p),p<u&&(s=!1)}return o=arrayToSmall(o),n.add("number"==typeof o?new SmallInteger(o):new BigInteger(o,!1))},Integer.fromArray=function(t,e,r){return parseBaseFromArray(t.map(parseValue),parseValue(e||10),r)},Integer}();t.hasOwnProperty("exports")&&(t.exports=i),void 0===(n=function(){return i}.apply(e,[]))||(t.exports=n)},296734:(t,e,r)=>{"use strict";var n=r(282825).validate,i={q:0,p:1,z:2,r:3,y:4,9:5,x:6,8:7,g:8,f:9,2:10,t:11,v:12,d:13,w:14,0:15,s:16,3:17,j:18,n:19,5:20,4:21,k:22,h:23,c:24,e:25,6:26,m:27,u:28,a:29,7:30,l:31};t.exports={encode:function encode(t){n(t instanceof Uint8Array,"Invalid data: "+t+".");for(var e="",r=0;r<t.length;++r){var i=t[r];n(0<=i&&i<32,"Invalid value: "+i+"."),e+="qpzry9x8gf2tvdw0s3jn54khce6mua7l"[i]}return e},decode:function decode(t){n("string"==typeof t,"Invalid base32-encoded string: "+t+".");for(var e=new Uint8Array(t.length),r=0;r<t.length;++r){var o=t[r];n(o in i,"Invalid value: "+o+"."),e[r]=i[o]}return e}}},850630:(t,e,r)=>{"use strict";var n=r(296734),i=r(664864),o=r(695179),s=r(282825),a=s.validate;var u=s.ValidationError,p=["bitcoincash","bchtest","bchreg"];function prefixToUint5Array(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;++r)e[r]=31&t[r].charCodeAt(0);return e}function concat(t,e){var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function polymod(t){for(var e=[656907472481,522768456162,0xf33e5fb3c4,748107326120,130178868336],r=i(1),n=0;n<t.length;++n){var o=t[n],s=r.shiftRight(35);r=r.and(34359738367).shiftLeft(5).xor(o);for(var a=0;a<e.length;++a)s.shiftRight(a).and(1).equals(1)&&(r=r.xor(e[a]))}return r.xor(1)}function hasSingleCase(t){return t===t.toLowerCase()||t===t.toUpperCase()}t.exports={encode:function encode(t,e,r){a("string"==typeof t&&function isValidPrefix(t){return hasSingleCase(t)&&-1!==p.indexOf(t.toLowerCase())}(t),"Invalid prefix: "+t+"."),a("string"==typeof e,"Invalid type: "+e+"."),a(r instanceof Uint8Array,"Invalid hash: "+r+".");var i=concat(prefixToUint5Array(t),new Uint8Array(1)),s=function getTypeBits(t){switch(t){case"P2PKH":return 0;case"P2SH":return 8;default:throw new u("Invalid type: "+t+".")}}(e)+function getHashSizeBits(t){switch(8*t.length){case 160:return 0;case 192:return 1;case 224:return 2;case 256:return 3;case 320:return 4;case 384:return 5;case 448:return 6;case 512:return 7;default:throw new u("Invalid hash size: "+t.length+".")}}(r),l=function toUint5Array(t){return o(t,8,5)}(concat(new Uint8Array([s]),r)),c=concat(concat(i,l),new Uint8Array(8)),h=concat(l,function checksumToUint5Array(t){for(var e=new Uint8Array(8),r=0;r<8;++r)e[7-r]=t.and(31).toJSNumber(),t=t.shiftRight(5);return e}(polymod(c)));return t+":"+n.encode(h)},decode:function decode(t){a("string"==typeof t&&hasSingleCase(t),"Invalid address: "+t+".");var e=t.toLowerCase().split(":");a(2===e.length,"Missing prefix: "+t+".");var r=e[0],i=n.decode(e[1]);a(function validChecksum(t,e){var r=concat(prefixToUint5Array(t),new Uint8Array(1)),n=concat(r,e);return polymod(n).equals(0)}(r,i),"Invalid checksum: "+t+".");var s=function fromUint5Array(t){return o(t,5,8,!0)}(i.subarray(0,-8)),p=s[0],l=s.subarray(1);a(function getHashSize(t){switch(7&t){case 0:return 160;case 1:return 192;case 2:return 224;case 3:return 256;case 4:return 320;case 5:return 384;case 6:return 448;case 7:return 512}}(p)===8*l.length,"Invalid hash size: "+t+".");var c=function getType(t){switch(120&t){case 0:return"P2PKH";case 8:return"P2SH";default:throw new u("Invalid address type in version byte: "+t+".")}}(p);return{prefix:r,type:c,hash:l}},ValidationError:u}},695179:(t,e,r)=>{"use strict";var n=r(282825).validate;t.exports=function(t,e,r,i){for(var o=i?Math.floor(t.length*e/r):Math.ceil(t.length*e/r),s=(1<<r)-1,a=new Uint8Array(o),u=0,p=0,l=0,c=0;c<t.length;++c){var h=t[c];for(n(0<=h&&!(h>>e),"Invalid value: "+h+"."),p=p<<e|h,l+=e;l>=r;)l-=r,a[u]=p>>l&s,++u}return i?n(l<e&&!(p<<r-l&s),"Input cannot be converted to "+r+" bits without padding, but strict mode was used."):l>0&&(a[u]=p<<r-l&s,++u),a}},282825:t=>{"use strict";function ValidationError(t){var e=new Error;this.name=e.name="ValidationError",this.message=e.message=t,this.stack=e.stack}ValidationError.prototype=Object.create(Error.prototype),t.exports={ValidationError,validate:function validate(t,e){if(!t)throw new ValidationError(e)}}},557809:(t,e,r)=>{"use strict";r.d(e,{iL:()=>Psbt});var n={};r.r(n),r.d(n,{decode:()=>script_signature_decode,encode:()=>script_signature_encode});var i=r(464070);class ValidationError extends Error{name="ValidationError";constructor(t){super(t),Object.setPrototypeOf(this,ValidationError.prototype)}}function validation_validate(t,e){if(!t)throw new ValidationError(e)}const o={q:0,p:1,z:2,r:3,y:4,9:5,x:6,8:7,g:8,f:9,2:10,t:11,v:12,d:13,w:14,0:15,s:16,3:17,j:18,n:19,5:20,4:21,k:22,h:23,c:24,e:25,6:26,m:27,u:28,a:29,7:30,l:31};const s=validation_validate;function cashaddr_decode(t){s("string"==typeof t&&hasSingleCase(t),"Invalid address: "+t+".");const e=t.toLowerCase().split(":");s(2===e.length,"Missing prefix: "+t+".");const r=e[0],n=function decode(t){validation_validate("string"==typeof t,"Invalid base32-encoded string: "+t+".");const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const n=t[r];validation_validate(n in o,"Invalid value: "+n+"."),e[r]=o[n]}return e}(e[1]);s(function validChecksum(t,e){const r=concat(prefixToUint5Array(t),new Uint8Array(1)),n=concat(r,e);return polymod(n).equals(0)}(r,n),"Invalid checksum: "+t+".");const i=function fromUint5Array(t){return function convertBits_convertBits(t,e,r,n){const i=n?Math.floor(t.length*e/r):Math.ceil(t.length*e/r),o=(1<<r)-1,s=new Uint8Array(i);let a=0,u=0,p=0;for(const n of t)for(validation_validate(0<=n&&!(n>>e),"Invalid value: "+n+"."),u=u<<e|n,p+=e;p>=r;)p-=r,s[a]=u>>p&o,++a;return n?validation_validate(p<e&&!(u<<r-p&o),"Input cannot be converted to "+r+" bits without padding, but strict mode was used."):p>0&&(s[a]=u<<r-p&o,++a),s}(t,5,8,!0)}(n.subarray(0,-8)),u=i[0],p=i.subarray(1);s(function getHashSize(t){switch(7&t){case 0:return 160;case 1:return 192;case 2:return 224;case 3:return 256;case 4:return 320;case 5:return 384;case 6:return 448;case 7:return 512;default:throw new a("Invalid versionByte: "+(7&t)+".")}}(u)===8*p.length,"Invalid hash size: "+t+".");const l=function getType(t){switch(120&t){case 0:return"P2PKH";case 8:return"P2SH";default:throw new a("Invalid address type in version byte: "+t+".")}}(u);return{prefix:r,type:l,hash:p}}const a=ValidationError,u=["bitcoincash","bchtest","bchreg"];function prefixToUint5Array(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=31&t[r].charCodeAt(0);return e}function concat(t,e){const r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function polymod(t){const e=[656907472481,522768456162,0xf33e5fb3c4,748107326120,130178868336];let r=i(1);for(const n of t){const t=r.shiftRight(35);r=r.and(34359738367).shiftLeft(5).xor(n);for(let n=0;n<e.length;++n)t.shiftRight(n).and(1).equals(1)&&(r=r.xor(e[n]))}return r.xor(1)}function hasSingleCase(t){return t===t.toLowerCase()||t===t.toUpperCase()}const p={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},l={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},c={messagePrefix:"Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};function bip66_encode(t,e){const r=t.length,n=e.length;if(0===r)throw new Error("R length is zero");if(0===n)throw new Error("S length is zero");if(r>33)throw new Error("R length is too long");if(n>33)throw new Error("S length is too long");if(128&t[0])throw new Error("R value is negative");if(128&e[0])throw new Error("S value is negative");if(r>1&&0===t[0]&&!(128&t[1]))throw new Error("R value excessively padded");if(n>1&&0===e[0]&&!(128&e[1]))throw new Error("S value excessively padded");const i=new Uint8Array(6+r+n);return i[0]=48,i[1]=i.length-2,i[2]=2,i[3]=t.length,i.set(t,4),i[4+r]=2,i[5+r]=e.length,i.set(e,6+r),i}const h={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_CHECKSIGADD:186,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255},f={};for(const t of Object.keys(h)){const e=h[t];f[e]=t}var g=r(527294);function encodingLength(t){return t<h.OP_PUSHDATA1?1:t<=255?2:t<=65535?3:5}function push_data_decode(t,e){const r=g.pJ(t,e);let n,i;if(r<h.OP_PUSHDATA1)n=r,i=1;else if(r===h.OP_PUSHDATA1){if(e+2>t.length)return null;n=g.pJ(t,e+1),i=2}else if(r===h.OP_PUSHDATA2){if(e+3>t.length)return null;n=g.aj(t,e+1,"LE"),i=3}else{if(e+5>t.length)return null;if(r!==h.OP_PUSHDATA4)throw new Error("Unexpected opcode");n=g.UP(t,e+1,"LE"),i=5}return{opcode:r,number:n,size:i}}var d=r(407295);const y=new Uint8Array(32),m=g.aD("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),NBufferSchemaFactory=t=>d.FsL(d.KJ$(Uint8Array),d.Bw9(t));function types_stacksEqual(t,e){return t.length===e.length&&t.every(((t,r)=>0===g.UD(t,e[r])))}function isPoint(t){if(!(t instanceof Uint8Array))return!1;if(t.length<33)return!1;const e=t[0],r=t.slice(1,33);if(0===g.UD(y,r))return!1;if(g.UD(r,m)>=0)return!1;if((2===e||3===e)&&33===t.length)return!0;const n=t.slice(33);return 0!==g.UD(y,n)&&(!(g.UD(n,m)>=0)&&(4===e&&65===t.length))}const w=254;function types_isTapleaf(t){return!(!t||!("output"in t))&&(t.output instanceof Uint8Array&&(void 0===t.version||(t.version&w)===t.version))}function types_isTaptree(t){return Array.isArray(t)?2===t.length&&t.every((t=>types_isTaptree(t))):types_isTapleaf(t)}const v=NBufferSchemaFactory(32),I=NBufferSchemaFactory(20),S=NBufferSchemaFactory(32),b=d.KJ$(Uint8Array),_=(d.FsL(d.YjP(),d.yGV(/^([0-9a-f]{2})+$/i)),d.FsL(d.aig(),d.ndf(),d.Wwf(0),d.cGV(255))),E=d.FsL(d.aig(),d.ndf(),d.Wwf(0),d.cGV(4294967295)),A=d.FsL(d.aig(),d.ndf(),d.Wwf(0),d.cGV(Number.MAX_SAFE_INTEGER)),T=d.FsL(d.oad(),d.Wwf(0n),d.cGV(0x7fffffffffffffffn)),NullablePartial=t=>d.Ikc(Object.entries(t).reduce(((t,e)=>({...t,[e[0]]:d.cl6(e[1])})),{})),P=new Uint8Array(1);function toDER(t){let e=0;for(;0===t[e];)++e;return e===t.length?P:128&(t=t.slice(e))[0]?g.xW([P,t]):t}function fromDER(t){0===t[0]&&(t=t.slice(1));const e=new Uint8Array(32),r=Math.max(0,32-t.length);return e.set(t,r),e}function script_signature_decode(t){const e=g.pJ(t,t.length-1);if(!isDefinedHashType(e))throw new Error("Invalid hashType "+e);const r=function bip66_decode(t){if(t.length<8)throw new Error("DER sequence length is too short");if(t.length>72)throw new Error("DER sequence length is too long");if(48!==t[0])throw new Error("Expected DER sequence");if(t[1]!==t.length-2)throw new Error("DER sequence length is invalid");if(2!==t[2])throw new Error("Expected DER integer");const e=t[3];if(0===e)throw new Error("R length is zero");if(5+e>=t.length)throw new Error("R length is too long");if(2!==t[4+e])throw new Error("Expected DER integer (2)");const r=t[5+e];if(0===r)throw new Error("S length is zero");if(6+e+r!==t.length)throw new Error("S length is invalid");if(128&t[4])throw new Error("R value is negative");if(e>1&&0===t[4]&&!(128&t[5]))throw new Error("R value excessively padded");if(128&t[e+6])throw new Error("S value is negative");if(r>1&&0===t[e+6]&&!(128&t[e+7]))throw new Error("S value excessively padded");return{r:t.slice(4,4+e),s:t.slice(6+e)}}(t.subarray(0,-1)),n=fromDER(r.r),i=fromDER(r.s);return{signature:g.xW([n,i]),hashType:e}}function script_signature_encode(t,e){if(d.qgA(d.Ikc({signature:NBufferSchemaFactory(64),hashType:_}),{signature:t,hashType:e}),!isDefinedHashType(e))throw new Error("Invalid hashType "+e);const r=new Uint8Array(1);g.Gs(r,0,e);const n=toDER(t.slice(0,32)),i=toDER(t.slice(32,64));return g.xW([bip66_encode(n,i),r])}const B=h.OP_RESERVED,O=d.YOg(d.KCZ([d.KJ$(Uint8Array),d.aig()]));function isPushOnlyChunk(t){return d.is(b,t)||function isOPInt(t){return d.is(d.aig(),t)&&(t===h.OP_0||t>=h.OP_1&&t<=h.OP_16||t===h.OP_1NEGATE)}(t)}function isPushOnly(t){return d.is(d.FsL(d.bzn(),d.l5M(isPushOnlyChunk)),t)}function countNonPushOnlyOPs(t){return t.length-t.filter(isPushOnlyChunk).length}function asMinimalOP(t){return 0===t.length?h.OP_0:1===t.length?t[0]>=1&&t[0]<=16?B+t[0]:129===t[0]?h.OP_1NEGATE:void 0:void 0}function chunksIsBuffer(t){return t instanceof Uint8Array}function singleChunkIsBuffer(t){return t instanceof Uint8Array}function compile(t){if(chunksIsBuffer(t))return t;d.qgA(O,t);const e=t.reduce(((t,e)=>singleChunkIsBuffer(e)?1===e.length&&void 0!==asMinimalOP(e)?t+1:t+encodingLength(e.length)+e.length:t+1),0),r=new Uint8Array(e);let n=0;if(t.forEach((t=>{if(singleChunkIsBuffer(t)){const e=asMinimalOP(t);if(void 0!==e)return g.Gs(r,n,e),void(n+=1);n+=function push_data_encode(t,e,r){const n=encodingLength(e);return 1===n?g.Gs(t,r,e):2===n?(g.Gs(t,r,h.OP_PUSHDATA1),g.Gs(t,r+1,e)):3===n?(g.Gs(t,r,h.OP_PUSHDATA2),g.hF(t,r+1,e,"LE")):(g.Gs(t,r,h.OP_PUSHDATA4),g.b1(t,r+1,e,"LE")),n}(r,t.length,n),r.set(t,n),n+=t.length}else g.Gs(r,n,t),n+=1})),n!==r.length)throw new Error("Could not decode chunks");return r}function script_decompile(t){if(function chunksIsArray(t){return d.is(O,t)}(t))return t;d.qgA(b,t);const e=[];let r=0;for(;r<t.length;){const n=t[r];if(n>h.OP_0&&n<=h.OP_PUSHDATA4){const n=push_data_decode(t,r);if(null===n)return null;if(r+=n.size,r+n.number>t.length)return null;const i=t.slice(r,r+n.number);r+=n.number;const o=asMinimalOP(i);void 0!==o?e.push(o):e.push(i)}else e.push(n),r+=1}return e}function toStack(t){return t=script_decompile(t),d.qgA(d.IeY(isPushOnly),t),t.map((t=>singleChunkIsBuffer(t)?t:t===h.OP_0?new Uint8Array(0):function script_number_encode(t){let e=Math.abs(t);const r=function scriptNumSize(t){return t>2147483647?5:t>8388607?4:t>32767?3:t>127?2:t>0?1:0}(e),n=new Uint8Array(r),i=t<0;for(let t=0;t<r;++t)g.Gs(n,t,255&e),e>>=8;return 128&n[r-1]?g.Gs(n,r-1,i?128:0):i&&(n[r-1]|=128),n}(t-B)))}function isDefinedHashType(t){const e=-193&t;return e>0&&e<4}function isCanonicalScriptSignature(t){return t instanceof Uint8Array&&(!!isDefinedHashType(t[t.length-1])&&function check(t){if(t.length<8)return!1;if(t.length>72)return!1;if(48!==t[0])return!1;if(t[1]!==t.length-2)return!1;if(2!==t[2])return!1;const e=t[3];if(0===e)return!1;if(5+e>=t.length)return!1;if(2!==t[4+e])return!1;const r=t[5+e];return!(0===r||6+e+r!==t.length||128&t[4]||e>1&&0===t[4]&&!(128&t[5])||128&t[e+6]||r>1&&0===t[e+6]&&!(128&t[e+7]))}(t.slice(0,-1)))}const k=n;function prop(t,e,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){const t=r.call(this);return this[e]=t,t},set(t){Object.defineProperty(this,e,{configurable:!0,enumerable:!0,value:t,writable:!0})}})}function value(t){let e;return()=>(void 0!==e||(e=t()),e)}const H=h,N=H.OP_RESERVED;function p2ms_p2ms(t,e){if(!(t.input||t.output||t.pubkeys&&void 0!==t.m||t.signatures))throw new TypeError("Not enough data");function isAcceptableSignature(t){return isCanonicalScriptSignature(t)||void 0!==(e.allowIncomplete&&t===H.OP_0)}e=Object.assign({validate:!0},e||{}),d.qgA(d.OH3(d.Ikc({network:d.Ikc({}),m:d.aig(),n:d.aig(),output:b,pubkeys:d.YOg(d.IeY(isPoint),"Received invalid pubkey"),signatures:d.YOg(d.IeY(isAcceptableSignature),"Expected signature to be of type isAcceptableSignature"),input:b})),t);const r={network:t.network||p};let n=[],i=!1;function decode(t){i||(i=!0,n=script_decompile(t),r.m=n[0]-N,r.n=n[n.length-2]-N,r.pubkeys=n.slice(1,-2))}if(prop(r,"output",(()=>{if(t.m&&r.n&&t.pubkeys)return compile([].concat(N+t.m,t.pubkeys,N+r.n,H.OP_CHECKMULTISIG))})),prop(r,"m",(()=>{if(r.output)return decode(r.output),r.m})),prop(r,"n",(()=>{if(r.pubkeys)return r.pubkeys.length})),prop(r,"pubkeys",(()=>{if(t.output)return decode(t.output),r.pubkeys})),prop(r,"signatures",(()=>{if(t.input)return script_decompile(t.input).slice(1)})),prop(r,"input",(()=>{if(t.signatures)return compile([H.OP_0].concat(t.signatures))})),prop(r,"witness",(()=>{if(r.input)return[]})),prop(r,"name",(()=>{if(r.m&&r.n)return`p2ms(${r.m} of ${r.n})`})),e.validate){if(t.output){if(decode(t.output),d.qgA(d.aig(),n[0],{message:"Output is invalid"}),d.qgA(d.aig(),n[n.length-2],{message:"Output is invalid"}),n[n.length-1]!==H.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(r.m<=0||r.n>16||r.m>r.n||r.n!==n.length-3)throw new TypeError("Output is invalid");if(!r.pubkeys.every((t=>isPoint(t))))throw new TypeError("Output is invalid");if(void 0!==t.m&&t.m!==r.m)throw new TypeError("m mismatch");if(void 0!==t.n&&t.n!==r.n)throw new TypeError("n mismatch");if(t.pubkeys&&!types_stacksEqual(t.pubkeys,r.pubkeys))throw new TypeError("Pubkeys mismatch")}if(t.pubkeys){if(void 0!==t.n&&t.n!==t.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(r.n=t.pubkeys.length,r.n<r.m)throw new TypeError("Pubkey count cannot be less than m")}if(t.signatures){if(t.signatures.length<r.m)throw new TypeError("Not enough signatures provided");if(t.signatures.length>r.m)throw new TypeError("Too many signatures provided")}if(t.input){if(t.input[0]!==H.OP_0)throw new TypeError("Input is invalid");if(0===r.signatures.length||!r.signatures.every(isAcceptableSignature))throw new TypeError("Input has invalid signature(s)");if(t.signatures&&!types_stacksEqual(t.signatures,r.signatures))throw new TypeError("Signature mismatch");if(void 0!==t.m&&t.m!==t.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(r,t)}const U=h;function p2pk(t,e){if(!(t.input||t.output||t.pubkey||t.input||t.signature))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),d.qgA(d.OH3(d.Ikc({network:d.Ikc({}),output:b,pubkey:d.IeY(isPoint,"invalid pubkey"),signature:d.IeY(isCanonicalScriptSignature,"Expected signature to be of type isCanonicalScriptSignature"),input:b})),t);const r=value((()=>script_decompile(t.input))),n={name:"p2pk",network:t.network||p};if(prop(n,"output",(()=>{if(t.pubkey)return compile([t.pubkey,U.OP_CHECKSIG])})),prop(n,"pubkey",(()=>{if(t.output)return t.output.slice(1,-1)})),prop(n,"signature",(()=>{if(t.input)return r()[0]})),prop(n,"input",(()=>{if(t.signature)return compile([t.signature])})),prop(n,"witness",(()=>{if(n.input)return[]})),e.validate){if(t.output){if(t.output[t.output.length-1]!==U.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!isPoint(n.pubkey))throw new TypeError("Output pubkey is invalid");if(t.pubkey&&0!==g.UD(t.pubkey,n.pubkey))throw new TypeError("Pubkey mismatch")}if(t.signature&&t.input&&0!==g.UD(t.input,n.input))throw new TypeError("Signature mismatch");if(t.input){if(1!==r().length)throw new TypeError("Input is invalid");if(!isCanonicalScriptSignature(n.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(n,t)}var C=r(406440),x=r(552001);function hash160(t){return(0,C.H)((0,x.s)(t))}function hash256(t){return(0,x.s)((0,x.s)(t))}const V={"BIP0340/challenge":Uint8Array.from([123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124,123,181,45,122,159,239,88,50,62,177,191,122,64,125,179,130,210,243,242,216,27,177,34,79,73,254,81,143,109,72,211,124]),"BIP0340/aux":Uint8Array.from([241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144,241,239,78,94,192,99,202,218,109,148,202,250,157,152,126,160,105,38,88,57,236,193,31,151,45,119,165,46,216,193,204,144]),"BIP0340/nonce":Uint8Array.from([7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47,7,73,119,52,167,155,203,53,91,155,140,125,3,79,18,28,244,52,215,62,247,45,218,25,135,0,97,251,82,191,235,47]),TapLeaf:Uint8Array.from([174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238,174,234,143,220,66,8,152,49,5,115,75,88,8,29,30,38,56,211,95,28,181,64,8,212,211,87,202,3,190,120,233,238]),TapBranch:Uint8Array.from([25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21,25,65,161,242,229,110,185,95,162,169,241,148,190,92,1,247,33,111,51,237,130,176,145,70,52,144,208,91,245,22,160,21]),TapSighash:Uint8Array.from([244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49,244,10,72,223,75,42,112,200,180,146,75,242,101,70,97,237,61,149,253,102,163,19,235,135,35,117,151,198,40,228,160,49]),TapTweak:Uint8Array.from([232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233,232,15,225,99,156,156,160,80,227,175,27,57,193,67,198,62,66,156,188,235,21,217,64,251,181,197,161,244,175,87,197,233]),"KeyAgg list":Uint8Array.from([72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240,72,28,151,28,60,11,70,215,240,178,117,174,89,141,78,44,126,215,49,156,89,74,92,110,199,158,160,212,153,2,148,240]),"KeyAgg coefficient":Uint8Array.from([191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129,191,201,4,3,77,28,136,232,200,14,34,229,61,36,86,109,100,130,78,214,66,114,129,192,145,0,249,77,205,82,201,129])};function taggedHash(t,e){return(0,x.s)(g.xW([V[t],e]))}const L=function base(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let t=0;t<e.length;t++)e[t]=255;for(let r=0;r<t.length;r++){const n=t.charAt(r),i=n.charCodeAt(0);if(255!==e[i])throw new TypeError(n+" is ambiguous");e[i]=r}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),o=Math.log(256)/Math.log(r);function decodeUnsafe(t){if("string"!=typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;let o=0,s=0,a=0;for(;t[o]===n;)s++,o++;const u=(t.length-o)*i+1>>>0,p=new Uint8Array(u);for(;t[o];){let n=e[t.charCodeAt(o)];if(255===n)return;let i=0;for(let t=u-1;(0!==n||i<a)&&-1!==t;t--,i++)n+=r*p[t]>>>0,p[t]=n%256>>>0,n=n/256>>>0;if(0!==n)throw new Error("Non-zero carry");a=i,o++}let l=u-a;for(;l!==u&&0===p[l];)l++;const c=new Uint8Array(s+(u-l));let h=s;for(;l!==u;)c[h++]=p[l++];return c}return{encode:function encode(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";let i=0,s=0,a=0;const u=e.length;for(;a!==u&&0===e[a];)a++,i++;const p=(u-a)*o+1>>>0,l=new Uint8Array(p);for(;a!==u;){let t=e[a],n=0;for(let e=p-1;(0!==t||n<s)&&-1!==e;e--,n++)t+=256*l[e]>>>0,l[e]=t%r>>>0,t=t/r>>>0;if(0!==t)throw new Error("Non-zero carry");s=n,a++}let c=p-s;for(;c!==p&&0===l[c];)c++;let h=n.repeat(i);for(;c<p;++c)h+=t.charAt(l[c]);return h},decodeUnsafe,decode:function decode(t){const e=decodeUnsafe(t);if(e)return e;throw new Error("Non-base"+r+" character")}}};const F=L("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");const D=function esm_base(t){function decodeRaw(e){var r=e.slice(0,-4),n=e.slice(-4),i=t(r);if(!(n[0]^i[0]|n[1]^i[1]|n[2]^i[2]|n[3]^i[3]))return r}return{encode:function encode(e){var r=Uint8Array.from(e),n=t(r),i=r.length+4,o=new Uint8Array(i);return o.set(r,0),o.set(n.subarray(0,4),r.length),F.encode(o)},decode:function decode(t){var e=decodeRaw(F.decode(t));if(null==e)throw new Error("Invalid checksum");return e},decodeUnsafe:function decodeUnsafe(t){var e=F.decodeUnsafe(t);if(null!=e)return decodeRaw(e)}}}((function sha256x2(t){return(0,x.s)((0,x.s)(t))})),M=h;function p2pkh(t,e){if(!(t.address||t.hash||t.output||t.pubkey||t.input))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),d.qgA(d.OH3(d.Ikc({network:d.Ikc({}),address:d.YjP(),hash:I,output:NBufferSchemaFactory(25),pubkey:d.IeY(isPoint),signature:d.IeY(isCanonicalScriptSignature),input:b})),t);const r=value((()=>{const e=D.decode(t.address);return{version:g.pJ(e,0),hash:e.slice(1)}})),n=value((()=>script_decompile(t.input))),i=t.network||p,o={name:"p2pkh",network:i};if(prop(o,"address",(()=>{if(!o.hash)return;const t=new Uint8Array(21);return g.Gs(t,0,i.pubKeyHash),t.set(o.hash,1),D.encode(t)})),prop(o,"hash",(()=>t.output?t.output.slice(3,23):t.address?r().hash:t.pubkey||o.pubkey?hash160(t.pubkey||o.pubkey):void 0)),prop(o,"output",(()=>{if(o.hash)return compile([M.OP_DUP,M.OP_HASH160,o.hash,M.OP_EQUALVERIFY,M.OP_CHECKSIG])})),prop(o,"pubkey",(()=>{if(t.input)return n()[1]})),prop(o,"signature",(()=>{if(t.input)return n()[0]})),prop(o,"input",(()=>{if(t.pubkey&&t.signature)return compile([t.signature,t.pubkey])})),prop(o,"witness",(()=>{if(o.input)return[]})),e.validate){let e=Uint8Array.from([]);if(t.address){if(r().version!==i.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(20!==r().hash.length)throw new TypeError("Invalid address");e=r().hash}if(t.hash){if(e.length>0&&0!==g.UD(e,t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(25!==t.output.length||t.output[0]!==M.OP_DUP||t.output[1]!==M.OP_HASH160||20!==t.output[2]||t.output[23]!==M.OP_EQUALVERIFY||t.output[24]!==M.OP_CHECKSIG)throw new TypeError("Output is invalid");const r=t.output.slice(3,23);if(e.length>0&&0!==g.UD(e,r))throw new TypeError("Hash mismatch");e=r}if(t.pubkey){const r=hash160(t.pubkey);if(e.length>0&&0!==g.UD(e,r))throw new TypeError("Hash mismatch");e=r}if(t.input){const r=n();if(2!==r.length)throw new TypeError("Input is invalid");if(!isCanonicalScriptSignature(r[0]))throw new TypeError("Input has invalid signature");if(!isPoint(r[1]))throw new TypeError("Input has invalid pubkey");if(t.signature&&0!==g.UD(t.signature,r[0]))throw new TypeError("Signature mismatch");if(t.pubkey&&0!==g.UD(t.pubkey,r[1]))throw new TypeError("Pubkey mismatch");const i=hash160(r[1]);if(e.length>0&&0!==g.UD(e,i))throw new TypeError("Hash mismatch")}}return Object.assign(o,t)}const R=h;function p2sh_p2sh(t,e){if(!(t.address||t.hash||t.output||t.redeem||t.input))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),d.qgA(d.OH3(d.Ikc({network:d.Ikc({}),address:d.YjP(),hash:NBufferSchemaFactory(20),output:NBufferSchemaFactory(23),redeem:d.OH3(d.Ikc({network:d.Ikc({}),output:b,input:b,witness:d.YOg(b)})),input:b,witness:d.YOg(b)})),t);let r=t.network;r||(r=t.redeem&&t.redeem.network||p);const n={network:r},i=value((()=>{const e=D.decode(t.address);return{version:g.pJ(e,0),hash:e.slice(1)}})),o=value((()=>script_decompile(t.input))),s=value((()=>{const e=o(),n=e[e.length-1];return{network:r,output:n===R.OP_FALSE?Uint8Array.from([]):n,input:compile(e.slice(0,-1)),witness:t.witness||[]}}));if(prop(n,"address",(()=>{if(!n.hash)return;const t=new Uint8Array(21);return g.Gs(t,0,n.network.scriptHash),t.set(n.hash,1),D.encode(t)})),prop(n,"hash",(()=>t.output?t.output.slice(2,22):t.address?i().hash:n.redeem&&n.redeem.output?hash160(n.redeem.output):void 0)),prop(n,"output",(()=>{if(n.hash)return compile([R.OP_HASH160,n.hash,R.OP_EQUAL])})),prop(n,"redeem",(()=>{if(t.input)return s()})),prop(n,"input",(()=>{if(t.redeem&&t.redeem.input&&t.redeem.output)return compile([].concat(script_decompile(t.redeem.input),t.redeem.output))})),prop(n,"witness",(()=>n.redeem&&n.redeem.witness?n.redeem.witness:n.input?[]:void 0)),prop(n,"name",(()=>{const t=["p2sh"];return void 0!==n.redeem&&void 0!==n.redeem.name&&t.push(n.redeem.name),t.join("-")})),e.validate){let e=Uint8Array.from([]);if(t.address){if(i().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(20!==i().hash.length)throw new TypeError("Invalid address");e=i().hash}if(t.hash){if(e.length>0&&0!==g.UD(e,t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(23!==t.output.length||t.output[0]!==R.OP_HASH160||20!==t.output[1]||t.output[22]!==R.OP_EQUAL)throw new TypeError("Output is invalid");const r=t.output.slice(2,22);if(e.length>0&&0!==g.UD(e,r))throw new TypeError("Hash mismatch");e=r}const checkRedeem=t=>{if(t.output){const r=script_decompile(t.output);if(!r||r.length<1)throw new TypeError("Redeem.output too short");if(t.output.byteLength>520)throw new TypeError("Redeem.output unspendable if larger than 520 bytes");if(countNonPushOnlyOPs(r)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const n=hash160(t.output);if(e.length>0&&0!==g.UD(e,n))throw new TypeError("Hash mismatch");e=n}if(t.input){const e=t.input.length>0,r=t.witness&&t.witness.length>0;if(!e&&!r)throw new TypeError("Empty input");if(e&&r)throw new TypeError("Input and witness provided");if(e){if(!isPushOnly(script_decompile(t.input)))throw new TypeError("Non push-only scriptSig")}}};if(t.input){const t=o();if(!t||t.length<1)throw new TypeError("Input too short");if(!(s().output instanceof Uint8Array))throw new TypeError("Input is invalid");checkRedeem(s())}if(t.redeem){if(t.redeem.network&&t.redeem.network!==r)throw new TypeError("Network mismatch");if(t.input){const e=s();if(t.redeem.output&&0!==g.UD(t.redeem.output,e.output))throw new TypeError("Redeem.output mismatch");if(t.redeem.input&&0!==g.UD(t.redeem.input,e.input))throw new TypeError("Redeem.input mismatch")}checkRedeem(t.redeem)}if(t.witness&&t.redeem&&t.redeem.witness&&!types_stacksEqual(t.redeem.witness,t.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(n,t)}var q=r(146586);const W=h,K=new Uint8Array(0);function p2wpkh(t,e){if(!(t.address||t.hash||t.output||t.pubkey||t.witness))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),d.qgA(d.OH3(d.Ikc({address:d.YjP(),hash:NBufferSchemaFactory(20),input:NBufferSchemaFactory(0),network:d.Ikc({}),output:NBufferSchemaFactory(22),pubkey:d.IeY(isPoint,"Not a valid pubkey"),signature:d.IeY(isCanonicalScriptSignature),witness:d.YOg(b)})),t);const r=value((()=>{const e=q.bech32.decode(t.address),r=e.words.shift(),n=q.bech32.fromWords(e.words);return{version:r,prefix:e.prefix,data:Uint8Array.from(n)}})),n=t.network||p,i={name:"p2wpkh",network:n};if(prop(i,"address",(()=>{if(!i.hash)return;const t=q.bech32.toWords(i.hash);return t.unshift(0),q.bech32.encode(n.bech32,t)})),prop(i,"hash",(()=>t.output?t.output.slice(2,22):t.address?r().data:t.pubkey||i.pubkey?hash160(t.pubkey||i.pubkey):void 0)),prop(i,"output",(()=>{if(i.hash)return compile([W.OP_0,i.hash])})),prop(i,"pubkey",(()=>t.pubkey?t.pubkey:t.witness?t.witness[1]:void 0)),prop(i,"signature",(()=>{if(t.witness)return t.witness[0]})),prop(i,"input",(()=>{if(i.witness)return K})),prop(i,"witness",(()=>{if(t.pubkey&&t.signature)return[t.signature,t.pubkey]})),e.validate){let e=Uint8Array.from([]);if(t.address){if(n&&n.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(20!==r().data.length)throw new TypeError("Invalid address data");e=r().data}if(t.hash){if(e.length>0&&0!==g.UD(e,t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(22!==t.output.length||t.output[0]!==W.OP_0||20!==t.output[1])throw new TypeError("Output is invalid");if(e.length>0&&0!==g.UD(e,t.output.slice(2)))throw new TypeError("Hash mismatch");e=t.output.slice(2)}if(t.pubkey){const r=hash160(t.pubkey);if(e.length>0&&0!==g.UD(e,r))throw new TypeError("Hash mismatch");if(e=r,!isPoint(t.pubkey)||33!==t.pubkey.length)throw new TypeError("Invalid pubkey for p2wpkh")}if(t.witness){if(2!==t.witness.length)throw new TypeError("Witness is invalid");if(!isCanonicalScriptSignature(t.witness[0]))throw new TypeError("Witness has invalid signature");if(!isPoint(t.witness[1])||33!==t.witness[1].length)throw new TypeError("Witness has invalid pubkey");if(t.signature&&0!==g.UD(t.signature,t.witness[0]))throw new TypeError("Signature mismatch");if(t.pubkey&&0!==g.UD(t.pubkey,t.witness[1]))throw new TypeError("Pubkey mismatch");const r=hash160(t.witness[1]);if(e.length>0&&0!==g.UD(e,r))throw new TypeError("Hash mismatch")}}return Object.assign(i,t)}const G=h,z=new Uint8Array(0);function chunkHasUncompressedPubkey(t){return!!(t instanceof Uint8Array&&65===t.length&&4===t[0]&&isPoint(t))}function p2wsh_p2wsh(t,e){if(!(t.address||t.hash||t.output||t.redeem||t.witness))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),d.qgA(NullablePartial({network:d.Ikc({}),address:d.YjP(),hash:v,output:NBufferSchemaFactory(34),redeem:NullablePartial({input:b,network:d.Ikc({}),output:b,witness:d.YOg(b)}),input:NBufferSchemaFactory(0),witness:d.YOg(b)}),t);const r=value((()=>{const e=q.bech32.decode(t.address),r=e.words.shift(),n=q.bech32.fromWords(e.words);return{version:r,prefix:e.prefix,data:Uint8Array.from(n)}})),n=value((()=>script_decompile(t.redeem.input)));let i=t.network;i||(i=t.redeem&&t.redeem.network||p);const o={network:i};if(prop(o,"address",(()=>{if(!o.hash)return;const t=q.bech32.toWords(o.hash);return t.unshift(0),q.bech32.encode(i.bech32,t)})),prop(o,"hash",(()=>t.output?t.output.slice(2):t.address?r().data:o.redeem&&o.redeem.output?(0,x.s)(o.redeem.output):void 0)),prop(o,"output",(()=>{if(o.hash)return compile([G.OP_0,o.hash])})),prop(o,"redeem",(()=>{if(t.witness)return{output:t.witness[t.witness.length-1],input:z,witness:t.witness.slice(0,-1)}})),prop(o,"input",(()=>{if(o.witness)return z})),prop(o,"witness",(()=>{if(t.redeem&&t.redeem.input&&t.redeem.input.length>0&&t.redeem.output&&t.redeem.output.length>0){const e=toStack(n());return o.redeem=Object.assign({witness:e},t.redeem),o.redeem.input=z,[].concat(e,t.redeem.output)}if(t.redeem&&t.redeem.output&&t.redeem.witness)return[].concat(t.redeem.witness,t.redeem.output)})),prop(o,"name",(()=>{const t=["p2wsh"];return void 0!==o.redeem&&void 0!==o.redeem.name&&t.push(o.redeem.name),t.join("-")})),e.validate){let e=Uint8Array.from([]);if(t.address){if(r().prefix!==i.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(32!==r().data.length)throw new TypeError("Invalid address data");e=r().data}if(t.hash){if(e.length>0&&0!==g.UD(e,t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(34!==t.output.length||t.output[0]!==G.OP_0||32!==t.output[1])throw new TypeError("Output is invalid");const r=t.output.slice(2);if(e.length>0&&0!==g.UD(e,r))throw new TypeError("Hash mismatch");e=r}if(t.redeem){if(t.redeem.network&&t.redeem.network!==i)throw new TypeError("Network mismatch");if(t.redeem.input&&t.redeem.input.length>0&&t.redeem.witness&&t.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(t.redeem.output){const r=script_decompile(t.redeem.output);if(!r||r.length<1)throw new TypeError("Redeem.output is invalid");if(t.redeem.output.byteLength>3600)throw new TypeError("Redeem.output unspendable if larger than 3600 bytes");if(countNonPushOnlyOPs(r)>201)throw new TypeError("Redeem.output unspendable with more than 201 non-push ops");const n=(0,x.s)(t.redeem.output);if(e.length>0&&0!==g.UD(e,n))throw new TypeError("Hash mismatch");e=n}if(t.redeem.input&&!isPushOnly(n()))throw new TypeError("Non push-only scriptSig");if(t.witness&&t.redeem.witness&&!types_stacksEqual(t.witness,t.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(t.redeem.input&&n().some(chunkHasUncompressedPubkey)||t.redeem.output&&(script_decompile(t.redeem.output)||[]).some(chunkHasUncompressedPubkey))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(t.witness&&t.witness.length>0){const e=t.witness[t.witness.length-1];if(t.redeem&&t.redeem.output&&0!==g.UD(t.redeem.output,e))throw new TypeError("Witness and redeem.output mismatch");if(t.witness.some(chunkHasUncompressedPubkey)||(script_decompile(e)||[]).some(chunkHasUncompressedPubkey))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(o,t)}const j={};function getEccLib(){if(!j.eccLib)throw new Error("No ECC Library provided. You must call initEccLib() with a valid TinySecp256k1Interface instance");return j.eccLib}var X=r(924398);function bufferutils_reverseBuffer(t){if(t.length<1)return t;let e=t.length-1,r=0;for(let n=0;n<t.length/2;n++)r=t[n],t[n]=t[e],t[e]=r,e--;return t}function cloneBuffer(t){const e=new Uint8Array(t.length);return e.set(t),e}class bufferutils_BufferWriter{buffer;offset;static withCapacity(t){return new bufferutils_BufferWriter(new Uint8Array(t))}constructor(t,e=0){this.buffer=t,this.offset=e,d.qgA(d.PVZ([b,E]),[t,e])}writeUInt8(t){this.offset=g.Gs(this.buffer,this.offset,t)}writeInt32(t){this.offset=g.g3(this.buffer,this.offset,t,"LE")}writeInt64(t){this.offset=g.LO(this.buffer,this.offset,BigInt(t),"LE")}writeUInt32(t){this.offset=g.b1(this.buffer,this.offset,t,"LE")}writeUInt64(t){this.offset=g.Cj(this.buffer,this.offset,BigInt(t),"LE")}writeVarInt(t){const{bytes:e}=X.encode(t,this.buffer,this.offset);this.offset+=e}writeSlice(t){if(this.buffer.length<this.offset+t.length)throw new Error("Cannot write slice out of bounds");this.buffer.set(t,this.offset),this.offset+=t.length}writeVarSlice(t){this.writeVarInt(t.length),this.writeSlice(t)}writeVector(t){this.writeVarInt(t.length),t.forEach((t=>this.writeVarSlice(t)))}end(){if(this.buffer.length===this.offset)return this.buffer;throw new Error(`buffer size ${this.buffer.length}, offset ${this.offset}`)}}class bufferutils_BufferReader{buffer;offset;constructor(t,e=0){this.buffer=t,this.offset=e,d.qgA(d.PVZ([b,E]),[t,e])}readUInt8(){const t=g.pJ(this.buffer,this.offset);return this.offset++,t}readInt32(){const t=g.p1(this.buffer,this.offset,"LE");return this.offset+=4,t}readUInt32(){const t=g.UP(this.buffer,this.offset,"LE");return this.offset+=4,t}readInt64(){const t=g.OU(this.buffer,this.offset,"LE");return this.offset+=8,t}readVarInt(){const{bigintValue:t,bytes:e}=X.decode(this.buffer,this.offset);return this.offset+=e,t}readSlice(t){!function verifuint(t,e){if("number"!=typeof t&&"bigint"!=typeof t)throw new Error("cannot write a non-number as a number");if(t<0&&t<BigInt(0))throw new Error("specified a negative value for writing an unsigned value");if(t>e&&t>BigInt(e))throw new Error("RangeError: value out of range");if(Math.floor(Number(t))!==Number(t))throw new Error("value has a fractional component")}(t,9007199254740991);const e=Number(t);if(this.buffer.length<this.offset+e)throw new Error("Cannot read slice out of bounds");const r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const t=this.readVarInt(),e=[];for(let r=0;r<t;r++)e.push(this.readVarSlice());return e}}const Y=192,Z=128,isHashBranch=t=>"left"in t&&"right"in t;function rootHashFromPath(t,e){if(t.length<33)throw new TypeError(`The control-block length is too small. Got ${t.length}, expected min 33.`);const r=(t.length-33)/32;let n=e;for(let e=0;e<r;e++){const r=t.slice(33+32*e,65+32*e);n=g.UD(n,r)<0?tapBranchHash(n,r):tapBranchHash(r,n)}return n}function toHashTree(t){if(types_isTapleaf(t))return{hash:tapleafHash(t)};const e=[toHashTree(t[0]),toHashTree(t[1])];e.sort(((t,e)=>g.UD(t.hash,e.hash)));const[r,n]=e;return{hash:tapBranchHash(r.hash,n.hash),left:r,right:n}}function findScriptPath(t,e){if(isHashBranch(t)){const r=findScriptPath(t.left,e);if(void 0!==r)return[...r,t.right.hash];const n=findScriptPath(t.right,e);if(void 0!==n)return[...n,t.left.hash]}else if(0===g.UD(t.hash,e))return[]}function tapleafHash(t){const e=t.version||Y;return taggedHash("TapLeaf",g.xW([Uint8Array.from([e]),serializeScript(t.output)]))}function bip341_tweakKey(t,e){if(!(t instanceof Uint8Array))return null;if(32!==t.length)return null;if(e&&32!==e.length)return null;const r=function tapTweakHash(t,e){return taggedHash("TapTweak",g.xW(e?[t,e]:[t]))}(t,e),n=getEccLib().xOnlyPointAddTweak(t,r);return n&&null!==n.xOnlyPubkey?{parity:n.parity,x:Uint8Array.from(n.xOnlyPubkey)}:null}function tapBranchHash(t,e){return taggedHash("TapBranch",g.xW([t,e]))}function serializeScript(t){const e=X.encodingLength(t.length),r=new Uint8Array(e);return X.encode(t.length,r),g.xW([r,t])}const $=h,J=1,Q=80;function p2tr(t,e){if(!(t.address||t.output||t.pubkey||t.internalPubkey||t.witness&&t.witness.length>1))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),d.qgA(d.OH3(d.Ikc({address:d.YjP(),input:NBufferSchemaFactory(0),network:d.Ikc({}),output:NBufferSchemaFactory(34),internalPubkey:NBufferSchemaFactory(32),hash:NBufferSchemaFactory(32),pubkey:NBufferSchemaFactory(32),signature:d.KCZ([NBufferSchemaFactory(64),NBufferSchemaFactory(65)]),witness:d.YOg(b),scriptTree:d.IeY(types_isTaptree,"Taptree is not of type isTaptree"),redeem:d.OH3(d.Ikc({output:b,redeemVersion:d.aig(),witness:d.YOg(b)})),redeemVersion:d.aig()})),t);const r=value((()=>fromBech32(t.address))),n=value((()=>{if(t.witness&&t.witness.length)return t.witness.length>=2&&t.witness[t.witness.length-1][0]===Q?t.witness.slice(0,-1):t.witness.slice()})),i=value((()=>t.scriptTree?toHashTree(t.scriptTree):t.hash?{hash:t.hash}:void 0)),o=t.network||p,s={name:"p2tr",network:o};if(prop(s,"address",(()=>{if(!s.pubkey)return;const t=q.bech32m.toWords(s.pubkey);return t.unshift(J),q.bech32m.encode(o.bech32,t)})),prop(s,"hash",(()=>{const t=i();if(t)return t.hash;const e=n();if(e&&e.length>1){const t=e[e.length-1],r=t[0]&w;return rootHashFromPath(t,tapleafHash({output:e[e.length-2],version:r}))}return null})),prop(s,"output",(()=>{if(s.pubkey)return compile([$.OP_1,s.pubkey])})),prop(s,"redeemVersion",(()=>t.redeemVersion?t.redeemVersion:t.redeem&&void 0!==t.redeem.redeemVersion&&null!==t.redeem.redeemVersion?t.redeem.redeemVersion:Y)),prop(s,"redeem",(()=>{const t=n();if(t&&!(t.length<2))return{output:t[t.length-2],witness:t.slice(0,-2),redeemVersion:t[t.length-1][0]&w}})),prop(s,"pubkey",(()=>{if(t.pubkey)return t.pubkey;if(t.output)return t.output.slice(2);if(t.address)return r().data;if(s.internalPubkey){const t=bip341_tweakKey(s.internalPubkey,s.hash);if(t)return t.x}})),prop(s,"internalPubkey",(()=>{if(t.internalPubkey)return t.internalPubkey;const e=n();return e&&e.length>1?e[e.length-1].slice(1,33):void 0})),prop(s,"signature",(()=>{if(t.signature)return t.signature;const e=n();return e&&1===e.length?e[0]:void 0})),prop(s,"witness",(()=>{if(t.witness)return t.witness;const e=i();if(e&&t.redeem&&t.redeem.output&&t.internalPubkey){const r=findScriptPath(e,tapleafHash({output:t.redeem.output,version:s.redeemVersion}));if(!r)return;const n=bip341_tweakKey(t.internalPubkey,e.hash);if(!n)return;const i=g.xW([Uint8Array.from([s.redeemVersion|n.parity]),t.internalPubkey].concat(r));return[t.redeem.output,i]}return t.signature?[t.signature]:void 0})),e.validate){let e=Uint8Array.from([]);if(t.address){if(o&&o.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==J)throw new TypeError("Invalid address version");if(32!==r().data.length)throw new TypeError("Invalid address data");e=r().data}if(t.pubkey){if(e.length>0&&0!==g.UD(e,t.pubkey))throw new TypeError("Pubkey mismatch");e=t.pubkey}if(t.output){if(34!==t.output.length||t.output[0]!==$.OP_1||32!==t.output[1])throw new TypeError("Output is invalid");if(e.length>0&&0!==g.UD(e,t.output.slice(2)))throw new TypeError("Pubkey mismatch");e=t.output.slice(2)}if(t.internalPubkey){const r=bip341_tweakKey(t.internalPubkey,s.hash);if(e.length>0&&0!==g.UD(e,r.x))throw new TypeError("Pubkey mismatch");e=r.x}if(e&&e.length&&!getEccLib().isXOnlyPoint(e))throw new TypeError("Invalid pubkey for p2tr");const a=i();if(t.hash&&a&&0!==g.UD(t.hash,a.hash))throw new TypeError("Hash mismatch");if(t.redeem&&t.redeem.output&&a){if(!findScriptPath(a,tapleafHash({output:t.redeem.output,version:s.redeemVersion})))throw new TypeError("Redeem script not in tree")}const u=n();if(t.redeem&&s.redeem){if(t.redeem.redeemVersion&&t.redeem.redeemVersion!==s.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(t.redeem.output){if(0===script_decompile(t.redeem.output).length)throw new TypeError("Redeem.output is invalid");if(s.redeem.output&&0!==g.UD(t.redeem.output,s.redeem.output))throw new TypeError("Redeem.output and witness mismatch")}if(t.redeem.witness&&s.redeem.witness&&!types_stacksEqual(t.redeem.witness,s.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(u&&u.length)if(1===u.length){if(t.signature&&0!==g.UD(t.signature,u[0]))throw new TypeError("Signature mismatch")}else{const r=u[u.length-1];if(r.length<33)throw new TypeError(`The control-block length is too small. Got ${r.length}, expected min 33.`);if((r.length-33)%32!=0)throw new TypeError(`The control-block length of ${r.length} is incorrect!`);const n=(r.length-33)/32;if(n>128)throw new TypeError(`The script path is too long. Got ${n}, expected max 128.`);const i=r.slice(1,33);if(t.internalPubkey&&0!==g.UD(t.internalPubkey,i))throw new TypeError("Internal pubkey mismatch");if(!getEccLib().isXOnlyPoint(i))throw new TypeError("Invalid internalPubkey for p2tr witness");const o=r[0]&w,s=bip341_tweakKey(i,rootHashFromPath(r,tapleafHash({output:u[u.length-2],version:o})));if(!s)throw new TypeError("Invalid outputKey for p2tr witness");if(e.length&&0!==g.UD(e,s.x))throw new TypeError("Pubkey mismatch for p2tr witness");if(s.parity!==(1&r[0]))throw new Error("Incorrect parity")}}return Object.assign(s,t)}var tt=r(901048).Buffer;const et=40,rt=2,nt=16,it=2,ot=80,st="WARNING: Sending to a future segwit version address can lead to loss of funds. End users MUST be warned carefully in the GUI and asked if they wish to proceed with caution. Wallets should verify the segwit version from the output of fromBech32, then decide when it is safe to use which version of segwit.";function _toFutureSegwitAddress(t,e){const r=t.slice(2);if(r.length<rt||r.length>et)throw new TypeError("Invalid program length for segwit address");const n=t[0]-ot;if(n<it||n>nt)throw new TypeError("Invalid version for segwit address");if(t[1]!==r.length)throw new TypeError("Invalid script for segwit address");return console.warn(st),function toBech32(t,e,r){const n=q.bech32.toWords(t);return n.unshift(e),0===e?q.bech32.encode(r,n):q.bech32m.encode(r,n)}(r,n,e.bech32)}function fromBech32(t){let e,r;try{e=q.bech32.decode(t)}catch(t){}if(e){if(r=e.words[0],0!==r)throw new TypeError(t+" uses wrong encoding")}else if(e=q.bech32m.decode(t),r=e.words[0],0===r)throw new TypeError(t+" uses wrong encoding");const n=q.bech32.fromWords(e.words.slice(1));return{version:r,prefix:e.prefix,data:Uint8Array.from(n)}}function fromOutputScript(t,e){e=e||p;try{return p2pkh({output:t,network:e}).address}catch(t){}try{return p2sh_p2sh({output:t,network:e}).address}catch(t){}try{return p2wpkh({output:t,network:e}).address}catch(t){}try{return p2wsh_p2wsh({output:t,network:e}).address}catch(t){}try{return p2tr({output:t,network:e}).address}catch(t){}try{return _toFutureSegwitAddress(t,e)}catch(t){}throw new Error(function toASM(t){if(chunksIsBuffer(t)&&(t=script_decompile(t)),!t)throw new Error("Could not convert invalid chunks to ASM");return t.map((t=>{if(singleChunkIsBuffer(t)){const e=asMinimalOP(t);if(void 0===e)return g.nj(t);t=e}return f[t]})).join(" ")}(t)+" has no matching Address")}function toOutputScript(t,e){let r,n;e=e||p;try{r=function fromBase58Check(t){if(u.indexOf(t.split(":")[0])>-1){const e=cashaddr_decode(t);let r,n;switch(e.prefix){case"bitcoincash":r=p;break;case"bchtest":r=c;break;case"bchreg":r=l}switch(e.type){case"P2PKH":n=r.pubKeyHash;break;case"P2SH":n=r.scriptHash}if(e.hash.length<20)throw new TypeError(t+" is too short");if(e.hash.length>20)throw new TypeError(t+" is too long");return{version:n,hash:tt.from(e.hash)}}{const e=tt.from(D.decode(t));if(e.length<21)throw new TypeError(t+" is too short");if(e.length>21)throw new TypeError(t+" is too long");return{version:g.pJ(e,0),hash:e.slice(1)}}}(t)}catch(t){}if(r){if(r.version===e.pubKeyHash)return p2pkh({hash:r.hash}).output;if(r.version===e.scriptHash)return p2sh_p2sh({hash:r.hash}).output}else{try{n=fromBech32(t)}catch(t){}if(n){if(n.prefix!==e.bech32)throw new Error(t+" has an invalid prefix");if(0===n.version){if(20===n.data.length)return p2wpkh({hash:n.data}).output;if(32===n.data.length)return p2wsh_p2wsh({hash:n.data}).output}else if(1===n.version){if(32===n.data.length)return p2tr({pubkey:n.data}).output}else if(n.version>=it&&n.version<=nt&&n.data.length>=rt&&n.data.length<=et)return console.warn(st),compile([n.version+ot,n.data])}}throw new Error(t+" has no matching Script")}function varSliceSize(t){const e=t.length;return X.encodingLength(e)+e}const at=new Uint8Array(0),ut=[],pt=g.aD("0000000000000000000000000000000000000000000000000000000000000000"),lt=g.aD("0000000000000000000000000000000000000000000000000000000000000001"),ct=g.aD("ffffffffffffffff"),ht={script:at,valueBuffer:ct};class transaction_Transaction{static DEFAULT_SEQUENCE=4294967295;static SIGHASH_DEFAULT=0;static SIGHASH_ALL=1;static SIGHASH_NONE=2;static SIGHASH_SINGLE=3;static SIGHASH_ANYONECANPAY=128;static SIGHASH_BITCOINCASHBIP143=64;static SIGHASH_OUTPUT_MASK=3;static SIGHASH_INPUT_MASK=128;static ADVANCED_TRANSACTION_MARKER=0;static ADVANCED_TRANSACTION_FLAG=1;static FORKID_BTG=79;static FORKID_BCH=0;static fromBuffer(t,e){const r=new bufferutils_BufferReader(t),n=new transaction_Transaction;n.version=r.readInt32();const i=r.readUInt8(),o=r.readUInt8();let s=!1;i===transaction_Transaction.ADVANCED_TRANSACTION_MARKER&&o===transaction_Transaction.ADVANCED_TRANSACTION_FLAG?s=!0:r.offset-=2;const a=r.readVarInt();for(let t=0;t<a;++t)n.ins.push({hash:r.readSlice(32),index:r.readUInt32(),script:r.readVarSlice(),sequence:r.readUInt32(),witness:ut});const u=r.readVarInt();for(let t=0;t<u;++t)n.outs.push({value:r.readInt64(),script:r.readVarSlice()});if(s){for(let t=0;t<a;++t)n.ins[t].witness=r.readVector();if(!n.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(n.locktime=r.readUInt32(),e)return n;if(r.offset!==t.length)throw new Error("Transaction has unexpected data");return n}static fromHex(t){return transaction_Transaction.fromBuffer(g.aD(t),!1)}static isCoinbaseHash(t){d.qgA(S,t);for(let e=0;e<32;++e)if(0!==t[e])return!1;return!0}version=1;locktime=0;ins=[];outs=[];isCoinbase(){return 1===this.ins.length&&transaction_Transaction.isCoinbaseHash(this.ins[0].hash)}addInput(t,e,r,n){return d.qgA(d.PVZ([S,E,d.mee(d.lqM(E)),d.mee(d.lqM(b))]),[t,e,r,n]),null==r&&(r=transaction_Transaction.DEFAULT_SEQUENCE),this.ins.push({hash:t,index:e,script:n||at,sequence:r,witness:ut})-1}addOutput(t,e){return d.qgA(d.PVZ([b,T]),[t,e]),this.outs.push({script:t,value:e})-1}hasWitnesses(){return this.ins.some((t=>0!==t.witness.length))}weight(){return 3*this.byteLength(!1)+this.byteLength(!0)}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(t=!0){const e=t&&this.hasWitnesses();return(e?10:8)+X.encodingLength(this.ins.length)+X.encodingLength(this.outs.length)+this.ins.reduce(((t,e)=>t+40+varSliceSize(e.script)),0)+this.outs.reduce(((t,e)=>t+8+varSliceSize(e.script)),0)+(e?this.ins.reduce(((t,e)=>t+function vectorSize(t){const e=t.length;return X.encodingLength(e)+t.reduce(((t,e)=>t+varSliceSize(e)),0)}(e.witness)),0):0)}clone(){const t=new transaction_Transaction;return t.version=this.version,t.locktime=this.locktime,t.ins=this.ins.map((t=>({hash:t.hash,index:t.index,script:t.script,sequence:t.sequence,witness:t.witness}))),t.outs=this.outs.map((t=>({script:t.script,value:t.value}))),t}hashForSignature(t,e,r){if(d.qgA(d.PVZ([E,b,d.aig()]),[t,e,r]),t>=this.ins.length)return lt;const n=compile(script_decompile(e).filter((t=>t!==h.OP_CODESEPARATOR))),i=this.clone();if((31&r)===transaction_Transaction.SIGHASH_NONE)i.outs=[],i.ins.forEach(((e,r)=>{r!==t&&(e.sequence=0)}));else if((31&r)===transaction_Transaction.SIGHASH_SINGLE){if(t>=this.outs.length)return lt;i.outs.length=t+1;for(let e=0;e<t;e++)i.outs[e]=ht;i.ins.forEach(((e,r)=>{r!==t&&(e.sequence=0)}))}r&transaction_Transaction.SIGHASH_ANYONECANPAY?(i.ins=[i.ins[t]],i.ins[0].script=n):(i.ins.forEach((t=>{t.script=at})),i.ins[t].script=n);const o=new Uint8Array(i.byteLength(!1)+4);return g.g3(o,o.length-4,r,"LE"),i.__toBuffer(o,0,!1),hash256(o)}hashForWitnessV1(t,e,r,n,i,o){if(d.qgA(d.PVZ([E,d.YOg(b),d.YOg(T),E]),[t,e,r,n]),r.length!==this.ins.length||e.length!==this.ins.length)throw new Error("Must supply prevout script and value for all inputs");const s=n===transaction_Transaction.SIGHASH_DEFAULT?transaction_Transaction.SIGHASH_ALL:n&transaction_Transaction.SIGHASH_OUTPUT_MASK,a=(n&transaction_Transaction.SIGHASH_INPUT_MASK)===transaction_Transaction.SIGHASH_ANYONECANPAY,u=s===transaction_Transaction.SIGHASH_NONE,p=s===transaction_Transaction.SIGHASH_SINGLE;let l=at,c=at,h=at,f=at,y=at;if(!a){let t=bufferutils_BufferWriter.withCapacity(36*this.ins.length);this.ins.forEach((e=>{t.writeSlice(e.hash),t.writeUInt32(e.index)})),l=(0,x.s)(t.end()),t=bufferutils_BufferWriter.withCapacity(8*this.ins.length),r.forEach((e=>t.writeInt64(e))),c=(0,x.s)(t.end()),t=bufferutils_BufferWriter.withCapacity(e.map(varSliceSize).reduce(((t,e)=>t+e))),e.forEach((e=>t.writeVarSlice(e))),h=(0,x.s)(t.end()),t=bufferutils_BufferWriter.withCapacity(4*this.ins.length),this.ins.forEach((e=>t.writeUInt32(e.sequence))),f=(0,x.s)(t.end())}if(u||p){if(p&&t<this.outs.length){const e=this.outs[t],r=bufferutils_BufferWriter.withCapacity(8+varSliceSize(e.script));r.writeInt64(e.value),r.writeVarSlice(e.script),y=(0,x.s)(r.end())}}else{if(!this.outs.length)throw new Error("Add outputs to the transaction before signing.");const t=this.outs.map((t=>8+varSliceSize(t.script))).reduce(((t,e)=>t+e)),e=bufferutils_BufferWriter.withCapacity(t);this.outs.forEach((t=>{e.writeInt64(t.value),e.writeVarSlice(t.script)})),y=(0,x.s)(e.end())}const m=(i?2:0)+(o?1:0),w=174-(a?49:0)-(u?32:0)+(o?32:0)+(i?37:0),v=bufferutils_BufferWriter.withCapacity(w);if(v.writeUInt8(n),v.writeInt32(this.version),v.writeUInt32(this.locktime),v.writeSlice(l),v.writeSlice(c),v.writeSlice(h),v.writeSlice(f),u||p||v.writeSlice(y),v.writeUInt8(m),a){const n=this.ins[t];v.writeSlice(n.hash),v.writeUInt32(n.index),v.writeInt64(r[t]),v.writeVarSlice(e[t]),v.writeUInt32(n.sequence)}else v.writeUInt32(t);if(o){const t=bufferutils_BufferWriter.withCapacity(varSliceSize(o));t.writeVarSlice(o),v.writeSlice((0,x.s)(t.end()))}return p&&v.writeSlice(y),i&&(v.writeSlice(i),v.writeUInt8(0),v.writeUInt32(4294967295)),taggedHash("TapSighash",g.xW([Uint8Array.from([0]),v.end()]))}hashForWitnessV0(t,e,r,n){d.qgA(d.PVZ([E,b,T,E]),[t,e,r,n]);let i,o=Uint8Array.from([]),s=pt,a=pt,u=pt;if(n&transaction_Transaction.SIGHASH_ANYONECANPAY||(o=new Uint8Array(36*this.ins.length),i=new bufferutils_BufferWriter(o,0),this.ins.forEach((t=>{i.writeSlice(t.hash),i.writeUInt32(t.index)})),a=hash256(o)),n&transaction_Transaction.SIGHASH_ANYONECANPAY||(31&n)===transaction_Transaction.SIGHASH_SINGLE||(31&n)===transaction_Transaction.SIGHASH_NONE||(o=new Uint8Array(4*this.ins.length),i=new bufferutils_BufferWriter(o,0),this.ins.forEach((t=>{i.writeUInt32(t.sequence)})),u=hash256(o)),(31&n)!==transaction_Transaction.SIGHASH_SINGLE&&(31&n)!==transaction_Transaction.SIGHASH_NONE){const t=this.outs.reduce(((t,e)=>t+8+varSliceSize(e.script)),0);o=new Uint8Array(t),i=new bufferutils_BufferWriter(o,0),this.outs.forEach((t=>{i.writeInt64(t.value),i.writeVarSlice(t.script)})),s=hash256(o)}else if((31&n)===transaction_Transaction.SIGHASH_SINGLE&&t<this.outs.length){const e=this.outs[t];o=new Uint8Array(8+varSliceSize(e.script)),i=new bufferutils_BufferWriter(o,0),i.writeInt64(e.value),i.writeVarSlice(e.script),s=hash256(o)}o=new Uint8Array(156+varSliceSize(e)),i=new bufferutils_BufferWriter(o,0);const p=this.ins[t];return i.writeInt32(this.version),i.writeSlice(a),i.writeSlice(u),i.writeSlice(p.hash),i.writeUInt32(p.index),i.writeVarSlice(e),i.writeInt64(r),i.writeUInt32(p.sequence),i.writeSlice(s),i.writeUInt32(this.locktime),i.writeUInt32(n),hash256(o)}hashForCashSignature(t,e,r,n){return d.qgA(d.PVZ([E,b,T,A]),[t,e,r,n]),n&transaction_Transaction.SIGHASH_BITCOINCASHBIP143?this.hashForWitnessV0(t,e,r,n):this.hashForSignature(t,e,n)}hashForGoldSignature(t,e,r,n,i){d.qgA(d.PVZ([E,b,T,A]),[t,e,r,n]);let o=n;const s=(n&transaction_Transaction.SIGHASH_BITCOINCASHBIP143)>0;return s&&(o|=transaction_Transaction.FORKID_BTG<<8),i||s?this.hashForWitnessV0(t,e,r,o):this.hashForSignature(t,e,o)}getHash(t){return t&&this.isCoinbase()?new Uint8Array(32):hash256(this.__toBuffer(void 0,void 0,t))}getId(){return g.nj(bufferutils_reverseBuffer(this.getHash(!1)))}toBuffer(t,e){return this.__toBuffer(t,e,!0)}toHex(){return g.nj(this.toBuffer(void 0,void 0))}setInputScript(t,e){d.qgA(d.PVZ([d.aig(),b]),[t,e]),this.ins[t].script=e}setWitness(t,e){d.qgA(d.PVZ([d.aig(),d.YOg(b)]),[t,e]),this.ins[t].witness=e}__toBuffer(t,e,r=!1){t||(t=new Uint8Array(this.byteLength(r)));const n=new bufferutils_BufferWriter(t,e||0);n.writeInt32(this.version);const i=r&&this.hasWitnesses();return i&&(n.writeUInt8(transaction_Transaction.ADVANCED_TRANSACTION_MARKER),n.writeUInt8(transaction_Transaction.ADVANCED_TRANSACTION_FLAG)),n.writeVarInt(this.ins.length),this.ins.forEach((t=>{n.writeSlice(t.hash),n.writeUInt32(t.index),n.writeVarSlice(t.script),n.writeUInt32(t.sequence)})),n.writeVarInt(this.outs.length),this.outs.forEach((t=>{!function isOutput(t){return void 0!==t.value}(t)?n.writeSlice(t.valueBuffer):n.writeInt64(t.value),n.writeVarSlice(t.script)})),i&&this.ins.forEach((t=>{n.writeVector(t.witness)})),n.writeUInt32(this.locktime),void 0!==e?t.slice(e,n.offset):t}}new TypeError("Cannot compute merkle root for zero transactions"),new TypeError("Cannot compute witness commit for non-segwit block");var ft=r(837819);function isPaymentFactory(t){return e=>{try{return t({output:e}),!0}catch(t){return!1}}}const gt=isPaymentFactory(p2ms_p2ms),dt=isPaymentFactory(p2pk),yt=isPaymentFactory(p2pkh),mt=isPaymentFactory(p2wpkh),wt=isPaymentFactory(p2wsh_p2wsh),vt=isPaymentFactory(p2sh_p2sh),It=isPaymentFactory(p2tr);function witnessStackToScriptWitness(t){let e=new Uint8Array(0);function writeVarInt(t){const r=e.length,n=X.encodingLength(t);e=g.xW([e,new Uint8Array(n)]),X.encode(t,e,r)}function writeVarSlice(t){writeVarInt(t.length),function writeSlice(t){e=g.xW([e,t])}(t)}return function writeVector(t){writeVarInt(t.length),t.forEach(writeVarSlice)}(t),e}function pubkeyPositionInScript(t,e){const r=hash160(t),n=t.slice(1,33),i=script_decompile(e);if(null===i)throw new Error("Unknown script error");return i.findIndex((e=>"number"!=typeof e&&(0===g.UD(t,e)||0===g.UD(r,e)||0===g.UD(n,e))))}function pubkeyInScript(t,e){return-1!==pubkeyPositionInScript(t,e)}function checkInputForSig(t,e){const r=function extractPartialSigs(t){let e=[];if(0===(t.partialSig||[]).length){if(!t.finalScriptSig&&!t.finalScriptWitness)return[];e=function getPsigsFromInputFinalScripts(t){const e=t.finalScriptSig&&script_decompile(t.finalScriptSig)||[],r=t.finalScriptWitness&&script_decompile(t.finalScriptWitness)||[];return e.concat(r).filter((t=>t instanceof Uint8Array&&isCanonicalScriptSignature(t))).map((t=>({signature:t})))}(t)}else e=t.partialSig;return e.map((t=>t.signature))}(t);return r.some((t=>signatureBlocksAction(t,k.decode,e)))}function signatureBlocksAction(t,e,r){const{hashType:n}=e(t),i=[];n&transaction_Transaction.SIGHASH_ANYONECANPAY&&i.push("addInput");switch(31&n){case transaction_Transaction.SIGHASH_ALL:break;case transaction_Transaction.SIGHASH_SINGLE:case transaction_Transaction.SIGHASH_NONE:i.push("addOutput"),i.push("setInputSequence")}return-1===i.indexOf(r)}const toXOnly=t=>32===t.length?t:t.slice(1,33);function tapScriptFinalizer(t,e,r){const n=function findTapLeafToFinalize(t,e,r){if(!t.tapScriptSig||!t.tapScriptSig.length)throw new Error(`Can not finalize taproot input #${e}. No tapleaf script signature provided.`);const n=(t.tapLeafScript||[]).sort(((t,e)=>t.controlBlock.length-e.controlBlock.length)).find((e=>function canFinalizeLeaf(t,e,r){const n=tapleafHash({output:t.script,version:t.leafVersion});return(!r||0===g.UD(n,r))&&void 0!==e.find((t=>0===g.UD(t.leafHash,n)))}(e,t.tapScriptSig,r)));if(!n)throw new Error(`Can not finalize taproot input #${e}. Signature for tapleaf script not found.`);return n}(e,t,r);try{const t=function sortSignatures(t,e){const r=tapleafHash({output:e.script,version:e.leafVersion});return(t.tapScriptSig||[]).filter((t=>0===g.UD(t.leafHash,r))).map((t=>function addPubkeyPositionInScript(t,e){return Object.assign({positionInScript:pubkeyPositionInScript(e.pubkey,t)},e)}(e.script,t))).sort(((t,e)=>e.positionInScript-t.positionInScript)).map((t=>t.signature))}(e,n);return{finalScriptWitness:witnessStackToScriptWitness(t.concat(n.script).concat(n.controlBlock))}}catch(e){throw new Error(`Can not finalize taproot input #${t}: ${e}`)}}function serializeTaprootSignature(t,e){const r=e?Uint8Array.from([e]):Uint8Array.from([]);return g.xW([t,r])}function isTaprootInput(t){return t&&!!(t.tapInternalKey||t.tapMerkleRoot||t.tapLeafScript&&t.tapLeafScript.length||t.tapBip32Derivation&&t.tapBip32Derivation.length||t.witnessUtxo&&It(t.witnessUtxo.script))}function isTaprootOutput(t,e){return t&&!!(t.tapInternalKey||t.tapTree||t.tapBip32Derivation&&t.tapBip32Derivation.length||e&&It(e))}function checkTaprootInputFields(t,e,r){!function checkMixedTaprootAndNonTaprootInputFields(t,e,r){const n=isTaprootInput(t)&&hasNonTaprootFields(e),i=hasNonTaprootFields(t)&&isTaprootInput(e),o=t===e&&isTaprootInput(e)&&hasNonTaprootFields(e);if(n||i||o)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}(t,e,r),function checkIfTapLeafInTree(t,e,r){if(e.tapMerkleRoot){const n=(e.tapLeafScript||[]).every((t=>isTapLeafInTree(t,e.tapMerkleRoot))),i=(t.tapLeafScript||[]).every((t=>isTapLeafInTree(t,e.tapMerkleRoot)));if(!n||!i)throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}else if(t.tapMerkleRoot){if(!(e.tapLeafScript||[]).every((e=>isTapLeafInTree(e,t.tapMerkleRoot))))throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}}(t,e,r)}function checkTaprootOutputFields(t,e,r){!function checkMixedTaprootAndNonTaprootOutputFields(t,e,r){const n=isTaprootOutput(t)&&hasNonTaprootFields(e),i=hasNonTaprootFields(t)&&isTaprootOutput(e),o=t===e&&isTaprootOutput(e)&&hasNonTaprootFields(e);if(n||i||o)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}(t,e,r),function checkTaprootScriptPubkey(t,e){if(!e.tapTree&&!e.tapInternalKey)return;const r=e.tapInternalKey||t.tapInternalKey,n=e.tapTree||t.tapTree;if(r){const{script:e}=t,i=function getTaprootScripPubkey(t,e){const r=e&&function tapTreeFromList(t=[]){return 1===t.length&&0===t[0].depth?{output:t[0].script,version:t[0].leafVersion}:function instertLeavesInTree(t){let e;for(const r of t)if(e=instertLeafInTree(r,e),!e)throw new Error("No room left to insert tapleaf in tree");return e}(t)}(e.leaves),{output:n}=p2tr({internalPubkey:t,scriptTree:r});return n}(r,n);if(e&&0!==g.UD(i,e))throw new Error("Error adding output. Script or address mismatch.")}}(t,e)}function checkTaprootInputForSigs(t,e){const r=function extractTaprootSigs(t){const e=[];t.tapKeySig&&e.push(t.tapKeySig);t.tapScriptSig&&e.push(...t.tapScriptSig.map((t=>t.signature)));if(!e.length){const r=function getTapKeySigFromWithness(t){if(!t)return;const e=t.slice(2);if(64===e.length||65===e.length)return e}(t.finalScriptWitness);r&&e.push(r)}return e}(t);return r.some((t=>signatureBlocksAction(t,decodeSchnorrSignature,e)))}function decodeSchnorrSignature(t){return{signature:t.slice(0,64),hashType:t.slice(64)[0]||transaction_Transaction.SIGHASH_DEFAULT}}function instertLeafInTree(t,e,r=0){if(r>Z)throw new Error("Max taptree depth exceeded.");if(t.depth===r)return e?void 0:{output:t.script,version:t.leafVersion};if(types_isTapleaf(e))return;const n=instertLeafInTree(t,e&&e[0],r+1);if(n)return[n,e&&e[1]];const i=instertLeafInTree(t,e&&e[1],r+1);return i?[e&&e[0],i]:void 0}function isTapLeafInTree(t,e){if(!e)return!0;const r=tapleafHash({output:t.script,version:t.leafVersion}),n=rootHashFromPath(t.controlBlock,r);return 0===g.UD(n,e)}function hasNonTaprootFields(t){return t&&!!(t.redeemScript||t.witnessScript||t.bip32Derivation&&t.bip32Derivation.length)}const St=transaction_Transaction.SIGHASH_ALL|transaction_Transaction.SIGHASH_BITCOINCASHBIP143,bt=transaction_Transaction.SIGHASH_ALL|transaction_Transaction.SIGHASH_BITCOINCASHBIP143|transaction_Transaction.FORKID_BTG<<8,_t=[transaction_Transaction.SIGHASH_ALL,St,bt],Et={network:p,maximumFeeRate:5e3,forkCoin:"none"};class Psbt{data;static fromBase64(t,e={}){const r=g.Ey(t);return this.fromBuffer(r,e)}static fromHex(t,e={}){const r=g.aD(t);return this.fromBuffer(r,e)}static fromBuffer(t,e={}){const r=ft.iL.fromBuffer(t,transactionFromBuffer),n=new Psbt(e,r);return function checkTxForDupeIns(t,e){t.ins.forEach((t=>{checkTxInputCache(e,t)}))}(n.__CACHE.__TX,n.__CACHE),n}__CACHE;opts;constructor(t={},e=new ft.iL(new PsbtTransaction)){this.data=e,this.opts=Object.assign({},Et,t),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},0===this.data.inputs.length&&this.setVersion(2);const dpew=(t,e,r,n)=>Object.defineProperty(t,e,{enumerable:r,writable:n});dpew(this,"__CACHE",!1,!0),dpew(this,"opts",!1,!0)}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(t){this.setVersion(t)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(t){this.setLocktime(t)}get txInputs(){return this.__CACHE.__TX.ins.map((t=>({hash:cloneBuffer(t.hash),index:t.index,sequence:t.sequence})))}get txOutputs(){return this.__CACHE.__TX.outs.map((t=>{let e;try{e=fromOutputScript(t.script,this.opts.network)}catch(t){}return{script:cloneBuffer(t.script),value:t.value,address:e}}))}combine(...t){return this.data.combine(...t.map((t=>t.data))),this}clone(){const t=Psbt.fromBuffer(this.data.toBuffer());return t.opts=JSON.parse(JSON.stringify(this.opts)),t}setMaximumFeeRate(t){check32Bit(t),this.opts.maximumFeeRate=t}setVersion(t){check32Bit(t),checkInputsForPartialSig(this.data.inputs,"setVersion");const e=this.__CACHE;return e.__TX.version=t,e.__EXTRACTED_TX=void 0,this}setLocktime(t){check32Bit(t),checkInputsForPartialSig(this.data.inputs,"setLocktime");const e=this.__CACHE;return e.__TX.locktime=t,e.__EXTRACTED_TX=void 0,this}setInputSequence(t,e){check32Bit(e),checkInputsForPartialSig(this.data.inputs,"setInputSequence");const r=this.__CACHE;if(r.__TX.ins.length<=t)throw new Error("Input index too high");return r.__TX.ins[t].sequence=e,r.__EXTRACTED_TX=void 0,this}addInputs(t){return t.forEach((t=>this.addInput(t))),this}addInput(t){if(arguments.length>1||!t||void 0===t.hash||void 0===t.index)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");checkTaprootInputFields(t,t,"addInput"),checkInputsForPartialSig(this.data.inputs,"addInput"),t.witnessScript&&checkInvalidP2WSH(t.witnessScript);const e=this.__CACHE;this.data.addInput(t);checkTxInputCache(e,e.__TX.ins[e.__TX.ins.length-1]);const r=this.data.inputs.length-1,n=this.data.inputs[r];return n.nonWitnessUtxo&&addNonWitnessTxCache(this.__CACHE,n,r),e.__FEE=void 0,e.__FEE_RATE=void 0,e.__EXTRACTED_TX=void 0,this}addOutputs(t){return t.forEach((t=>this.addOutput(t))),this}addOutput(t){if(arguments.length>1||!t||void 0===t.value||void 0===t.address&&void 0===t.script)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");checkInputsForPartialSig(this.data.inputs,"addOutput");const{address:e}=t;if("string"==typeof e){const{network:r}=this.opts,n=toOutputScript(e,r);t=Object.assign({},t,{script:n})}checkTaprootOutputFields(t,t,"addOutput");const r=this.__CACHE;return this.data.addOutput(t),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}extractTransaction(t){if(!this.data.inputs.every(isFinalized))throw new Error("Not finalized");const e=this.__CACHE;if(t||function checkFees(t,e,r){const n=e.__FEE_RATE||t.getFeeRate(),i=e.__EXTRACTED_TX.virtualSize(),o=n*i;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(o/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${i} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}(this,e,this.opts),e.__EXTRACTED_TX)return e.__EXTRACTED_TX;const r=e.__TX.clone();return inputFinalizeGetAmts(this.data.inputs,r,e,!0),r}getFeeRate(){return getTxCacheValue("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return getTxCacheValue("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return(0,ft.gI)(this.data.inputs,0),range(this.data.inputs.length).forEach((t=>this.finalizeInput(t))),this}finalizeInput(t,e){const r=(0,ft.gI)(this.data.inputs,t);return isTaprootInput(r)?this._finalizeTaprootInput(t,r,void 0,e):this._finalizeInput(t,r,e)}finalizeTaprootInput(t,e,r=tapScriptFinalizer){const n=(0,ft.gI)(this.data.inputs,t);if(isTaprootInput(n))return this._finalizeTaprootInput(t,n,e,r);throw new Error(`Cannot finalize input #${t}. Not Taproot.`)}_finalizeInput(t,e,r=getFinalScripts){const{script:n,isP2SH:i,isP2WSH:o,isSegwit:s}=function getScriptFromInput(t,e,r){const n=r.__TX,i={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(i.isP2SH=!!e.redeemScript,i.isP2WSH=!!e.witnessScript,e.witnessScript)i.script=e.witnessScript;else if(e.redeemScript)i.script=e.redeemScript;else if(e.nonWitnessUtxo){const o=nonWitnessUtxoTxFromCache(r,e,t),s=n.ins[t].index;i.script=o.outs[s].script}else e.witnessUtxo&&(i.script=e.witnessUtxo.script);(e.witnessScript||mt(i.script))&&(i.isSegwit=!0);return i}(t,e,this.__CACHE);if(!n)throw new Error(`No script found for input #${t}`);!function checkPartialSigSighashes(t){if(!t.sighashType||!t.partialSig)return;const{partialSig:e,sighashType:r}=t;e.forEach((t=>{const{hashType:e}=k.decode(t.signature);if((255&r)!==e)throw new Error("Signature sighash does not match input sighash type")}))}(e);const{finalScriptSig:a,finalScriptWitness:u}=r(t,e,n,s,i,o);if(a&&this.data.updateInput(t,{finalScriptSig:a}),u&&this.data.updateInput(t,{finalScriptWitness:u}),!a&&!u)throw new Error(`Unknown error finalizing input #${t}`);return this.data.clearFinalizedInput(t),this}_finalizeTaprootInput(t,e,r,n=tapScriptFinalizer){if(!e.witnessUtxo)throw new Error(`Cannot finalize input #${t}. Missing withness utxo.`);if(e.tapKeySig){const r=witnessStackToScriptWitness(p2tr({output:e.witnessUtxo.script,signature:e.tapKeySig}).witness);this.data.updateInput(t,{finalScriptWitness:r})}else{const{finalScriptWitness:i}=n(t,e,r);this.data.updateInput(t,{finalScriptWitness:i})}return this.data.clearFinalizedInput(t),this}getInputType(t){const e=(0,ft.gI)(this.data.inputs,t),r=getMeaningfulScript(getScriptFromUtxo(t,e,this.__CACHE),t,"input",e.redeemScript||function redeemFromFinalScriptSig(t){if(!t)return;const e=script_decompile(t);if(!e)return;const r=e[e.length-1];if(!(r instanceof Uint8Array)||isPubkeyLike(r)||function isSigLike(t){return isCanonicalScriptSignature(t)}(r))return;if(!script_decompile(r))return;return r}(e.finalScriptSig),e.witnessScript||function redeemFromFinalWitnessScript(t){if(!t)return;const e=scriptWitnessToWitnessStack(t),r=e[e.length-1];if(isPubkeyLike(r))return;if(!script_decompile(r))return;return r}(e.finalScriptWitness));return("raw"===r.type?"":r.type+"-")+classifyScript(r.meaningfulScript)}inputHasPubkey(t,e){return function pubkeyInInput(t,e,r,n){const i=getScriptFromUtxo(r,e,n),{meaningfulScript:o}=getMeaningfulScript(i,r,"input",e.redeemScript,e.witnessScript);return pubkeyInScript(t,o)}(e,(0,ft.gI)(this.data.inputs,t),t,this.__CACHE)}inputHasHDKey(t,e){const r=(0,ft.gI)(this.data.inputs,t),n=bip32DerivationIsMine(e);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}outputHasPubkey(t,e){return function pubkeyInOutput(t,e,r,n){const i=n.__TX.outs[r].script,{meaningfulScript:o}=getMeaningfulScript(i,r,"output",e.redeemScript,e.witnessScript);return pubkeyInScript(t,o)}(e,(0,ft.H0)(this.data.outputs,t),t,this.__CACHE)}outputHasHDKey(t,e){const r=(0,ft.H0)(this.data.outputs,t),n=bip32DerivationIsMine(e);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}validateSignaturesOfAllInputs(t){(0,ft.gI)(this.data.inputs,0);return range(this.data.inputs.length).map((e=>this.validateSignaturesOfInput(e,t))).reduce(((t,e)=>!0===e&&t),!0)}validateSignaturesOfInput(t,e,r){return isTaprootInput(this.data.inputs[t])?this.validateSignaturesOfTaprootInput(t,e,r):this._validateSignaturesOfInput(t,e,r)}_validateSignaturesOfInput(t,e,r){const n=this.data.inputs[t],i=(n||{}).partialSig;if(!n||!i||i.length<1)throw new Error("No signatures to validate");if("function"!=typeof e)throw new Error("Need validator function to validate signatures");const o=r?i.filter((t=>0===g.UD(t.pubkey,r))):i;if(o.length<1)throw new Error("No signatures for this pubkey");const s=[];let a,u,p;for(const r of o){const i=k.decode(r.signature),{hash:o,script:l}=p!==i.hashType?getHashForSig(t,Object.assign({},n,{sighashType:i.hashType}),this.__CACHE,!0,this.opts.forkCoin):{hash:a,script:u};p=i.hashType,a=o,u=l,checkScriptForPubkey(r.pubkey,l,"verify"),s.push(e(r.pubkey,o,i.signature))}return s.every((t=>!0===t))}validateSignaturesOfTaprootInput(t,e,r){const n=this.data.inputs[t],i=(n||{}).tapKeySig,o=(n||{}).tapScriptSig;if(!n&&!i&&(!o||o.length))throw new Error("No signatures to validate");if("function"!=typeof e)throw new Error("Need validator function to validate signatures");const s=(r=r&&toXOnly(r))?getTaprootHashesForSig(t,n,this.data.inputs,r,this.__CACHE):function getAllTaprootHashesForSig(t,e,r,n){const i=[];if(e.tapInternalKey){const r=getPrevoutTaprootKey(t,e,n);r&&i.push(r)}if(e.tapScriptSig){const t=e.tapScriptSig.map((t=>t.pubkey));i.push(...t)}const o=i.map((i=>getTaprootHashesForSig(t,e,r,i,n)));return o.flat()}(t,n,this.data.inputs,this.__CACHE);if(!s.length)throw new Error("No signatures for this pubkey");const a=s.find((t=>!t.leafHash));let u=0;if(i&&a){if(!e(a.pubkey,a.hash,trimTaprootSig(i)))return!1;u++}if(o)for(const t of o){const r=s.find((e=>0===g.UD(e.pubkey,t.pubkey)));if(r){if(!e(t.pubkey,r.hash,trimTaprootSig(t.signature)))return!1;u++}}return u>0}signAllInputsHD(t,e){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");const r=[];for(const n of range(this.data.inputs.length))try{this.signInputHD(n,t,e),r.push(!0)}catch(t){r.push(!1)}if(r.every((t=>!1===t)))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(t,e){return new Promise(((r,n)=>{if(!t||!t.publicKey||!t.fingerprint)return n(new Error("Need HDSigner to sign input"));const i=[],o=[];for(const r of range(this.data.inputs.length))o.push(this.signInputHDAsync(r,t,e).then((()=>{i.push(!0)}),(()=>{i.push(!1)})));return Promise.all(o).then((()=>{if(i.every((t=>!1===t)))return n(new Error("No inputs were signed"));r()}))}))}signInputHD(t,e,r){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");return getSignersFromHD(t,this.data.inputs,e).forEach((e=>this.signInput(t,e,r))),this}signInputHDAsync(t,e,r){return new Promise(((n,i)=>{if(!e||!e.publicKey||!e.fingerprint)return i(new Error("Need HDSigner to sign input"));const o=getSignersFromHD(t,this.data.inputs,e).map((e=>this.signInputAsync(t,e,r)));return Promise.all(o).then((()=>{n()})).catch(i)}))}signAllInputs(t,e){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const r=[];for(const n of range(this.data.inputs.length))try{this.signInput(n,t,e),r.push(!0)}catch(t){r.push(!1)}if(r.every((t=>!1===t)))throw new Error("No inputs were signed");return this}signAllInputsAsync(t,e){return new Promise(((r,n)=>{if(!t||!t.publicKey)return n(new Error("Need Signer to sign input"));const i=[],o=[];for(const[r]of this.data.inputs.entries())o.push(this.signInputAsync(r,t,e).then((()=>{i.push(!0)}),(()=>{i.push(!1)})));return Promise.all(o).then((()=>{if(i.every((t=>!1===t)))return n(new Error("No inputs were signed"));r()}))}))}signInput(t,e,r){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const n=(0,ft.gI)(this.data.inputs,t);return isTaprootInput(n)?this._signTaprootInput(t,n,e,void 0,r):this._signInput(t,e,r)}signTaprootInput(t,e,r,n){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const i=(0,ft.gI)(this.data.inputs,t);if(isTaprootInput(i))return this._signTaprootInput(t,i,e,r,n);throw new Error(`Input #${t} is not of type Taproot.`)}_signInput(t,e,r=_t){const{hash:n,sighashType:i}=getHashAndSighashType(this.data.inputs,t,e.publicKey,this.__CACHE,r,this.opts.forkCoin),o=[{pubkey:e.publicKey,signature:k.encode(e.sign(n),255&i)}];return this.data.updateInput(t,{partialSig:o}),this}_signTaprootInput(t,e,r,n,i=[transaction_Transaction.SIGHASH_DEFAULT]){const o=this.checkTaprootHashesForSig(t,e,r,n,i),s=o.filter((t=>!t.leafHash)).map((t=>serializeTaprootSignature(r.signSchnorr(t.hash),e.sighashType)))[0],a=o.filter((t=>!!t.leafHash)).map((t=>({pubkey:toXOnly(r.publicKey),signature:serializeTaprootSignature(r.signSchnorr(t.hash),e.sighashType),leafHash:t.leafHash})));return s&&this.data.updateInput(t,{tapKeySig:s}),a.length&&this.data.updateInput(t,{tapScriptSig:a}),this}signInputAsync(t,e,r){return Promise.resolve().then((()=>{if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const n=(0,ft.gI)(this.data.inputs,t);return isTaprootInput(n)?this._signTaprootInputAsync(t,n,e,void 0,r):this._signInputAsync(t,e,r)}))}signTaprootInputAsync(t,e,r,n){return Promise.resolve().then((()=>{if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const i=(0,ft.gI)(this.data.inputs,t);if(isTaprootInput(i))return this._signTaprootInputAsync(t,i,e,r,n);throw new Error(`Input #${t} is not of type Taproot.`)}))}_signInputAsync(t,e,r=_t){const{hash:n,sighashType:i}=getHashAndSighashType(this.data.inputs,t,e.publicKey,this.__CACHE,r,this.opts.forkCoin);return Promise.resolve(e.sign(n)).then((r=>{const n=[{pubkey:e.publicKey,signature:k.encode(r,i)}];this.data.updateInput(t,{partialSig:n})}))}async _signTaprootInputAsync(t,e,r,n,i=[transaction_Transaction.SIGHASH_DEFAULT]){const o=this.checkTaprootHashesForSig(t,e,r,n,i),s=[],a=o.filter((t=>!t.leafHash))[0];if(a){const t=Promise.resolve(r.signSchnorr(a.hash)).then((t=>({tapKeySig:serializeTaprootSignature(t,e.sighashType)})));s.push(t)}const u=o.filter((t=>!!t.leafHash));if(u.length){const t=u.map((t=>Promise.resolve(r.signSchnorr(t.hash)).then((n=>({tapScriptSig:[{pubkey:toXOnly(r.publicKey),signature:serializeTaprootSignature(n,e.sighashType),leafHash:t.leafHash}]})))));s.push(...t)}return Promise.all(s).then((e=>{e.forEach((e=>this.data.updateInput(t,e)))}))}checkTaprootHashesForSig(t,e,r,n,i){if("function"!=typeof r.signSchnorr)throw new Error(`Need Schnorr Signer to sign taproot input #${t}.`);const o=getTaprootHashesForSig(t,e,this.data.inputs,r.publicKey,this.__CACHE,n,i);if(!o||!o.length)throw new Error(`Can not sign for input #${t} with the key ${g.nj(r.publicKey)}`);return o}toBuffer(){return checkCache(this.__CACHE),this.data.toBuffer()}toHex(){return checkCache(this.__CACHE),this.data.toHex()}toBase64(){return checkCache(this.__CACHE),this.data.toBase64()}updateGlobal(t){return this.data.updateGlobal(t),this}updateInput(t,e){return e.witnessScript&&checkInvalidP2WSH(e.witnessScript),checkTaprootInputFields(this.data.inputs[t],e,"updateInput"),this.data.updateInput(t,e),e.nonWitnessUtxo&&addNonWitnessTxCache(this.__CACHE,this.data.inputs[t],t),this}updateOutput(t,e){return checkTaprootOutputFields(this.data.outputs[t],e,"updateOutput"),this.data.updateOutput(t,e),this}addUnknownKeyValToGlobal(t){return this.data.addUnknownKeyValToGlobal(t),this}addUnknownKeyValToInput(t,e){return this.data.addUnknownKeyValToInput(t,e),this}addUnknownKeyValToOutput(t,e){return this.data.addUnknownKeyValToOutput(t,e),this}clearFinalizedInput(t){return this.data.clearFinalizedInput(t),this}}const transactionFromBuffer=t=>new PsbtTransaction(t);class PsbtTransaction{tx;constructor(t=Uint8Array.from([2,0,0,0,0,0,0,0,0,0])){this.tx=transaction_Transaction.fromBuffer(t),function checkTxEmpty(t){if(!t.ins.every((t=>t.script&&0===t.script.length&&t.witness&&0===t.witness.length)))throw new Error("Format Error: Transaction ScriptSigs are not empty")}(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(t){if(void 0===t.hash||void 0===t.index||!(t.hash instanceof Uint8Array)&&"string"!=typeof t.hash||"number"!=typeof t.index)throw new Error("Error adding input.");const e="string"==typeof t.hash?bufferutils_reverseBuffer(g.aD(t.hash)):t.hash;this.tx.addInput(e,t.index,t.sequence)}addOutput(t){if(void 0===t.script||void 0===t.value||!(t.script instanceof Uint8Array)||"bigint"!=typeof t.value)throw new Error("Error adding output.");this.tx.addOutput(t.script,t.value)}toBuffer(){return this.tx.toBuffer()}}function checkCache(t){if(!1!==t.__UNSAFE_SIGN_NONSEGWIT)throw new Error("Not BIP174 compliant, can not export")}function hasSigs(t,e,r){if(!e)return!1;let n;if(n=r?r.map((t=>{const r=function compressPubkey(t){if(65===t.length){const e=1&t[64],r=t.slice(0,33);return r[0]=2|e,r}return t.slice()}(t);return e.find((t=>0===g.UD(t.pubkey,r)))})).filter((t=>!!t)):e,n.length>t)throw new Error("Too many signatures");return n.length===t}function isFinalized(t){return!!t.finalScriptSig||!!t.finalScriptWitness}function bip32DerivationIsMine(t){return e=>!g.UD(t.fingerprint,e.masterFingerprint)&&!g.UD(t.derivePath(e.path).publicKey,e.pubkey)}function check32Bit(t){if("number"!=typeof t||t!==Math.floor(t)||t>4294967295||t<0)throw new Error("Invalid 32 bit integer")}function checkInputsForPartialSig(t,e){t.forEach((t=>{if(isTaprootInput(t)?checkTaprootInputForSigs(t,e):checkInputForSig(t,e))throw new Error("Can not modify transaction, signatures exist.")}))}function checkScriptForPubkey(t,e,r){if(!pubkeyInScript(t,e))throw new Error(`Can not ${r} for this input with the key ${g.nj(t)}`)}function checkTxInputCache(t,e){const r=g.nj(bufferutils_reverseBuffer(Uint8Array.from(e.hash)))+":"+e.index;if(t.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");t.__TX_IN_CACHE[r]=1}function scriptCheckerFactory(t,e){return(r,n,i,o)=>{const s=t({redeem:{output:i}}).output;if(g.UD(n,s))throw new Error(`${e} for ${o} #${r} doesn't match the scriptPubKey in the prevout`)}}const At=scriptCheckerFactory(p2sh_p2sh,"Redeem script"),Tt=scriptCheckerFactory(p2wsh_p2wsh,"Witness script");function getTxCacheValue(t,e,r,n){if(!r.every(isFinalized))throw new Error(`PSBT must be finalized to calculate ${e}`);if("__FEE_RATE"===t&&n.__FEE_RATE)return n.__FEE_RATE;if("__FEE"===t&&n.__FEE)return n.__FEE;let i,o=!0;return n.__EXTRACTED_TX?(i=n.__EXTRACTED_TX,o=!1):i=n.__TX.clone(),inputFinalizeGetAmts(r,i,n,o),"__FEE_RATE"===t?n.__FEE_RATE:"__FEE"===t?n.__FEE:void 0}function getFinalScripts(t,e,r,n,i,o){const s=classifyScript(r);if(!function canFinalize(t,e,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return hasSigs(1,t.partialSig);case"multisig":const r=p2ms_p2ms({output:e});return hasSigs(r.m,t.partialSig,r.pubkeys);default:return!1}}(e,r,s))throw new Error(`Can not finalize input #${t}`);return function prepareFinalScripts(t,e,r,n,i,o){let s,a;const u=function getPayment(t,e,r){let n;switch(e){case"multisig":const e=function getSortedSigs(t,e){const r=p2ms_p2ms({output:t});return r.pubkeys.map((t=>(e.filter((e=>0===g.UD(e.pubkey,t)))[0]||{}).signature)).filter((t=>!!t))}(t,r);n=p2ms_p2ms({output:t,signatures:e});break;case"pubkey":n=p2pk({output:t,signature:r[0].signature});break;case"pubkeyhash":n=p2pkh({output:t,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=p2wpkh({output:t,pubkey:r[0].pubkey,signature:r[0].signature})}return n}(t,e,r),p=o?p2wsh_p2wsh({redeem:u}):null,l=i?p2sh_p2sh({redeem:p||u}):null;n?(a=witnessStackToScriptWitness(p?p.witness:u.witness),l&&(s=l.input)):s=l?l.input:u.input;return{finalScriptSig:s,finalScriptWitness:a}}(r,s,e.partialSig,n,i,o)}function getHashAndSighashType(t,e,r,n,i,o){const s=(0,ft.gI)(t,e),{hash:a,sighashType:u,script:p}=getHashForSig(e,s,n,!1,o,i);return checkScriptForPubkey(r,p,"sign"),{hash:a,sighashType:u}}function getHashForSig(t,e,r,n,i,o){const s=r.__TX,a=e.sighashType||function getDefaultSighash(t){switch(t){case"bch":return St;case"btg":return bt;case"none":return transaction_Transaction.SIGHASH_ALL}}(i);let u,p;checkSighashTypeAllowed(a,o);const l=(a&transaction_Transaction.SIGHASH_BITCOINCASHBIP143)>0,c=(a&transaction_Transaction.FORKID_BTG<<8)>0;if(e.nonWitnessUtxo){const n=nonWitnessUtxoTxFromCache(r,e,t),i=s.ins[t].hash,o=n.getHash();if(0!==g.UD(i,o))throw new Error(`Non-witness UTXO hash for input #${t} doesn't match the hash specified in the prevout`);const a=s.ins[t].index;p=n.outs[a]}else{if(!e.witnessUtxo)throw new Error("Need a Utxo input item for signing");p=e.witnessUtxo}const{meaningfulScript:h,type:f}=getMeaningfulScript(p.script,t,"input",e.redeemScript,e.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(f)>=0)u=l&&c?s.hashForGoldSignature(t,h,p.value,a,!0):s.hashForWitnessV0(t,h,p.value,a);else if(mt(h)){const e=p2pkh({hash:h.slice(2)}).output;u=l&&c?s.hashForGoldSignature(t,e,p.value,a,!0):s.hashForWitnessV0(t,e,p.value,a)}else{if(!l&&void 0===e.nonWitnessUtxo&&!1===r.__UNSAFE_SIGN_NONSEGWIT)throw new Error(`Input #${t} has witnessUtxo but non-segwit script: ${g.nj(h)}`);n||!1===r.__UNSAFE_SIGN_NONSEGWIT||console.warn("Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as Psbt's predecessor (TransactionBuilder - now removed) when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.\n*********************\nPROCEED WITH CAUTION!\n*********************"),u=l&&c?s.hashForGoldSignature(t,h,p.value,a,!0):l?s.hashForCashSignature(t,h,p.value,a):s.hashForSignature(t,h,a)}return{script:h,sighashType:a,hash:u}}function getPrevoutTaprootKey(t,e,r){const{script:n}=getScriptAndAmountFromUtxo(t,e,r);return It(n)?n.subarray(2,34):null}function trimTaprootSig(t){return 64===t.length?t:t.subarray(0,64)}function getTaprootHashesForSig(t,e,r,n,i,o,s){const a=i.__TX,u=e.sighashType||transaction_Transaction.SIGHASH_DEFAULT;checkSighashTypeAllowed(u,s);const p=r.map(((t,e)=>getScriptAndAmountFromUtxo(e,t,i))),l=p.map((t=>t.script)),c=p.map((t=>t.value)),h=[];if(e.tapInternalKey&&!o){const r=getPrevoutTaprootKey(t,e,i)||Uint8Array.from([]);if(0===g.UD(toXOnly(n),r)){const e=a.hashForWitnessV1(t,l,c,u);h.push({pubkey:n,hash:e})}}const f=(e.tapLeafScript||[]).filter((t=>pubkeyInScript(n,t.script))).map((t=>{const e=tapleafHash({output:t.script,version:t.leafVersion});return Object.assign({hash:e},t)})).filter((t=>!o||0===g.UD(o,t.hash))).map((e=>{const r=a.hashForWitnessV1(t,l,c,u,e.hash);return{pubkey:n,hash:r,leafHash:e.hash}}));return h.concat(f)}function checkSighashTypeAllowed(t,e){if(e&&e.indexOf(t)<0){const e=function sighashTypeToString(t){let e=t&transaction_Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";t&transaction_Transaction.SIGHASH_BITCOINCASHBIP143&&(e+="SIGHASH_BITCOINCASHBIP143 | ");t&transaction_Transaction.FORKID_BTG<<8?e+="FORKID_BTG | ":e+="FORKID_BCH | ";switch(31&t){case transaction_Transaction.SIGHASH_ALL:e+="SIGHASH_ALL";break;case transaction_Transaction.SIGHASH_SINGLE:e+="SIGHASH_SINGLE";break;case transaction_Transaction.SIGHASH_NONE:e+="SIGHASH_NONE"}return e}(t);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${e}`)}}function getSignersFromHD(t,e,r){const n=(0,ft.gI)(e,t);if(!n.bip32Derivation||0===n.bip32Derivation.length)throw new Error("Need bip32Derivation to sign with HD");const i=n.bip32Derivation.map((t=>0===g.UD(t.masterFingerprint,r.fingerprint)?t:void 0)).filter((t=>!!t));if(0===i.length)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return i.map((t=>{const e=r.derivePath(t.path);if(0!==g.UD(t.pubkey,e.publicKey))throw new Error("pubkey did not match bip32Derivation");return e}))}function scriptWitnessToWitnessStack(t){let e=0;function readVarInt(){const r=X.decode(t,e);return e+=X.encodingLength(r.bigintValue),r.numberValue}function readVarSlice(){return function readSlice(r){return e+=r,t.slice(e-r,e)}(readVarInt())}return function readVector(){const t=readVarInt(),e=[];for(let r=0;r<t;r++)e.push(readVarSlice());return e}()}function addNonWitnessTxCache(t,e,r){t.__NON_WITNESS_UTXO_BUF_CACHE[r]=e.nonWitnessUtxo;const n=transaction_Transaction.fromBuffer(e.nonWitnessUtxo);t.__NON_WITNESS_UTXO_TX_CACHE[r]=n;const i=t,o=r;delete e.nonWitnessUtxo,Object.defineProperty(e,"nonWitnessUtxo",{enumerable:!0,get(){const t=i.__NON_WITNESS_UTXO_BUF_CACHE[o],e=i.__NON_WITNESS_UTXO_TX_CACHE[o];if(void 0!==t)return t;{const t=e.toBuffer();return i.__NON_WITNESS_UTXO_BUF_CACHE[o]=t,t}},set(t){i.__NON_WITNESS_UTXO_BUF_CACHE[o]=t}})}function inputFinalizeGetAmts(t,e,r,n){let i=0n;t.forEach(((t,o)=>{if(n&&t.finalScriptSig&&(e.ins[o].script=t.finalScriptSig),n&&t.finalScriptWitness&&(e.ins[o].witness=scriptWitnessToWitnessStack(t.finalScriptWitness)),t.witnessUtxo)i+=t.witnessUtxo.value;else if(t.nonWitnessUtxo){const n=nonWitnessUtxoTxFromCache(r,t,o),s=e.ins[o].index,a=n.outs[s];i+=a.value}}));const o=e.outs.reduce(((t,e)=>t+e.value),0n),s=i-o;if(s<0)throw new Error("Outputs are spending more than Inputs");const a=e.virtualSize();r.__FEE=s,r.__EXTRACTED_TX=e,r.__FEE_RATE=Math.floor(Number(s/BigInt(a)))}function nonWitnessUtxoTxFromCache(t,e,r){const n=t.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||addNonWitnessTxCache(t,e,r),n[r]}function getScriptFromUtxo(t,e,r){const{script:n}=getScriptAndAmountFromUtxo(t,e,r);return n}function getScriptAndAmountFromUtxo(t,e,r){if(void 0!==e.witnessUtxo)return{script:e.witnessUtxo.script,value:e.witnessUtxo.value};if(void 0!==e.nonWitnessUtxo){const n=nonWitnessUtxoTxFromCache(r,e,t).outs[r.__TX.ins[t].index];return{script:n.script,value:n.value}}throw new Error("Can't find pubkey in input without Utxo data")}function isPubkeyLike(t){return 33===t.length&&function isCanonicalPubKey(t){return isPoint(t)}(t)}function getMeaningfulScript(t,e,r,n,i){const o=vt(t),s=o&&n&&wt(n),a=wt(t);if(o&&void 0===n)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((a||s)&&void 0===i)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let u;return s?(u=i,At(e,t,n,r),Tt(e,n,i,r),checkInvalidP2WSH(u)):a?(u=i,Tt(e,t,i,r),checkInvalidP2WSH(u)):o?(u=n,At(e,t,n,r)):u=t,{meaningfulScript:u,type:s?"p2sh-p2wsh":o?"p2sh":a?"p2wsh":"raw"}}function checkInvalidP2WSH(t){if(mt(t)||vt(t))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function classifyScript(t){return mt(t)?"witnesspubkeyhash":yt(t)?"pubkeyhash":gt(t)?"multisig":dt(t)?"pubkey":"nonstandard"}function range(t){return[...Array(t).keys()]}}}]);
//# sourceMappingURL=39430.d7890c7883.chunk.js.map